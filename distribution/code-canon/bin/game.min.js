function smokeEmitter(e,t){particleEffect(e,t,function(){return smokes.getSmoke()},2,0,!0,2.4,3.6,1,10,.1,2,.005,.01,.005,.01,0,0)}function fire(e){bullets.getBullet(e,0,contr.bulletSpeed),sBox.play(sBox.shotSound)}function Bullet(){this.bulletPool=[],this.activeBullets=[],this.createBullet=function(){var e=rectangle(15,4,"black"),t=rectangle(60,2,"red","red",1);return e.addChild(t),e.cBox=t,t.visible=!1,gameScene.addChild(e),e},this.getBullet=function(e,t,i){var s=null;s=this.bulletPool.length>0?this.bulletPool.pop():this.createBullet(),s.rotation=e.rotation,s.x=e.gx+e.width-s.halfWidth+t*Math.cos(e.rotation),s.y=e.gy-s.halfHeight+t*Math.sin(e.rotation),s.vx=Math.cos(e.rotation)*i,s.vy=Math.sin(e.rotation)*i,s.visible=!0,this.activeBullets.push(s)},this.freeBullet=function(e){e.visible=!1,this.activeBullets.splice(this.activeBullets.indexOf(e),1),this.bulletPool.push(e)}}function toggleMenu(e,t){void 0!==e&&(e.div.style.visibility="hidden"),void 0!==t?(t.div.style.visibility="visible",menu.style.visibility="visible"):menu.style.visibility="hidden"}function aliencBoxCol(e,t,i,s){var n,o,l,r,a,c,u,s=s||!1,i=i||!1;return s?(c=e.gx+e.halfWidth-(t.gx+t.halfWidth),u=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(c=e.centerX-t.centerX,u=e.centerY-t.centerY),o=e.halfWidth+t.halfWidth,l=e.halfHeight+t.halfHeight,Math.abs(c)<o&&Math.abs(u)<l&&(r=o-Math.abs(c),a=l-Math.abs(u),r>=a?n=u>0?"top":"bottom":(n=c>0?"left":"right",i&&(e.vx*=-5))),n}function load(){progressBar.create(g.canvas,assets),progressBar.update()}function setup(){progressBar.remove(),sBox=new SoundBox,sBox.init(),sBox.mute=!1,ds=Storage(),gameScene=GameScene(),bd.attracts.forEach(function(e){gameScene.addChild(e)}),scoreScene=ScoreScene(),optionScene=OptionScene(),storeScene=StoreScene(),creditScene=CreditScene(),pauseScene=PauseScene(),gameoverScene=GameOverScene(),titleScene=getTitleScene(),toggleMenu(void 0,titleScene),playerGroup.visible=!1,ship.visible=!1,aliens=new Alien;for(var e=0;6>e;e++){var t=aliens.createAlien();t.visible=!1,t.setPosition(ship.centerX,ship.centerY),aliens.alienPool.push(t),t=null}bullets=new Bullet;for(var e=0;12>e;e++){var i=bullets.createBullet();i.visible=!1,bullets.bulletPool.push(i),i=null}smokes=new smokeSprites;for(var e=0;12>e;e++){var s=smokes.createSmoke();s.visible=!1,smokes.smokePool.push(s),s=null}imgr=new ItemManager,imgr.initItems(),keyHandler(),ai=new gameAI,ai.init(Date.now()),levelText=text("Level 0","15px PetMe64","white",0),levelText.visible=!1,gameScene.addChild(levelText),g.mobile===!0&&(touchCtrl.jumpTBtn.visible=!0,touchCtrl.fireTBtn.visible=!0,touchCtrl.jumpText.visible=!0,touchCtrl.fireText.visible=!0,touchCtrl.jumpTBtn.interactive=!0,touchCtrl.fireTBtn.interactive=!0),menu=document.getElementById("menu")}function restarHandler(){restart(),score.init(),ai.init(Date.now()),g.resume()}function keyHandler(){function e(){"gun"==playerGroup.item.type&&(playerGroup.item.visible=!0,player.shoot(gun)),"mg"==playerGroup.item.type&&player.shoot(mGun)}function t(){"gun"==playerGroup.item.type&&(playerGroup.item.visible=!1,player.walk()),"mg"==playerGroup.item.type&&player.walk()}function i(){g.paused&&"pause"==ai.state?(ai.t0=Date.now(),g.resume(),toggleMenu(pauseScene,void 0),sBox.restart(sBox.bgMusic),player.walk(),ai.state="play"):"end"!==ai.state&&(g.pause(),toggleMenu(void 0,pauseScene),sBox.pause(sBox.bgMusic),player.stop(),ai.state="pause")}function s(){playerGroup.isOnGround&&(playerGroup.isOnGround=!1,playerGroup.vy=-contr.jumpForce,playerGroup.building_index=void 0,player.jump())}keyboard(32).press=i;var n=keyboard(88);n.press=e,n.release=t;var o=keyboard(39);o.press=e,o.release=t,keyboard(90).press=s,keyboard(38).press=s,touchCtrl.jumpTBtn.press=s,touchCtrl.fireTBtn.press=e,touchCtrl.fireTBtn.release=t}function TouchControls(){var e=10,t=g.canvas.width/7,i=t-e,s=g.canvas.height-t,n={};return n.jumpTBtn=rectangle(i,i,"grey","grey",1,e+i,s),n.jumpText=text("j",3*t/4+"px PetMe64","white",0),n.jumpTBtn.putCenter(n.jumpText),n.jumpTBtn.alpha=.5,n.fireTBtn=rectangle(i,i,"grey","grey",1,g.canvas.width-(e+t+i),s),n.fireText=text("f",3*t/4+"px PetMe64","white",0),n.fireTBtn.putCenter(n.fireText),n.jumpTBtn.alpha=.5,n.fireTBtn.alpha=.5,n.jumpTBtn.visible=!1,n.fireTBtn.visible=!1,n.jumpText.visible=!1,n.fireText.visible=!1,n.jumpTBtn.interactive=!1,n.fireTBtn.interactive=!1,n}function makePlayer(){var e={};return e.state="",e.sticky=sprite(filmstrip(assets["json/sticky.png"],30,53)),e.sticky.states={stand:0,walk:[1,6],jump:7,slide:8},e.sticky.fps=12,e.sticky.sliding=!1,e.hands=sprite(filmstrip(assets["json/hands.png"],30,21)),e.hands.states={stand:0,walk:[1,6],jump:7,slide:8,gun:9,mg:10},e.hands.setPosition(0,21),e.leye=ellipse(7,4.2,2,5),e.reye=ellipse(10,4.2,2,5),e.grp=group([e.sticky,e.hands,e.leye,e.reye]),e.walk=function(){"walk"!==e.state&&(e.state="walk",e.sticky.playSequence(e.sticky.states.walk),e.hands.playSequence(e.hands.states.walk),e.leye.y=4.2,e.reye.y=4.2)},e.breath=function(){breathe(player.grp,1,1.05,30)},e.jump=function(){"jump"!==e.state&&(e.state="jump",e.sticky.show(e.sticky.states.jump),e.hands.show(e.hands.states.jump),sBox.play(sBox.jumpSound),e.leye.y=5.8,e.reye.y=5.8)},e.slide=function(){"slide"!==e.state&&(e.state="slide",e.sticky.sliding=!0,e.sticky.show(e.sticky.states.slide),e.hands.show(e.hands.states.slide))},e.unSlide=function(){"unslide"!==e.state&&(e.state="unslide",e.sticky.sliding=!1,e.walk())},e.shoot=function(t){"shoot"!==e.state&&(e.state="shoot",e.hands.show(e.hands.states.gun),"gun"==t.type?fire(t):(e.hands.show(e.hands.states.mg),fire(t),setTimeout(function(){fire(t)},50)))},e.play=function(){"playing"!==e.state&&(e.state="playing",e.sticky.play(),e.hands.play())},e.stop=function(){"stopped"!==e.state&&(e.state="stopped",e.sticky.stop(),e.hands.stop())},e}function createCar(){var e=sprite(assets["carBody.png"]),t=sprite(assets["carWheel.png"],14.6,17.2),i=sprite(assets["carWheel.png"],56,17.2),s=sprite(assets["driver.png"],38,2);t.rotate=.1,i.rotate=.1;var n=group([e,t,i,s]);return n.type="car",n.visible=!1,n.start=function(){t.rotation+=t.rotate,i.rotation+=i.rotate},n.remove=function(){sBox.pause(sBox.carSound),n.visible=!1,stage.addChild(n),player.grp.visible=!0,playerGroup.addChild(player.grp),playerGroup.addChild(gun),playerGroup.item=gun,playerGroup.building_index=void 0,ai.hasItem=!1;for(var e=aliens.activeAliens.length-1;e>=0;e--)aliens.freeAlien(aliens.activeAliens[e]);for(var e=bullets.activeBullets.length-1;e>=0;e--)bullets.freeBullet(bullets.activeBullets[e])},n}function Alien(){this.alienPool=[],this.activeAliens=[],this.createAlien=function(){var e=sprite(filmstrip(assets["json/alien.png"],30,53));return e.states={stand:0,walk:[1,6],jump:7},e.fps=12,e.vx=0,e.accelerationX=0,e.isOnGround=!1,e.isUnderCol=!1,e.state="",e.release=!1,e.canJump=!1,e.walk=function(){"walk"!==e.state&&(e.state="walk",e.playSequence(e.states.walk))},e.jump=function(){"jump"!==e.state&&(e.state="jump",e.show(e.states.jump))},e.stand=function(){"stand"!==e.state&&(e.state="stand",e.show(e.states.stand))},e.stop=function(){"stop"!==e.state&&(e.state="stop",e.stop())},gameScene.addChild(e),e},this.getAlien=function(){var e=null;return this.alienPool.length>0?(e=this.alienPool.pop(),e.vx=0,e.vy=0,e.accelerationX=0,e.isOnGround=!1,e.isTouching=!1,e.state="",e.act=""):e=this.createAlien(),e.setPosition(ship.centerX+randomInt(-10,10),ship.centerY+randomInt(-5,5)),e.visible=!0,e.release=!0,e.jump(),randomInt(0,1)?(e.act="run",randomInt(0,1)&&(e.canJump=!0)):e.act="defend",this.activeAliens.push(e),sBox.play(sBox.entrySound),e},this.freeAlien=function(e){e.visible=!1,e.canJump=!1,e.isUnderCol=!1,e.release=!1,e.setPosition(ship.centerX,ship.centerY),this.activeAliens.splice(this.activeAliens.indexOf(e),1),this.alienPool.push(e)}}function smokeSprites(){this.smokePool=[],this.activeSmoke=[],this.createSmoke=function(){var e=sprite(assets["smoke.png"]);return gameScene.addChild(e),e},this.getSmoke=function(){var e=null;return e=this.smokePool.length>0?this.smokePool.pop():this.createSmoke(),e.visible=!0,this.activeSmoke.push(e),e},this.freeSmoke=function(e){e.visible=!1,e.x=0,e.y=0,e.vx=0,e.vy=0,e.width=10,e.height=10,e.rotation=0,e.alpha=1,e.scaleSpeed=1,e.alphaSpeed=1,e.rotationSpeed=1,e.scaleX=1,e.scaleY=1,this.activeSmoke.splice(this.activeSmoke.indexOf(e),1),this.smokePool.push(e)}}function createShip(){var e=sprite(assets["ship.png"]);return e.setPosition(g.canvas.width-150,32),e.startTime=Date.now(),e.lastUpdateTime=e.startTime,e}function createPlayerGroup(){var e=group([player.grp,gun]);return e.isOnGround=!1,e.building_index=void 0,e.checkColl=!0,e.item=gun,e.setPosition(.36*g.canvas.width/2,g.canvas.height/2),e}function createGun(){var e=sprite(assets["gun.png"],25,21);return e.visible=!1,e.type="gun",e}function createMGun(){var e=sprite(assets["mGun.png"]);return e.type="mg",e.visible=!1,e.remove=function(){e.visible=!1,stage.addChild(e),playerGroup.addChild(gun),playerGroup.item=gun},e}function end(){playerGroup.vy=0,player.stop(),playerGroup.visible=!1,playerGroup.isOnGround=!1,playerGroup.item!==gun&&car.remove(),g.pause(),score.publishHScore(),sBox.pause(sBox.bgMusic),ai.state="end";for(var e=aliens.activeAliens.length-1;e>=0;e--)aliens.freeAlien(aliens.activeAliens[e]);for(var e=bullets.activeBullets.length-1;e>=0;e--)bullets.freeBullet(bullets.activeBullets[e]);for(var e=smokes.activeSmoke.length-1;e>=0;e--)smokes.freeSmoke(smokes.activeSmoke[e]);titleScene.playBtn.onclick=function(){toggleMenu(titleScene,void 0),setTimeout(function(){restarHandler()},500)},gameoverScene.restartBtn.onclick=function(){toggleMenu(gameoverScene,void 0),setTimeout(function(){restarHandler()},500)},gameoverScene.showOverScreen(),setTimeout(function(){toggleMenu(void 0,gameoverScene)},500)}function restart(){playerGroup.visible=!0,playerGroup.setPosition(.36*g.canvas.width/2,g.canvas.height/2),playerGroup.building_index=void 0,player.state="jump",topBar.reset(5),bd.pattern=designs[randomInt(0,4)],contr.design=bd.pattern,contr.distance=0,bd.resetBuildings(bd.pattern),sBox.restart(sBox.bgMusic),ai.state="play"}function Buildings(){this.numOfBuilding=4,this.buildingWidth=.36*g.canvas.width,this.buildingHeight=.65*g.canvas.height,this.row=7,this.columns=11,this.endGap=.25*this.buildingWidth,this.strtGap=.6*this.endGap,this.hGap=.1*this.buildingHeight,this.shake=!1,blocks=group([]),this.attracts=[],this.pattern=designs[randomInt(0,4)],g.mobile===!0&&(this.row=5,this.columns=7),this.width=this.buildingWidth/this.row,this.height=this.buildingHeight/this.columns,this.createBuildings=function(){blocks.nextPos={X:0,Y:this.buildingHeight};for(var e=0;e<this.numOfBuilding;e++){var t=this.designBuidlings(this.buildingWidth,this.buildingHeight,this.pattern,blocks.nextPos.X,blocks.nextPos.Y);blocks.addChild(t),blocks.nextPos.X=t.x+t.width+randomInt(this.strtGap,this.endGap),blocks.nextPos.Y=this.buildingHeight+randomInt(-this.hGap,this.hGap);var i=rectangle(25,g.canvas.height,"#272726","grey",1,t.x+t.width,0);i.visible=!1,this.attracts.push(i),t.cBox=i}},this.designBuidlings=function(e,t,i,s,n){var o=rectangle(e,t,"#272726","grey",2,s,n);i.image&&o.setPattern(i.image,"repeat");for(var l=o.width/this.row,r=o.height/this.columns,a=0;a<this.columns;a++)for(var c=0;c<this.row;c++)if(c%2!==0&&a%2!==0){var u=rectangle(l,r,"grey","black",1);u.x=l*c,u.y=r*a,u.i=a,u.j=c,u.fillStyle=i.color2,randomInt(0,1)&&(u.fillStyle=i.color1),o.addChild(u)}return o},this.resetBuildings=function(e){blocks.children.forEach(function(t){t.pattern=!1,e.image&&t.setPattern(e.image,"repeat"),t.children.forEach(function(t){t.fillStyle=randomInt(0,1)?e.color1:e.color2})})}}function Score(){this.hkills=0,this.hlevel=0,this.hscore=0,this.kills=0,this.level=0,this.score=0,this.scoreText=text("Score 0","10px PetMe64","white",32,32),this.scoreText.setPosition(g.canvas.width-1.5*this.scoreText.width,this.scoreText.height),this.init=function(){var e=ds.retrieveData();e&&(this.hkills=e.kills,this.hlevel=e.level,this.hscore=e.score),this.kills=0,this.level=0,this.score=0,this.scoreText.content="Score 0"},this.publishHScore=function(){this.score>this.hscore&&(this.hkills=this.kills,this.hlevel=this.level,this.hscore=this.score,ds.saveData({playerName:"Test Player",kills:this.hkills,level:this.hlevel,score:this.hscore,coins:100}))},this.update=function(){this.kills+=1,ai.scoreCtr+=1,this.score=10*this.kills,this.scoreText.content="Score "+this.score,this.scoreText.setPosition(g.canvas.width-1.5*this.scoreText.width,this.scoreText.height)}}function TopBar(){this.noLife=contr.noOfLife,this.maxLife=contr.maxLife,this.container=group([]),this.create=function(){for(var e=0;e<this.maxLife;e++){var t=sprite(assets["life.png"],11*e,5);t.visible=!1,this.container.addChild(t)}},this.update=function(e){if(this.noLife+=e,this.noLife>this.maxLife&&(this.noLife=this.maxLife),this.noLife>0)for(var t=0;t<this.maxLife;t++)this.container.children[t].visible=t<this.noLife?!0:!1;else{for(var t=0;t<this.maxLife;t++)this.container.children[t].visible=!1;end()}},this.reset=function(){this.noLife=contr.noOfLife;for(var e=0;e<this.maxLife;e++)this.container.children[e].visible=e<this.noLife?!0:!1}}function getSkyBackground(){return tilingSprite(g.canvas.width,g.canvas.height,assets["snow.png"])}function drawMoon(){var e=circle(100);return e.setPosition(150,200),e}function initDesigns(){var e={image:void 0,color1:"grey",color2:"grey"},t={image:assets["images/texture.png"],color1:"#f00e2e",color2:"grey"},i={image:assets["images/texture2.png"],color1:"black",color2:"grey"},s={image:assets["images/texture3.png"],color1:"black",color2:"grey"},n={image:assets["images/texture4.png"],color1:"black",color2:"grey"};designs.push(e),designs.push(t),designs.push(i),designs.push(s),designs.push(n)}function ItemManager(){this.initItems=function(){this.car_snap=sprite(assets["car_snap.png"]),this.car_snap.type="car",this.car_snap.visible=!1,this.life=sprite(assets["heart.png"]),this.life.type="heart",this.life.visible=!1,gameScene.addChild(this.car_snap),gameScene.addChild(this.life)},this.getItem=function(){var e;switch(randomInt(1,2)){case 1:e=this.car_snap;break;case 2:e=this.life;break;default:console.log("Error in getting items")}return void 0!==e?(e.setPosition(0,0),e):void 0},this.removeItem=function(e){e.visible=!1,stage.addChild(e)}}function GameScene(){return sky=getSkyBackground(),initDesigns(),ship=createShip(),moon=drawMoon(),topBar=new TopBar,topBar.create(),topBar.update(0),score=new Score,score.init(),player=makePlayer(),player.walk(),player.breath(),gun=createGun(),car=createCar(),playerGroup=createPlayerGroup(),bd=new Buildings,bd.createBuildings(),touchCtrl=TouchControls(),group([sky,topBar.container,score.score,moon,blocks,ship,car,playerGroup,itemGroup,score.scoreText,touchCtrl.jumpTBtn,touchCtrl.fireTBtn,touchCtrl.jumpText,touchCtrl.fireText])}function getTitleScene(){var e={};return e.div=document.getElementById("titleScene"),e.playBtn=document.getElementById("m1playBtn"),e.playBtn.onclick=function(){playerGroup.visible=!0,ship.visible=!0,sBox.play(sBox.bgMusic),toggleMenu(e,void 0),setTimeout(function(){g.state=play,ai.init(Date.now())},200)},e.scoreBtn=document.getElementById("m1scoreBtn"),e.scoreBtn.onclick=function(){toggleMenu(e,scoreScene),scoreScene.show()},e.optionsBtn=document.getElementById("m1optionsBtn"),e.optionsBtn.onclick=function(){toggleMenu(e,optionScene)},e.storeBtn=document.getElementById("m1storeBtn"),e.storeBtn.onclick=function(){toggleMenu(e,storeScene)},e.creditsBtn=document.getElementById("m1creditsBtn"),e.creditsBtn.onclick=function(){toggleMenu(e,creditScene)},e}function ScoreScene(){var e={};return e.div=document.getElementById("scoreScene"),e.kills=document.getElementById("m2kills"),e.level=document.getElementById("m2level"),e.hscore=document.getElementById("m2hscore"),e.backBtn=document.getElementById("m2backBtn"),e.backBtn.onclick=function(){toggleMenu(e,titleScene)},e.show=function(){e.kills.textContent=score.hkills,e.level.textContent=score.hlevel,e.hscore.textContent=score.hscore},e}function OptionScene(){var e={};return e.div=document.getElementById("optionScene"),e.backBtn=document.getElementById("m3backBtn"),e.backBtn.onclick=function(){toggleMenu(e,titleScene)},e}function StoreScene(){var e={};return e.div=document.getElementById("storeScene"),e.backBtn=document.getElementById("m4backBtn"),e.backBtn.onclick=function(){toggleMenu(e,titleScene)},e}function CreditScene(){var e={};return e.div=document.getElementById("creditScene"),e.backBtn=document.getElementById("m5backBtn"),e.backBtn.onclick=function(){toggleMenu(e,titleScene)},e}function GameOverScene(){var e={};return e.div=document.getElementById("gameOverScene"),e.kills=document.getElementById("m6kills"),e.level=document.getElementById("m6level"),e.score=document.getElementById("m6score"),e.hscore=document.getElementById("m6hscore"),e.menuBtn=document.getElementById("m6menuBtn"),e.menuBtn.onclick=function(){toggleMenu(e,titleScene)},e.restartBtn=document.getElementById("m6restartBtn"),e.showOverScreen=function(){e.kills.textContent=score.kills,e.level.textContent=score.level,e.score.textContent=score.score,e.hscore.textContent=score.hscore},e}function PauseScene(){var e={};return e.div=document.getElementById("pauseScene"),e.div.onclick=function(){toggleMenu(e,void 0),ai.t0=Date.now(),g.resume(),sBox.restart(sBox.bgMusic),player.walk()},e}function focusManager(){var e=document.createElement("input");return e.id="focusText",e.setAttribute("style","width: 0px; height: 0px;"),document.body.appendChild(e),e.onblur=function(){g.paused||(g.pause(),toggleMenu(void 0,pauseScene),sBox.pause(sBox.bgMusic),player.stop())},e}function SoundBox(){this.mute=!1,this.shotSound=null,this.bgMusic=null,this.explosionSound=null,this.jumpSound=null,this.entrySound=null,this.pupSound=null,this.carSound=null,this.init=function(){Modernizr.webaudio?(this.shotSound=assets["sounds/shot.wav"],this.bgMusic=assets["sounds/retro-action.mp3"],this.bgMusic.loop=!0,this.bgMusic.volume=.2,this.explosionSound=assets["sounds/explosion.wav"],this.jumpSound=assets["sounds/bounce.mp3"],this.entrySound=assets["sounds/entry.mp3"],this.pupSound=assets["sounds/powerup.mp3"],this.carSound=assets["sounds/car.mp3"],this.carSound.loop=!0):console.log("webaudio api not supported - disabling sound")},this.play=function(e){e&&this.mute===!1&&e.play()},this.restart=function(e){e&&this.mute===!1&&e.restart()},this.pause=function(e){e&&this.mute===!1&&e.pause()}}function Storage(){var e={};return e.saveData=function(e){var t=JSON.stringify(e);localStorage.setItem("gameData",t)},e.retrieveData=function(){var e=localStorage.getItem("gameData");if(e){var t=JSON.parse(e);return t}return null},e}function gameAI(){this.levels=[[1,1,3],[1,2,10],[1,3,10],[2,3,25],[1,4,30],[2,4,35],[3,4,40],[2,5,45],[3,5,60],[4,5,80],[5,7,101]],this.state="",this.startTime=0,this.lastUpdAtime=0,this.lastUpdPtime=0,this.curr_level=0,this.scoreCtr=0,this.minAlien=0,this.maxAlien=0,this.alienToKill=0,this.t0=0,this.t1=0,this.dt=0,this.init=function(e){this.startTime=e,this.lastUpdAtime=e,this.lastUpdPtime=e,this.curr_level=0,this.scoreCtr=0,this.minAlien=this.levels[this.curr_level][0],this.maxAlien=this.levels[this.curr_level][1],this.alienToKill=this.levels[this.curr_level][2],this.t0=e,this.t1=e},this.setAlien=function(e){if(this.t1=e,this.dt=.06*(e-this.t0),this.dt>2&&(this.dt=1),e-this.lastUpdAtime>=3e3){for(var t=0;t<randomInt(this.minAlien,this.maxAlien);t++)setTimeout(function(){aliens.getAlien()},350*t);this.lastUpdAtime=e}if(this.scoreCtr>=this.alienToKill&&this.curr_level<this.levels.length-1){this.curr_level++,this.minAlien=this.levels[this.curr_level][0],this.maxAlien=this.levels[this.curr_level][1],this.alienToKill=this.levels[this.curr_level][2],this.scoreCtr=0,score.level=this.curr_level,bd.pattern=designs[randomInt(0,4)],contr.design=bd.pattern,bd.resetBuildings(contr.design),levelText.visible=!0,levelText.content="Level "+score.level,levelText.setPosition(g.canvas.width/2-levelText.width/2,g.canvas.height/2-levelText.height);var i=fadeOut(levelText,120);i.onComplete=function(){levelText.visible=!1,levelText.alpha=1,i=null}}if(e-this.lastUpdPtime>=1e4&&0===itemGroup.children.length){var s=imgr.getItem();s.visible=!0,itemGroup.addChild(s),itemGroup.x=g.canvas.width,itemGroup.y=.5*g.canvas.height,this.lastUpdPtime=e,s=null}}}function play(){if(ai.setAlien(Date.now()),sky.tileX+=1,void 0===playerGroup.building_index&&(playerGroup.vy+=contr.gravity,playerGroup.y+=playerGroup.vy*ai.dt),itemGroup.children.length>0&&(itemGroup.x-=contr.speed*ai.dt,itemGroup.x+itemGroup.width<0&&imgr.removeItem(itemGroup.children[0])),blocks.children.forEach(function(e){e.x-=contr.speed*ai.dt,e.x<=0-e.width-contr.speed&&(e.x=blocks.nextPos.X,e.y=blocks.nextPos.Y,e.shake=!1),blocks.nextPos.X=e.x+e.width+randomInt(bd.strtGap,bd.endGap),blocks.nextPos.Y=bd.buildingHeight+randomInt(-bd.hGap,bd.hGap),e.cBox.x=e.x+e.width}),aliens.activeAliens.forEach(function(e){e.vy+=contr.gravity,e.y+=e.vy*ai.dt,e.vx+=e.accelerationX,e.x+=e.vx*ai.dt,(e.x+e.width<0||e.y>g.canvas.height)&&aliens.freeAlien(e)}),bullets.activeBullets.forEach(function(e){e.x+=e.vx*ai.dt,e.y+=e.vy*ai.dt,e.x>g.canvas.width&&bullets.freeBullet(e)}),"car"==playerGroup.item.type&&car.start(),playerGroup.y>g.canvas.height||playerGroup.x<0){if(topBar.update(-1),!(topBar.noLife>0))return;playerGroup.item!==gun&&car.remove();for(var e=aliens.activeAliens.length-1;e>=0;e--)aliens.freeAlien(aliens.activeAliens[e]);for(var e=bullets.activeBullets.length-1;e>=0;e--)bullets.freeBullet(bullets.activeBullets[e]);playerGroup.setPosition(.36*g.canvas.width/2,g.canvas.height/2),playerGroup.building_index=void 0,g.pause();var t=fadeOut(player.grp,20);t.onComplete=function(){fadeIn(player.grp,50),g.resume(),ai.t0=Date.now(),t=null}}if(void 0===playerGroup.building_index)playerGroup.checkColl=!0;else{var i=blocks.children[playerGroup.building_index];i.gx+i.width<playerGroup.gx+playerGroup.width?(playerGroup.checkColl=!0,playerGroup.building_index=void 0):playerGroup.checkColl=!1,i=null}playerGroup.checkColl&&blocks.children.forEach(function(e){var t=rectangleCollision(playerGroup,e,!1,!0);t&&("bottom"==t?(playerGroup.isOnGround=!0,playerGroup.building_index=blocks.children.indexOf(e),playerGroup.vy=0,"jump"==player.state&&player.walk()):("left"==t||"right"==t)&&(playerGroup.isOnGround=!1,playerGroup.building_index=void 0)),t=null}),blocks.children.forEach(function(e){aliens.activeAliens.forEach(function(t){1==t.release&&aliencBoxCol(t,e.cBox,!1,!0)&&(t.vx=-7,t.act="run"),"bottom"==rectangleCollision(t,e,!1,!0)&&(t.isOnGround=!0,t.vy=0,t.accelerationX=0,t.vx=-contr.speed*ai.dt,t.release=!1,"run"==t.act?(t.vx+=-3,t.walk()):t.stand(),e.gx>=t.x&&"run"==t.act&&t.canJump&&(t.vy=-contr.jumpForce,t.vx+=-2,t.isOnGround=!1,t.jump()),e.shake===!1&&(e.shake=!0))})}),aliens.activeAliens.forEach(function(e){if(bullets.activeBullets.forEach(function(t){hitTestRectangle(t.cBox,e,!0)&&(g.mobile===!1&&smokeEmitter(e.centerX,e.centerY,assets["smoke.png"]),sBox.play(sBox.explosionSound),t.visible=!1,score.update(),aliens.freeAlien(e),bullets.freeBullet(t))}),hitTestRectangle(playerGroup,e,!0)===!0&&e.isUnderCol===!1){if(e.isUnderCol=!0,player.grp.visible){if(topBar.update(-1),!(topBar.noLife>0))return;var t=fadeOut(player.grp,10);t.onComplete=function(){fadeIn(player.grp,20);for(var e=aliens.activeAliens.length-1;e>=0;e--)aliens.freeAlien(aliens.activeAliens[e]);for(var e=bullets.activeBullets.length-1;e>=0;e--)bullets.freeBullet(bullets.activeBullets[e]);t=null}}"car"==playerGroup.item.type&&(e.vx=10,score.update(),aliens.freeAlien(e))}}),itemGroup.children.forEach(function(e){"gun"==playerGroup.item.type&&itemGroup.children.length&&rectangleCollision(e,playerGroup,!1,!0)&&("car"==e.type&&(player.grp.visible=!1,gun.visible=!1,e.visible=!1,remove(e),stage.addChild(player.grp),stage.addChild(gun),car.visible=!0,car.setPosition(0,0),playerGroup.addChild(car),playerGroup.item=car,playerGroup.building_index=void 0,setTimeout(car.remove,8e3),sBox.restart(sBox.carSound)),"heart"==e.type&&e.visible&&(e.visible=!1,topBar.update(1),sBox.play(sBox.pupSound)))}),ai.t0=ai.t1}if(Modernizr.webaudio)var g=game(800,600,setup,["json/sticky.png","json/hands.png","json/alien.png","json/alienHunter.json","json/car.json","images/texture.png","images/texture2.png","images/texture3.png","images/texture4.png","sounds/retro-action.mp3","sounds/shot.wav","sounds/explosion.wav","sounds/bounce.mp3","sounds/entry.mp3","sounds/car.mp3","sounds/powerup.mp3","fonts/PetMe64.ttf"],load);else var g=game(800,600,setup,["json/sticky.png","json/hands.png","json/alien.png","json/alienHunter.json","json/car.json","images/texture.png","images/texture2.png","images/texture3.png","images/texture4.png","fonts/PetMe64.ttf"],load);g.start(),g.setupMobile(),window.addEventListener("resize",function(){g.setupMobile()});var player,sky,ship,gun,mGun,car,blocks,playerGroup,itemGroup=group([]),designs=[],controller={gravity:.4,gAttract:.2,speed:5,jumpForce:7.8,bulletSpeed:17,design:null,distance:null,miles:null,noOfLife:3,maxLife:5,menuAlpha:.93},contr=controller;