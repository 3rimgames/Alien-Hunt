function Sound(e,t){this.source=e,this.loadHandler=t,this.actx=actx,this.volumeNode=this.actx.createGain(),this.panNode=this.actx.createStereoPanner(),this.soundNode=null,this.buffer=null,this.loop=!1,this.playing=!1,this.panValue=0,this.volumeValue=1,this.startTime=0,this.startOffset=0,this.playbackRate=1,this.echo=!1,this.delayValue=.3,this.feedbackValue=.3,this.filterValue=0,this.delayNode=this.actx.createDelay(),this.feedbackNode=this.actx.createGain(),this.filterNode=this.actx.createBiquadFilter(),this.convolverNode=this.actx.createConvolver(),this.reverb=!1,this.reverbImpulse=null,this.load()}function makeSound(e,t){return new Sound(e,t)}function impulseResponse(e,t,i){var e="undefined"!=typeof e?e:2,t="undefined"!=typeof t?t:2,i="undefined"!=typeof i?i:!1,n=actx.sampleRate*e;console.log(e);for(var s=actx.createBuffer(2,n,actx.sampleRate),a=s.getChannelData(0),r=s.getChannelData(1),o=0;n>o;o++){var h;h=i?n-o:o,a[o]=(2*Math.random()-1)*Math.pow(1-h/n,t),r[o]=(2*Math.random()-1)*Math.pow(1-h/n,t)}return s}function playNote(e,t,i){var t="undefined"!=typeof t?t:1,i="undefined"!=typeof i?i:"sine",n=actx.createOscillator(),s=actx.createGain();n.connect(s),s.connect(actx.destination),n.type=i,n.frequency.value=e,s.gain.linearRampToValueAtTime(1,actx.currentTime),s.gain.linearRampToValueAtTime(0,actx.currentTime+t),n.start(actx.currentTime)}function soundEffect(e,t,i,n,s,a,r,o,h,c,d,l,u){function f(e){var t=actx.createConvolver();t.buffer=impulseResponse(u[0],u[1],u[2]),e.connect(t),t.connect(k)}function p(e){var t=actx.createGain(),i=actx.createDelay(),n=actx.createBiquadFilter();i.delayTime.value=l[0],t.gain.value=l[1],l[2]&&(n.frequency.value=l[2]),i.connect(t),l[2]?(t.connect(n),n.connect(i)):t.connect(i),e.connect(i),i.connect(k)}function g(e){e.gain.value=0,e.gain.linearRampToValueAtTime(0,actx.currentTime+r),e.gain.linearRampToValueAtTime(s,actx.currentTime+r+t)}function y(e){e.gain.linearRampToValueAtTime(s,actx.currentTime+t+r),e.gain.linearRampToValueAtTime(0,actx.currentTime+r+t+i)}function v(e){var n=e.frequency.value;h?(e.frequency.linearRampToValueAtTime(n,actx.currentTime+r),e.frequency.linearRampToValueAtTime(n+o,actx.currentTime+r+t+i)):(e.frequency.linearRampToValueAtTime(n,actx.currentTime+r),e.frequency.linearRampToValueAtTime(n-o,actx.currentTime+r+t+i))}function m(){var e=actx.createOscillator(),n=actx.createOscillator(),a=actx.createGain(),r=actx.createGain();a.gain.value=s,r.gain.value=s,e.connect(a),a.connect(actx.destination),n.connect(r),r.connect(actx.destination),e.type="sawtooth",n.type="sawtooth",e.frequency.value=S+d,n.frequency.value=S-d,t>0&&(g(a),g(r)),i>0&&(y(a),y(r)),o>0&&(v(e),v(n)),l&&(p(a),p(r)),u&&(f(a),f(r)),x(e),x(n)}function x(e){e.start(actx.currentTime+r)}var t=checkIfUndefined(t,0),i=checkIfUndefined(i,1),n=checkIfUndefined(n,"sine"),s=checkIfUndefined(s,1),a=checkIfUndefined(a,0),r=checkIfUndefined(r,0),o=checkIfUndefined(o,0),h=checkIfUndefined(h,!1),c=checkIfUndefined(c,0),d=checkIfUndefined(d,0),l=checkIfUndefined(l,void 0),u=checkIfUndefined(u,void 0),w=actx.createOscillator(),b=actx.createGain(),k=actx.createStereoPanner();w.connect(b),b.connect(k),k.connect(actx.destination),b.gain.value=s,k.pan.value=a,w.type=n;var S,M=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};S=c>0?M(e-c/2,e+c/2):e,w.frequency.value=S,t>0&&g(b),i>0&&y(b),o>0&&v(w),l&&p(b),u&&f(b),d>0&&m(),x(w)}function shootSound(){soundEffect(1046.5,0,.3,"sawtooth",.5,-.8,0,1200,!1,0,25,[.2,.2,2e3],void 0)}function explosionSound(){soundEffect(16,0,1,"sawtooth",1,0,0,0,!1,0,50,void 0,void 0)}function jumpSound(){soundEffect(523.25,.05,.2,"sine",1.5,.8,0,600,!0,100,0,void 0,void 0)}function distance(e,t){var i=t.centerX-e.centerX,n=t.centerY-e.centerY;return Math.sqrt(i*i+n*n)}function followEase(e,t,i){var n=t.centerX-e.centerX,s=t.centerY-e.centerY,a=Math.sqrt(n*n+s*s);a>=1&&(e.x+=n*i,e.y+=s*i)}function followConstant(e,t,i){var n=t.centerX-e.centerX,s=t.centerY-e.centerY,a=Math.sqrt(n*n+s*s);a>=i&&(e.x+=n/a*i,e.y+=s/a*i)}function angle(e,t){return Math.atan2(t.centerY-e.centerY,t.centerX-e.centerX)}function rotateSprite(e,t,i,n){e.x=t.centerX-e.parent.x+i*Math.cos(n)-e.halfWidth,e.y=t.centerY-e.parent.y+i*Math.sin(n)-e.halfWidth}function rotatePoint(e,t,i,n,s){var a={};return a.x=e+Math.cos(s)*i,a.y=t+Math.sin(s)*n,a}function shoot(e,t,i,n,s,a){var r=a();r.rotation=e.rotation,r.x=e.centerX-r.halfWidth+i*Math.cos(t),r.y=e.centerY-r.halfHeight+i*Math.sin(t),r.vx=Math.cos(t)*n,r.vy=Math.sin(t)*n,s.push(r)}function outsideBounds(e,t,i){var n,s=t.x,a=t.y,r=t.width,o=t.height;return e.x<s-e.width&&(n="left"),e.y<a-e.height&&(n="top"),e.x>r&&(n="right"),e.y>o&&(n="bottom"),n&&i&&i(n),n}function checkIfUndefined(e,t){return"undefined"!=typeof e?e:t}function move(e){if(1===e.length){var t=e[0];t.x+=t.vx,t.y+=t.vy}else for(var i=0;i<e.length;i++){var t=e[i];t.x+=t.vx,t.y+=t.vy}}function makeCanvas(e,t,i,n){var e=e||256,t=t||256,i=i||"1px dashed black",n=n||"white",s=document.createElement("canvas");return s.id="canvas",s.width=e,s.height=t,s.style.border=i,s.style.backgroundColor=n,document.body.appendChild(s),s.ctx=s.getContext("2d"),s}function DisplayObject(){this.x=0,this.y=0,this.width=0,this.height=0,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.pivotX=.5,this.pivotY=.5,this.vx=0,this.vy=0,this._layer=0,this.children=[],this.parent=void 0,this.shadow=!1,this.shadowColor="black",this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowBlur=3,this.blendMode=void 0,this.gradient=!1,this.pattern=!1,this.frames=[],this.loop=!0,this._currentFrame=0,this.playing=!1,this._draggable=void 0,this._circular=!1,this._interactive=!1,this.animate={}}function remove(e){for(var t=e.length-1;t>=0;t--)e[t].parent.removeChild(e[t])}function render(e){function t(n){n.visible&&n.gx<e.width+n.width&&n.gx+n.width>=-n.width&&n.gy<e.height+n.height&&n.gy+n.height>=-n.height&&(i.save(),i.translate(n.x+n.width*n.pivotX,n.y+n.height*n.pivotY),i.rotate(n.rotation),i.globalAlpha=n.alpha*n.parent.alpha,i.scale(n.scaleX,n.scaleY),n.shadow&&(i.shadowColor=n.shadowColor,i.shadowOffsetX=n.shadowOffsetX,i.shadowOffsetY=n.shadowOffsetY,i.shadowBlur=n.shadowBlur),n.blendMode&&(i.globalCompositeOperation=n.blendMode),n.render&&n.render(i),n.children&&n.children.length>0&&(i.translate(-n.width*n.pivotX,-n.height*n.pivotY),n.children.forEach(function(e){t(e)})),i.restore())}var i=e.ctx;i.clearRect(0,0,e.width,e.height),stage.children.forEach(t)}function Group(e){DisplayObject.call(this),e.forEach(function(e){this.addChild(e)},this)}function group(e){var t=new Group(e);return stage.addChild(t),t}function Sprite(e,t,i){if(DisplayObject.call(this),this.x=t||0,this.y=i||0,e)if(e instanceof Image)this.createFromImage(e);else if(e.frame)this.createFromAtlas(e);else if(e.image&&!e.data)this.createFromTileset(e);else if(e.image&&e.data)this.createFromTilesetFrames(e);else{if(!(e instanceof Array))throw new Error("The image source "+e+" is not recognized");if(e[0]&&e[0].source)this.createFromAtlasFrames(e);else{if(!(e[0]instanceof Image))throw new Error("The image sources in "+e+" are not recognized");this.createFromImages(e)}}}function sprite(e,t,i){var n=new Sprite(e,t,i);return n.frames.length>0&&addStatePlayer(n),stage.addChild(n),n}function frame(e,t,i,n,s){var a={};return a.image=e,a.x=t,a.y=i,a.width=n,a.height=s,a}function frames(e,t,i,n){var s={};return s.image=e,s.data=t,s.width=i,s.height=n,s}function randomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function contain(e,t,i,n){var s,a=t.x,r=t.y,o=t.width,h=t.height,c=i||!1,d=n||void 0;return e.x<a&&(c&&(e.vx*=-1),e.mass&&(e.vx/=e.mass),e.x=a,s="left"),e.y<r&&(c&&(e.vy*=-1),e.mass&&(e.vy/=e.mass),e.y=r,s="top"),e.x+e.width>o&&(c&&(e.vx*=-1),e.mass&&(e.vx/=e.mass),e.x=o-e.width,s="right"),e.y+e.height>h&&(c&&(e.vy*=-1),e.mass&&(e.vy/=e.mass),e.y=h-e.height,s="bottom"),s&&d&&d(s),s}function renderWithInterpolation(e,t){function i(s){s.visible&&s.gx<e.width+s.width&&s.gx+s.width>-s.width&&s.gy<e.height+s.height&&s.gy+s.height>-s.height&&(n.save(),void 0!==s.previousX?s.renderX=(s.x-s.previousX)*t+s.previousX:s.renderX=s.x,void 0!==s.previousY?s.renderY=(s.y-s.previousY)*t+s.previousY:s.renderY=s.y,n.translate(s.renderX+s.width*s.pivotX,s.renderY+s.height*s.pivotY),n.rotate(s.rotation),n.globalAlpha=s.alpha*s.parent.alpha,n.scale(s.scaleX,s.scaleY),s.shadow&&(n.shadowColor=s.shadowColor,n.shadowOffsetX=s.shadowOffsetX,n.shadowOffsetY=s.shadowOffsetY,n.shadowBlur=s.shadowBlur),s.blendMode&&(n.globalCompositeOperation=s.blendMode),s.render&&s.render(n),s.children&&s.children.length>0&&(n.translate(-s.width*s.pivotX,-s.height*s.pivotY),s.children.forEach(i)),n.restore())}var n=e.ctx;n.clearRect(0,0,e.width,e.height),stage.children.forEach(i)}function Button(e,t,i){Sprite.call(this,e,t,i),this.x="undefined"!=typeof t?t:0,this.y="undefined"!=typeof i?i:0,this.interactive=!0}function button(e,t,i){var n=new Button(e,t,i);return stage.addChild(n),n}function makeInteractive(e){e.press=e.press||void 0,e.release=e.release||void 0,e.over=e.over||void 0,e.out=e.out||void 0,e.tap=e.tap||void 0,e.state="up",e.action="",e.pressed=!1,e.hoverOver=!1,e.update=function(t,i){var n=t.hitTestSprite(e);t.isUp&&(e.state="up",e instanceof Button&&e.gotoAndStop(0)),n&&(e.state="over",e.frames&&3===e.frames.length&&e instanceof Button&&e.gotoAndStop(1),t.isDown&&(e.state="down",e instanceof Button&&(3===e.frames.length?e.gotoAndStop(2):e.gotoAndStop(1)))),"down"===e.state&&(e.pressed||(e.press&&e.press(),e.pressed=!0,e.action="pressed")),"over"===e.state&&(e.pressed&&(e.release&&e.release(),e.pressed=!1,e.action="released",t.tapped&&e.tap&&e.tap()),e.hoverOver||(e.over&&e.over(),e.hoverOver=!0)),"up"===e.state&&(e.pressed&&(e.release&&e.release(),e.pressed=!1,e.action="released"),e.hoverOver&&(e.out&&e.out(),e.hoverOver=!1))}}function grid(e,t,i,n,s,a,r,o,h){var e="undefined"!=typeof e?e:0,t="undefined"!=typeof t?t:0,i="undefined"!=typeof i?i:32,n="undefined"!=typeof n?n:32,s="undefined"!=typeof s?s:!1,a="undefined"!=typeof a?a:0,r="undefined"!=typeof r?r:0,o="undefined"!=typeof o?o:void 0,h="undefined"!=typeof h?h:void 0,c=group([]),d=function(){for(var d=e*t,l=0;d>l;l++){var u=l%e*i,f=Math.floor(l/e)*n,p=o();c.addChild(p),s?(p.x=u+i/2-p.halfWidth+a,p.y=f+n/2-p.halfHeight+r):(p.x=u+a,p.y=f+r),h&&h(p)}};return d(),c}function addStatePlayer(e){function t(t){r(),e.gotoAndStop(t)}function i(){e.playing||s([0,e.frames.length-1])}function n(){e.playing&&(r(),e.gotoAndStop(e.currentFrame))}function s(t){r(),c=t[0],d=t[1],h=d-c,0===c&&(h+=1,o+=1),1===h&&(h=2,o+=1),e.fps||(e.fps=12);var i=1e3/e.fps;e.gotoAndStop(c),e.playing||(l=setInterval(a.bind(this),i),e.playing=!0)}function a(){h>o?(e.gotoAndStop(e.currentFrame+1),o+=1):e.loop&&(e.gotoAndStop(c),o=1)}function r(){void 0!==l&&e.playing===!0&&(e.playing=!1,o=0,c=0,d=0,h=0,clearInterval(l))}var o=0,h=0,c=0,d=0,l=void 0;e.show=t,e.play=i,e.stop=n,e.playSequence=s}function filmstrip(e,t,i,n){for(var n="undefined"!=typeof n?n:0,s=[],a=e.width/t,r=e.height/i,o=a*r,h=0;o>h;h++){var c=h%a*t,d=Math.floor(h/a)*i;n&&n>0&&(c+=n+n*h%a,d+=n+n*Math.floor(h/a)),s.push([c,d])}return frames(e,s,t,i)}function shake(e,t,i){function n(){r>a&&(e.x=o,e.y=h,t-=d,e.x+=l(-t,t),e.y+=l(-t,t),a+=1),a>=r&&(e.x=o,e.y=h,shakingSprites.splice(shakingSprites.indexOf(e),1))}function s(){r>a&&(e.rotation=c,t-=d,e.rotation=t*u,a+=1,u*=-1),a>=r&&(e.rotation=c,shakingSprites.splice(shakingSprites.indexOf(e),1))}var t=checkIfUndefined(t,16),i=checkIfUndefined(i,!1),a=1,r=10,o=e.x,h=e.y,c=e.rotation,d=t/r,l=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};-1===shakingSprites.indexOf(e)&&(shakingSprites.push(e),e.updateShake=function(){i?s():n()});var u=1}function Rectangle(e,t,i,n,s,a,r){DisplayObject.call(this),this.width=e||32,this.height=t||32,this.fillStyle=i||"#d3d3d3",this.strokeStyle=n||"#d3d3d3",this.lineWidth=s||0,this.x=a||0,this.y=r||0,this.mask=!1}function rectangle(e,t,i,n,s,a,r){var o=new Rectangle(e,t,i,n,s,a,r);return stage.addChild(o),o}function Circle(e,t,i,n,s,a){DisplayObject.call(this),this.circular=!0,this.diameter="undefined"!=typeof e?e:32,this.fillStyle="undefined"!=typeof t?t:"#d3d3d3",this.strokeStyle="undefined"!=typeof i?i:"#d3d3d3",this.lineWidth="undefined"!=typeof n?n:0,this.x="undefined"!=typeof s?s:0,this.y="undefined"!=typeof a?a:0,this.mask=!1}function circle(e,t,i,n,s,a){var r=new Circle(e,t,i,n,s,a);return stage.addChild(r),r}function Ellipse(e,t,i,n,s,a,r){DisplayObject.call(this),this.x=e||0,this.y=t||0,this.width=i,this.height=n,this.fillStyle="undefined"!=typeof s?s:"black",this.strokeStyle="undefined"!=typeof a?a:"#d3d3d3",this.lineWidth="undefined"!=typeof r?r:0,this.mask=!1}function ellipse(e,t,i,n,s,a,r){var o=new Ellipse(e,t,i,n,s,a,r);return stage.addChild(o),o}function Line(e,t,i,n,s,a){DisplayObject.call(this),this.ax="undefined"!=typeof i?i:0,this.ay="undefined"!=typeof n?n:0,this.bx="undefined"!=typeof s?s:32,this.by="undefined"!=typeof a?a:32,this.strokeStyle=e||"#d3d3d3",this.lineWidth=t||0,this.lineJoin="round"}function line(e,t,i,n,s,a){var r=new Line(e,t,i,n,s,a);return stage.addChild(r),r}function Text(e,t,i,n,s){DisplayObject.call(this),this.content=e||"Hello",this.font=t||"12px sans-serif",this.fillStyle=i||"#d3d3d3",this.x=n||0,this.y=s||0,this.textBaseline="top",this.strokeText="none",canvas.ctx.font=this.font,canvas.ctx.textBaseline="top",this.width=canvas.ctx.measureText(this.content).width,this.height=canvas.ctx.measureText("M").width}function text(e,t,i,n,s){var a=new Text(e,t,i,n,s);return stage.addChild(a),a}function keyboard(e){var t={};return t.code=e,t.isDown=!1,t.isUp=!0,t.press=void 0,t.release=void 0,t.downHandler=function(e){e.keyCode===t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1),e.preventDefault()},t.upHandler=function(e){e.keyCode===t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0),e.preventDefault()},window.addEventListener("keydown",t.downHandler.bind(t),!1),window.addEventListener("keyup",t.upHandler.bind(t),!1),t}function makePointer(e,t){var i={element:e,scale:t||1,_x:0,_y:0,get x(){return this._x/this.scale},get y(){return this._y/this.scale},get centerX(){return this.x},get centerY(){return this.y},get position(){return{x:this.x,y:this.y}},isDown:!1,isUp:!0,tapped:!1,downTime:0,elapsedTime:0,press:void 0,release:void 0,tap:void 0,dragSprite:null,dragOffsetX:0,dragOffsetY:0,updateDragAndDrop:function(e){if(this.isDown)if(null===this.dragSprite)for(var t=draggableSprites.length-1;t>-1;t--){var e=draggableSprites[t];if(this.hitTestSprite(e)&&e.draggable){this.dragOffsetX=this.x-e.gx,this.dragOffsetY=this.y-e.gy,this.dragSprite=e;var i=e.parent.children;i.splice(i.indexOf(e),1),i.push(e),draggableSprites.splice(draggableSprites.indexOf(e),1),draggableSprites.push(e);break}}else this.dragSprite.x=this.x-this.dragOffsetX,this.dragSprite.y=this.y-this.dragOffsetY;this.isUp&&(this.dragSprite=null),draggableSprites.some(function(e){return this.hitTestSprite(e)&&e.draggable?(this.element.style.cursor="pointer",!0):(this.element.style.cursor="auto",!1)},this)},moveHandler:function(e){var t=e.target;this._x=e.pageX-t.offsetLeft,this._y=e.pageY-t.offsetTop,e.preventDefault()},touchmoveHandler:function(e){var t=e.target;this._x=e.targetTouches[0].pageX-t.offsetLeft,this._y=e.targetTouches[0].pageY-t.offsetTop,e.preventDefault()},downHandler:function(e){this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(),e.preventDefault()},touchstartHandler:function(e){var t=e.target;this._x=e.targetTouches[0].pageX-t.offsetLeft,this._y=e.targetTouches[0].pageY-t.offsetTop,this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(),e.preventDefault()},upHandler:function(e){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),e.preventDefault()},touchendHandler:function(e){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),e.preventDefault()},hitTestSprite:function(e){var t=!1;if(e.circular){var i=this.x-(e.gx+e.radius),n=this.y-(e.gy+e.radius),s=Math.sqrt(i*i+n*n);t=s<e.radius}else{var a=e.gx,r=e.gx+e.width,o=e.gy,h=e.gy+e.height;t=this.x>a&&this.x<r&&this.y>o&&this.y<h}return t}};return e.addEventListener("mousemove",i.moveHandler.bind(i),!1),e.addEventListener("mousedown",i.downHandler.bind(i),!1),window.addEventListener("mouseup",i.upHandler.bind(i),!1),e.addEventListener("touchmove",i.touchmoveHandler.bind(i),!1),e.addEventListener("touchstart",i.touchstartHandler.bind(i),!1),window.addEventListener("touchend",i.touchendHandler.bind(i),!1),e.style.touchAction="none",i}function hitTestPoint(e,t){var i,n,s,a,r,o,h,c,d;return i=t.radius?"circle":"rectangle","rectangle"===i&&(n=t.x,s=t.x+t.width,a=t.y,r=t.y+t.height,d=e.x>n&&e.x<s&&e.y>a&&e.y<r),"circle"===i&&(o=e.x-t.centerX,h=e.y-t.centerY,c=Math.sqrt(o*o+h*h),d=c<t.radius),d}function hitTestCircle(e,t,i){var n,s,a,r,o,i="undefined"!=typeof i?i:!1;return i?(n=t.gx+t.radius-(e.gx+e.radius),s=t.gy+t.radius-(e.gy+e.radius)):(n=t.centerX-e.centerX,s=t.centerY-e.centerY),a=Math.sqrt(n*n+s*s),r=e.radius+t.radius,o=r>a}function circleCollision(e,t,i,n){var s,a,r,o,h,c,d,n="undefined"!=typeof n?n:!1,i="undefined"!=typeof i?i:!1,l={},u=!1;if(n?(o=t.gx+t.radius-(e.gx+e.radius),h=t.gy+t.radius-(e.gy+e.radius)):(o=t.centerX-e.centerX,h=t.centerY-e.centerY),s=Math.sqrt(o*o+h*h),a=e.radius+t.radius,a>s){u=!0,r=a-s;var f=.3;r+=f,c=o/s,d=h/s,e.x-=r*c,e.y-=r*d,i&&(l.x=h,l.y=-o,bounceOffSurface(e,l))}return u}function movingCircleCollision(e,t,i){var n,s,a,r,i="undefined"!=typeof i?i:!1,o={},h={},c={},d={},l={},u=!1;if(e.mass=e.mass||1,t.mass=t.mass||1,i?(o.vx=t.gx+t.radius-(e.gx+e.radius),o.vy=t.gy+t.radius-(e.gy+e.radius)):(o.vx=t.centerX-e.centerX,o.vy=t.centerY-e.centerY),o.magnitude=Math.sqrt(o.vx*o.vx+o.vy*o.vy),n=e.radius+t.radius,o.magnitude<n){u=!0,s=n-o.magnitude,s+=.3,o.dx=o.vx/o.magnitude,o.dy=o.vy/o.magnitude,o.vxHalf=Math.abs(o.dx*s/2),o.vyHalf=Math.abs(o.dy*s/2),a=e.x>t.x?1:-1,r=e.y>t.y?1:-1,e.x=e.x+o.vxHalf*a,e.y=e.y+o.vyHalf*r,t.x=t.x+o.vxHalf*-a,t.y=t.y+o.vyHalf*-r,o.lx=o.vy,o.ly=-o.vx;var f=e.vx*o.dx+e.vy*o.dy;h.x=f*o.dx,h.y=f*o.dy;var p=e.vx*(o.lx/o.magnitude)+e.vy*(o.ly/o.magnitude);c.x=p*(o.lx/o.magnitude),c.y=p*(o.ly/o.magnitude);var g=t.vx*o.dx+t.vy*o.dy;d.x=g*o.dx,d.y=g*o.dy;var y=t.vx*(o.lx/o.magnitude)+t.vy*(o.ly/o.magnitude);l.x=y*(o.lx/o.magnitude),l.y=y*(o.ly/o.magnitude),e.bounce={},e.bounce.x=c.x+d.x,e.bounce.y=c.y+d.y,t.bounce={},t.bounce.x=h.x+l.x,t.bounce.y=h.y+l.y,e.vx=e.bounce.x/e.mass,e.vy=e.bounce.y/e.mass,t.vx=t.bounce.x/t.mass,t.vy=t.bounce.y/t.mass}return u}function multipleCircleCollision(e,t){for(var t="undefined"!=typeof t?t:!1,i=0;i<e.length;i++)for(var n=e[i],s=i+1;s<e.length;s++){var a=e[s];movingCircleCollision(n,a,t)}}function hitTestCirclePoint(e,t,i){var i="undefined"!=typeof i?i:!1;return t.diameter=1,t.radius=.5,t.centerX=t.x,t.centerY=t.y,t.gx=t.x,t.gy=t.y,hitTestCircle(e,t,i)}function circlePointCollision(e,t,i,n){var n="undefined"!=typeof n?n:!1,i="undefined"!=typeof i?i:!1;return t.diameter=1,t.radius=.5,t.centerX=t.x,t.centerY=t.y,t.gx=t.x,t.gy=t.y,circleCollision(e,t,i,n)}function hitTestRectangle(e,t,i){var n,s,a,r,o,i=i||!1;return n=!1,i?(r=e.gx+e.halfWidth-(t.gx+t.halfWidth),o=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(r=e.centerX-t.centerX,o=e.centerY-t.centerY),s=e.halfWidth+t.halfWidth,a=e.halfHeight+t.halfHeight,n=Math.abs(r)<s&&Math.abs(o)<a?!0:!1}function rectangleCollision(e,t,i,n){var s,a,r,o,h,c,d,n=n||!1,i=i||!1;return n?(c=e.gx+e.halfWidth-(t.gx+t.halfWidth),d=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(c=e.centerX-t.centerX,d=e.centerY-t.centerY),a=e.halfWidth+t.halfWidth,r=e.halfHeight+t.halfHeight,Math.abs(c)<a&&Math.abs(d)<r&&(o=a-Math.abs(c),h=r-Math.abs(d),o>=h?(d>0?(s="top",e.y=e.y+h):(s="bottom",e.y=e.y-h),i&&(e.vy*=-1)):(c>0?(s="left",e.x=e.x+o):(s="right",e.x=e.x-o),i&&(e.vx*=-1))),s}function hitTestCircleRectangle(e,t,i){var n,s,a,r,o,h,i="undefined"!=typeof i?i:!1;if(i?(a=e.gx,r=e.gy,o=t.gx,h=t.gy):(a=e.x,r=e.y,o=t.x,h=t.y),n=r<h-t.halfHeight?a<o-1-t.halfWidth?"topLeft":a>o+1+t.halfWidth?"topRight":"topMiddle":r>h+t.halfHeight?a<o-1-t.halfWidth?"bottomLeft":a>o+1+t.halfWidth?"bottomRight":"bottomMiddle":a<o-t.halfWidth?"leftMiddle":"rightMiddle","topMiddle"===n||"bottomMiddle"===n||"leftMiddle"===n||"rightMiddle"===n)s=hitTestRectangle(e,t,i);else{var c={};switch(n){case"topLeft":c.x=o,c.y=h;break;case"topRight":c.x=o+t.width,c.y=h;break;case"bottomLeft":c.x=o,c.y=h+t.height;break;case"bottomRight":c.x=o+t.width,c.y=h+t.height}s=hitTestCirclePoint(e,c,i)}return s?n:s}function circleRectangleCollision(e,t,i,n){var s,a,r,o,h,c,n="undefined"!=typeof n?n:!1,i="undefined"!=typeof i?i:!1;if(n?(r=e.gx,o=e.gy,h=t.gx,c=t.gy):(r=e.x,o=e.y,h=t.x,c=t.y),s=o<c-t.halfHeight?r<h-1-t.halfWidth?"topLeft":r>h+1+t.halfWidth?"topRight":"topMiddle":o>c+t.halfHeight?r<h-1-t.halfWidth?"bottomLeft":r>h+1+t.halfWidth?"bottomRight":"bottomMiddle":r<h-t.halfWidth?"leftMiddle":"rightMiddle","topMiddle"===s||"bottomMiddle"===s||"leftMiddle"===s||"rightMiddle"===s)a=rectangleCollision(e,t,i,n);else{var d={};switch(s){case"topLeft":d.x=h,d.y=c;break;case"topRight":d.x=h+t.width,d.y=c;break;case"bottomLeft":d.x=h,d.y=c+t.height;break;case"bottomRight":d.x=h+t.width,d.y=c+t.height}a=circlePointCollision(e,d,i,n)}return a?s:a}function hit(e,t,i,n,s,a){function r(e,t){var i=void 0!==e.parent,n=void 0!==t.parent;if(i&&n)return e.diameter&&t.diameter?h(e,t):e.diameter&&!t.diameter?d(e,t):c(e,t);if(n&&void 0!==e.x&&void 0!==e.y)return hitTestPoint(e,t);throw new Error("Im sorry, ${a} and ${b} cannot be use together in a collision test.")}function o(){e instanceof Array&&[e,t].reverse();for(var i=t.length-1;i>=0;i--){var n=t[i];l=r(e,n),l&&a&&a(l,n)}}function h(e,t){return i?e.vx+e.vy!==0&&t.vx+t.vy!==0?movingCircleCollision(e,t,s):circleCollision(e,t,n,s):hitTestCircle(e,t)}function c(e,t){return i?rectangleCollision(e,t,n,s):hitTestRectangle(e,t,s)}function d(e,t){return i?circleRectangleCollision(e,t,n,s):hitTestCircleRectangle(e,t,s)}var l,u=void 0!==e.parent,f=void 0!==t.parent,i="undefined"!=typeof i?i:!1,n="undefined"!=typeof n?n:!1,a="undefined"!=typeof a?a:void 0;return u&&t instanceof Array||f&&e instanceof Array?o():(l=r(e,t),l&&a&&a(l)),l}function particleEffect(e,t,i,n,s,a,r,o,h,c,d,l,u,f,p,g,y,v){function m(n){var a=i();a.frames.length>0&&a.gotoAndStop(b(0,a.frames.length-1)),a.x=e-a.halfWidth,a.y=t-a.halfHeight;var r=b(h,c);a.width=r,a.height=r,a.scaleSpeed=w(u,f),a.alphaSpeed=w(p,g),a.rotationSpeed=w(y,v);var o=w(d,l);a.vx=o*Math.cos(n),a.vy=o*Math.sin(n),a.update=function(){a.vy+=s,a.x+=a.vx,a.y+=a.vy,a.scaleX-a.scaleSpeed>0&&(a.scaleX-=a.scaleSpeed),a.scaleY-a.scaleSpeed>0&&(a.scaleY-=a.scaleSpeed),a.rotation+=a.rotationSpeed,a.alpha-=a.alphaSpeed,a.alpha<=0&&(remove([a]),particles.splice(particles.indexOf(a),1))},particles.push(a)}for(var x,e="undefined"!=typeof e?e:0,t="undefined"!=typeof t?t:0,n="undefined"!=typeof n?n:10,i="undefined"!=typeof i?i:function(){return circle(10,"red")},s="undefined"!=typeof s?s:0,a="undefined"!=typeof a?a:!0,r="undefined"!=typeof r?r:0,o="undefined"!=typeof o?o:6.28,h="undefined"!=typeof h?h:4,c="undefined"!=typeof c?c:16,d="undefined"!=typeof d?d:.1,l="undefined"!=typeof l?l:1,u="undefined"!=typeof u?u:.01,f="undefined"!=typeof f?f:.05,p="undefined"!=typeof p?p:.02,g="undefined"!=typeof g?g:.02,y="undefined"!=typeof y?y:.01,v="undefined"!=typeof v?v:.03,w=function(e,t){return e+Math.random()*(t-e)},b=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},k=[],S=(o-r)/(n-1),M=0;n>M;M++)a?(x=w(r,o),k.push(x)):(void 0===x&&(x=r),k.push(x),x+=S);k.forEach(m)}function emitter(e,t){function i(){a.playing||(t(),r=setInterval(s.bind(this),e),a.playing=!0)}function n(){a.playing&&(clearInterval(r),a.playing=!1)}function s(){t()}var a={},r=void 0;return a.playing=!1,a.play=i,a.stop=n,a}function tilingSprite(e,t,i,n,s){var a,r,n=checkIfUndefined(n,0),s=checkIfUndefined(s,0);i.frame?(a=i.frame.w,r=i.frame.h):(a=i.width,r=i.height),a-=1,r-=2;var o,h;o=e>=a?Math.round(e/a)+1:2,h=t>=r?Math.round(t/r)+1:2;var c=grid(o,h,a,r,!0,0,0,function(){var e=sprite(i);return e});c._tileX=0,c._tileY=0;var d=rectangle(e,t,"#d3d3d3","#d3d3d3");return d.x=n,d.y=s,d.mask=!0,d.addChild(c),Object.defineProperties(d,{tileX:{get:function(){return c._tileX},set:function(e){c.children.forEach(function(t){var i=e-c._tileX;t.x+=i,t.x>(o-1)*a&&(t.x=0-a+i),t.x<0-a-i&&(t.x=(o-1)*a)}),c._tileX=e},enumerable:!0,configurable:!0},tileY:{get:function(){return c._tileY},set:function(e){c.children.forEach(function(t){var i=e-c._tileY;t.y+=i,t.y>(h-1)*r&&(t.y=0-r+i),t.y<0-r-i&&(t.y=(h-1)*r)}),c._tileY=e},enumerable:!0,configurable:!0}}),d}function cubicBezier(e,t,i,n,s){var a=e*e,r=a*e;return t+(3*-t+e*(3*t-t*e))*e+(3*i+e*(-6*i+3*i*e))*e+(3*n-3*n*e)*a+s*r}function tweenProperty(e,t,i,n,s,a,r,o){var a=checkIfUndefined(a,["smoothstep"]),r=checkIfUndefined(r,!1),o=checkIfUndefined(o,0),h={};return"spline"===a[0]&&(h.startMagnitude=a[1],h.endMagnitude=a[2]),h.start=function(e,t){h.startValue=JSON.parse(JSON.stringify(e)),h.endValue=JSON.parse(JSON.stringify(t)),h.playing=!0,h.totalFrames=s,h.frameCounter=0,tweens.push(h)},h.start(i,n),h.update=function(){var i;if(h.playing)if(h.frameCounter<h.totalFrames){var n=h.frameCounter/h.totalFrames;i="spline"!==a[0]?ease[a](n):ease.spline(n,h.startMagnitude,0,1,h.endMagnitude),e[t]=h.endValue*i+h.startValue*(1-i),h.frameCounter+=1}else h.end()},h.end=function(){h.playing=!1,h.onComplete&&h.onComplete(),tweens.splice(tweens.indexOf(h),1),r&&setTimeout(function(){return h.start(h.endValue,h.startValue)},o)},h.play=function(){return h.playing=!0},h.pause=function(){return h.playing=!1},h}function fadeIn(e,t){var t=checkIfUndefined(t,60);return tweenProperty(e,"alpha",e.alpha,1,t,["sine"])}function fadeOut(e,t){var t=checkIfUndefined(t,60);return tweenProperty(e,"alpha",e.alpha,0,t,["sine"])}function pulse(e,t,i){var t=checkIfUndefined(t,60),i=checkIfUndefined(i,0);return tweenProperty(e,"alpha",e.alpha,i,t,["smoothstep"],!0)}function slide(e,t,i,n,s,a,r){var n=checkIfUndefined(n,60),s=checkIfUndefined(s,["smoothstep"]),a=checkIfUndefined(a,!1),r=checkIfUndefined(r,0);return makeTween([[e,"x",e.x,t,n,s,a,r],[e,"y",e.y,i,n,s,a,r]])}function makeTween(e){var t={};t.tweens=[],e.forEach(function(e){var i=tweenProperty.apply(null,e);t.tweens.push(i)});var i=0;return t.completed=function(){i+=1,i===t.tweens.length&&(t.onComplete&&t.onComplete(),i=0)},t.tweens.forEach(function(e){e.onComplete=t.completed()}),t.pause=function(){t.tweens.forEach(function(e){e.playing=!1})},t.play=function(){t.tweens.forEach(function(e){e.playing=!0})},t}function removeTween(e){e.tweens?(e.pause(),e.tweens.forEach(function(e){tweens.splice(tweens.indexOf(e),1)})):(e.pause(),tweens.splice(tweens.indexOf(e),1))}function breathe(e,t,i,n,s,a){var s=checkIfUndefined(s,!0),a=checkIfUndefined(a,0);return makeTween([[e,"scaleX",e.scaleX,t,n,["smoothstepSquared"],s,a],[e,"scaleY",e.scaleY,i,n,["smoothstepSquared"],s,a]])}function scale(e,t,i,n){checkIfUndefined(n,60);return makeTween([[e,"scaleX",e.scaleX,t,n,["smoothstep"],!1],[e,"scaleY",e.scaleY,i,n,["smoothstep"],!1]])}function strobe(e,t,i,n,s,a,r){var t=checkIfUndefined(t,1.3),i=checkIfUndefined(i,10),n=checkIfUndefined(n,20),s=checkIfUndefined(s,10),a=checkIfUndefined(a,!0),r=checkIfUndefined(r,0);return makeTween([[e,"scaleX",e.scaleX,t,s,["spline",i,n],a,r],[e,"scaleY",e.scaleY,t,s,["spline",i,n],a,r]])}function wobble(e,t,i,n,s,a,r,o,h,c,d){var t=checkIfUndefined(t,1.2),i=checkIfUndefined(i,1.2),n=checkIfUndefined(n,10),s=checkIfUndefined(s,10),a=checkIfUndefined(a,10),r=checkIfUndefined(r,-10),o=checkIfUndefined(o,-10),h=checkIfUndefined(h,.98),c=checkIfUndefined(c,!0),d=checkIfUndefined(d,0),l=makeTween([[e,"scaleX",e.scaleX,t,n,["spline",s,a],c,d],[e,"scaleY",e.scaleY,i,n,["spline",r,o],c,d]]);return l.tweens.forEach(function(e){e.onComplete=function(){e.endValue>1&&(e.endValue*=h,e.endValue<=1&&(e.endValue=1,removeTween(e)))}}),l}function walkPath(e,t,i,n,s,a,r){function o(t){var i=makeTween([[e,"x",h[t][0],h[t+1][0],c,n],[e,"y",h[t][1],h[t+1][1],c,n]]);return i.onComplete=function(){t+=1,t<h.length-1?setTimeout(function(){i=o(t)},r):s&&(a&&h.reverse(),setTimeout(function(){t=0,e.x=h[0][0],e.y=h[0][1],i=o(t)},r),t=0,e.x=h[0][0],e.y=h[0][1],i=o(t))},i}var i=checkIfUndefined(i,300),n=checkIfUndefined(n,["smoothstep"]),s=checkIfUndefined(s,!1),a=checkIfUndefined(a,!1),r=checkIfUndefined(r,0),h=JSON.parse(JSON.stringify(t)),c=i/h.length,d=0,l=o(d);return l}function walkCurve(e,t,i,n,s,a,r){function o(i){var c=followCurve(e,t[i],h,n);return c.onComplete=function(){i+=1,i<t.length?setTimeout(function(){c=o(i)},r):s&&(a&&(t.reverse(),t.forEach(function(e){e.reverse()})),setTimeout(function(){i=0,e.x=t[0][0],e.y=t[0][1],c=o(i)},r))},c}var i=checkIfUndefined(i,300),n=checkIfUndefined(n,["smoothstep"]),s=checkIfUndefined(s,!1),a=checkIfUndefined(a,!1),r=checkIfUndefined(r,0),h=i/t.length,c=0,d=o(c);return d}function followCurve(e,t,i,n,s,a){var n=checkIfUndefined(n,["smoothstep"]),s=checkIfUndefined(s,!1),a=checkIfUndefined(a,0),r={};return"spline"===n[0]&&(r.startMagnitude=n[1],r.endMagnitude=n[2]),r.start=function(e){r.playing=!0,r.totalFrames=i,r.frameCounter=0,r.pointsArray=JSON.parse(JSON.stringify(e)),tweens.push(r)},r.start(t),r.update=function(){var t,i,s=r.pointsArray;r.playing&&(r.frameCounter<r.totalFrames?(t=r.frameCounter/r.totalFrames,i="spline"!==n[0]?ease[n](t):ease.spline(t,r.startMagnitude,0,1,r.endMagnitude),e.x=cubicBezier(i,s[0][0],s[1][0],s[2][0],s[3][0]),e.y=cubicBezier(i,s[0][1],s[1][1],s[2][1],s[3][1]),r.frameCounter+=1):r.end())},r.end=function(){r.playing=!1,r.onComplete&&r.onComplete(),tweens.splice(tweens.indexOf(r),1),s&&setTimeout(function(){r.pointsArray=r.pointsArray.reverse(),r.start(r.pointsArray)},a)},r.pause=function(){r.playing=!1},r.play=function(){r.playing=!0},r}function Game(e,t,i,n,s){if(this.canvas=makeCanvas(e,t,"#cccccc","#3b3224"),stage.width=this.canvas.width,stage.height=this.canvas.height,this.pointer=makePointer(this.canvas),this.scale=1,this.state=void 0,this.load=s,this.setup=i,this.assetsToLoad=n,this.paused=!1,this.interpolation=!1,this.fps=15,this.previous=0,this.frameDuration=1e3/this.fps,this.lag=0,_this=this,!i)throw new Error("Please supply the setup function in the constructor")}function game(e,t,i,n,s){var e=checkIfUndefined(e,256),t=checkIfUndefined(t,256);return new Game(e,t,i,n,s)}function capturePreviousPositions(e){function t(e){e.previousX=e.x,e.previousY=e.y,e.children&&e.children.length>0&&e.children.forEach(function(e){t(e)})}e.children.forEach(function(e){t(e)})}if(Modernizr.webaudio){var actx=new AudioContext;Sound.prototype={load:function(){var e=this,t=new XMLHttpRequest;t.open("GET",this.source,!0),t.responseType="arraybuffer",t.addEventListener("load",function(){e.actx.decodeAudioData(t.response,function(t){e.buffer=t,e.hasLoaded=!0,e.loadHandler&&e.loadHandler()},function(e){throw new Error("Audio could not be decoded: "+e)})}),t.send()},play:function(){this.startTime=this.actx.currentTime,this.soundNode=this.actx.createBufferSource(),this.soundNode.buffer=this.buffer,this.soundNode.connect(this.volumeNode),this.reverb===!1?this.volumeNode.connect(this.panNode):(this.volumeNode.connect(this.convolverNode),this.convolverNode.connect(this.panNode),this.convolverNode.buffer=this.reverbImpulse),this.panNode.connect(this.actx.destination),this.echo&&(this.feedbackNode.gain.value=this.feedbackValue,this.delayNode.delayTime.value=this.delayValue,this.filterNode.frequency.value=this.filterValue,this.delayNode.connect(this.feedbackNode),this.filterValue>0?(this.feedbackNode.connect(this.filterNode),this.filterNode.connect(this.delayNode)):this.feedbackNode.connect(this.delayNode),
this.volumeNode.connect(this.delayNode),this.delayNode.connect(this.panNode)),this.soundNode.loop=this.loop,this.soundNode.playbackRate.value=this.playbackRate,this.soundNode.start(this.startTime,this.startOffset%this.buffer.duration),this.playing=!0},pause:function(){this.playing&&(this.soundNode.stop(this.actx.currentTime),this.startOffset+=this.actx.currentTime-this.startTime,this.playing=!1)},restart:function(){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=0,this.play()},playFrom:function(e){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=e,this.play()},setEcho:function(e,t,i){this.delayValue=e||.3,this.feedbackValue=t||.3,this.filterValue=i||0,this.echo=!0},setReverb:function(e,t,i){var e=e||2,t=t||2,i=i||!1;this.reverbImpulse=impulseResponse(e,t,i),this.reverb=!0},get volume(){return this.volumeValue},set volume(e){this.volumeNode.gain.value=e,this.volumeValue=e},get pan(){return this.panNode.pan.value},set pan(e){this.panNode.pan.value=e}}}var assets={toLoad:0,loaded:0,imageExtensions:["png","jpg","gif"],fontExtensions:["ttf","otf","ttc","woff"],jsonExtensions:["json"],audioExtensions:["mp3","ogg","wav","webm"],load:function(e,t){var i=this,n=function(){i.loaded+=1,console.log(assets.loaded),i.toLoad===i.loaded&&(i.toLoad=0,i.loaded=0,console.log("Assets finished loading"),t&&t())};console.log("Loading assets..."),this.toLoad=e.length,e.forEach(function(e){var t=e.split(".").pop();-1!==this.fontExtensions.indexOf(t)?this.loadFont(e,n):-1!==this.imageExtensions.indexOf(t)?this.loadImage(e,n):-1!==this.jsonExtensions.indexOf(t)?this.loadJson(e,n,this):-1!==this.audioExtensions.indexOf(t)?this.loadSound(e,n):-1!==this.audioExtensions.indexOf(t)?this.loadSound(e,n):console.log("File type not recognized: "+e)},this)},loadImage:function(e,t){var i=new Image;i.addEventListener("load",t,!1),this[e]=i,i.src=e},loadFont:function(e,t){var i=e.split("/").pop().split(".")[0],n=new Font;n.onload=function(){t()},n.onerror=function(e){console.log("FontLoadError: ",e)},n.fontFamily=i,n.src=e},loadJson:function(e,t,i){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="text",n.onload=function(s){if(200===n.status){var a=JSON.parse(n.responseText);a.name=e,i[a.name]=a,a.frames?i.createTilesetFrames(a,e,t,i):t()}},n.send()},createTilesetFrames:function(e,t,i,n){function s(){n[r]=o,Object.keys(e.frames).forEach(function(t){n[t]=e.frames[t],n[t].source=o}),i()}var a=t.replace(/[^\/]*$/,""),r=a+e.meta.image,o=new Image;o.addEventListener("load",s,!1),o.src=r},loadSound:function(e,t){var i=makeSound(e,t);i.name=e,this[i.name]=i}},buttons=[],draggableSprites=[],particles=[],tweens=[],shakingSprites=[];DisplayObject.prototype={get gx(){return this.parent?this.x+this.parent.gx:this.x},get gy(){return this.parent?this.y+this.parent.gy:this.y},get layer(){return this._layer},set layer(e){this._layer=e,this.parent&&this.parent.children.sort(function(e,t){return e.layer-t.layer})},addChild:function(e){e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e)},removeChild:function(e){if(e.parent!==this)throw new Error(e+"is not a child of "+this);this.children.splice(this.children.indexOf(e),1)},get halfWidth(){return this.width/2},get halfHeight(){return this.height/2},get centerX(){return this.x+this.halfWidth},get centerY(){return this.y+this.halfHeight},get position(){return{x:this.x,y:this.y}},setPosition:function(e,t){this.x=e,this.y=t},setRadialGradient:function(e,t,i,n,s,a,r,o){this.gradient=!0,this.gradient=canvas.ctx.createRadialGradient(i,n,s,a,r,o),this.gradient.addColorStop(0,e),this.gradient.addColorStop(1,t)},setPattern:function(e,t){this.pattern=!0,this.pattern=canvas.ctx.createPattern(e,t)},get localBounds(){return{x:0,y:0,width:this.width,height:this.height}},get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}},get empty(){return 0===this.children.length?!0:!1},putCenter:function(e,t,i){var n=this,t=t||0,i=i||0;e.x=n.x+n.halfWidth-e.halfWidth+t,e.y=n.y+n.halfHeight-e.halfHeight+i},putTop:function(e,t,i){var n=this,t=t||0,i=i||0;e.x=n.x+n.halfWidth-e.halfWidth+t,e.y=n.y-e.height+i},putRight:function(e,t,i){var n=this,t=t||0,i=i||0;e.x=n.x+n.width+t,e.y=n.y+n.halfHeight-e.halfHeight+i},putBottom:function(e,t,i){var n=this,t=t||0,i=i||0;e.x=n.x+n.halfWidth-e.halfWidth+t,e.y=n.y+n.height+i},putLeft:function(e,t,i){var n=this,t=t||0,i=i||0;e.x=n.x-e.width+t,e.y=n.y+n.halfHeight-e.halfHeight+i},swapChildren:function(e,t){var i=this.children.indexOf(e),n=this.children.indexOf(t);if(-1===i||-1===n)throw new Error("Both objects must be a child of the caller "+this);e.childIndex=n,t.childIndex=i,this.children[i]=t,this.children[n]=e},add:function(e){e.forEach(function(e){this.addChild(e)},this)},remove:function(e){for(var t=e.length-1;t>=0;t--)this.removeChild(e[t])},removeHierarchy:function(e){for(var t=e.length-1;t>=0;t--)e[t].children&&e[t].children.length>0&&e[t].remove(e[t].children),this.removeChild(e[t])},get currentFrame(){return this._currentFrame},get circular(){return this._circular},set circular(e){e===!0&&this._circular===!1&&(Object.defineProperties(this,{diameter:{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!0,configurable:!0},radius:{get:function(){return this.halfWidth},set:function(e){this.width=2*e,this.height=2*e},enumerable:!0,configurable:!0}}),this._circular=!0),e===!1&&this._circular===!0&&(delete this.diameter,delete this.radius,this._circular=!1)},get draggable(){return this._draggable},set draggable(e){e===!0&&(draggableSprites.push(this),this._draggable=!0),e===!1&&draggableSprites.splice(draggableSprites.indexOf(this),1)},get interactive(){return this._interactive},set interactive(e){e===!0&&(makeInteractive(this),buttons.push(this),this._interactive=!0),e===!1&&(buttons.splice(buttons.indexOf(this),1),this._interactive=!1)}};var stage=new DisplayObject;Group.prototype=new DisplayObject,Group.prototype.constructor=Group,Group.prototype.addChild=function(e){e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.calculateSize()},Group.prototype.removeChild=function(e){if(e.parent!==this)throw new Error(e+"is not a child of "+this);this.children.splice(this.children.indexOf(e),1),this.calculateSize()},Group.prototype.calculateSize=function(){this.children.length>0&&(this._newWidth=0,this._newHeight=0,this.children.forEach(function(e){e.x+e.width>this._newWidth&&(this._newWidth=e.x+e.width),e.y+e.height>this._newHeight&&(this._newHeight=e.y+e.height)},this),this.width=this._newWidth,this.height=this._newHeight)},Sprite.prototype=new DisplayObject,Sprite.prototype.constructor=Sprite,Sprite.prototype.createFromImage=function(e){if(!(e instanceof Image))throw new Error(e+" is not an image object");this.source=e,this.sourceX=0,this.sourceY=0,this.width=e.width,this.height=e.height,this.sourceWidth=e.width,this.sourceHeight=e.height},Sprite.prototype.createFromAtlas=function(e){this.tilesetFrame=e,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h},Sprite.prototype.createFromTileset=function(e){if(!(e.image instanceof Image))throw new Error(e.image+" is not an image object");this.source=e.image,this.sourceX=e.x,this.sourceY=e.y,this.width=e.width,this.height=e.height,this.sourceWidth=e.width,this.sourceHeight=e.height},Sprite.prototype.createFromTilesetFrames=function(e){if(!(e.image instanceof Image))throw new Error(e.image+" is not an image object");this.source=e.image,this.frames=e.data,this.sourceX=this.frames[0][0],this.sourceY=this.frames[0][1],this.width=e.width,this.height=e.height,this.sourceWidth=e.width,this.sourceHeight=e.height},Sprite.prototype.createFromAtlasFrames=function(e){this.frames=e,this.source=e[0].source,this.sourceX=e[0].frame.x,this.sourceY=e[0].frame.y,this.width=e[0].frame.w,this.height=e[0].frame.h,this.sourceWidth=e[0].frame.w,this.sourceHeight=e[0].frame.h},Sprite.prototype.createFromImages=function(e){this.frames=e,this.source=e[0],this.sourceX=0,this.sourceY=0,this.width=e[0].width,this.height=e[0].width,this.sourceWidth=e[0].width,this.sourceHeight=e[0].height},Sprite.prototype.gotoAndStop=function(e){if(!(this.frames.length>0&&e<this.frames.length))throw new Error("Frame number "+e+" does not exist");this.frames[0]instanceof Array?(this.sourceX=this.frames[e][0],this.sourceY=this.frames[e][1]):this.frames[e].frame?(this.sourceX=this.frames[e].frame.x,this.sourceY=this.frames[e].frame.y,this.sourceWidth=this.frames[e].frame.w,this.sourceHeight=this.frames[e].frame.h,this.width=this.frames[e].frame.w,this.height=this.frames[e].frame.h):(this.source=this.frames[e],this.sourceX=0,this.sourceY=0,this.width=this.source.width,this.height=this.source.height,this.sourceWidth=this.source.width,this.sourceHeight=this.source.height),this._currentFrame=e},Sprite.prototype.render=function(e){e.drawImage(this.source,Math.round(this.sourceX),Math.round(this.sourceY),Math.round(this.sourceWidth),Math.round(this.sourceHeight),Math.round(-this.width*this.pivotX),Math.round(-this.height*this.pivotY),Math.round(this.width),Math.round(this.height))},Button.prototype=new Sprite,Button.prototype.constructor=Button;var progressBar={maxWidth:0,height:0,backgroundColor:"gray",foregroundColor:"cyan",backBar:null,frontBar:null,percentage:null,assets:null,initialized:!1,create:function(e,t){this.initialized||(this.assets=t,this.maxWidth=e.width/2,this.backBar=rectangle(this.maxWidth,32,this.backgroundColor),this.backBar.x=e.width/2-this.maxWidth/2,this.backBar.y=e.height/2-16,this.frontBar=rectangle(this.maxWidth,32,this.foregroundColor),this.frontBar.x=e.width/2-this.maxWidth/2,this.frontBar.y=e.height/2-16,this.percentage=text("0%","28px sans-serif","black"),this.percentage.x=e.width/2-this.maxWidth/2+12,this.percentage.y=e.height/2-16,this.initialized=!0)},update:function(){var e=(this.assets.loaded+1)/this.assets.toLoad;this.frontBar.width=this.maxWidth*e,this.percentage.content=Math.floor(100*e)+"%"},remove:function(){remove([this.frontBar,this.backBar,this.percentage])}};Rectangle.prototype=new DisplayObject,Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.render=function(e){e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,this.gradient?e.fillStyle=this.gradient:this.pattern?e.fillStyle=this.pattern:e.fillStyle=this.fillStyle,e.beginPath(),e.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),"none"!==this.strokeStyle&&e.stroke(),"none"!==this.fillStyle&&e.fill(),this.mask&&this.mask===!0&&e.clip()},Circle.prototype=new DisplayObject,Circle.prototype.constructor=Circle,Circle.prototype.render=function(e){e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,this.gradient?e.fillStyle=this.gradient:e.fillStyle=this.fillStyle,e.beginPath(),e.arc(this.radius+-this.diameter*this.pivotX,this.radius+-this.diameter*this.pivotY,this.radius,0,2*Math.PI,!1),"none"!==this.strokeStyle&&e.stroke(),"none"!==this.fillStyle&&e.fill(),this.mask&&this.mask===!0&&e.clip()},Ellipse.prototype=new DisplayObject,Ellipse.prototype.constructor=Ellipse,Ellipse.prototype.render=function(e){e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.fillStyle=this.fillStyle,e.beginPath(),e.moveTo(this.x,this.y-this.height/2),e.bezierCurveTo(this.x+this.width/2,this.y-this.height/2,this.x+this.width/2,this.y+this.height/2,this.x,this.y+this.height/2),e.bezierCurveTo(this.x-this.width/2,this.y+this.height/2,this.x-this.width/2,this.y-this.height/2,this.x,this.y-this.height/2),"none"!==this.strokeStyle&&e.stroke(),"none"!==this.fillStyle&&e.fill(),this.mask&&this.mask===!0&&e.clip()},Line.prototype=new DisplayObject,Line.prototype.constructor=Line,Line.prototype.render=function(e){e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.lineJoin=this.lineJoin,e.beginPath(),e.moveTo(this.ax,this.ay),e.lineTo(this.bx,this.by),"none"!==this.strokeStyle&&e.stroke()},Text.prototype=new DisplayObject,Text.prototype.constructor=Text,Text.prototype.render=function(e){e.font=this.font,e.lineWidth=this.lineWidth,e.fillStyle=this.fillStyle,e.translate(-this.width*this.pivotX,-this.height*this.pivotY),e.textBaseline=this.textBaseline,e.fillText(this.content,0,0),"none"!==this.strokeText&&e.strokeText()};var linear=function(e){return e},smoothstep=function(e){return e*e*(3-2*e)},smoothstepSquared=function(e){return Math.pow(e*e*(3-2*e),2)},smoothstepCubed=function(e){return Math.pow(e*e*(3-2*e),3)},acceleration=function(e){return e*e},accelerationCubed=function(e){return Math.pow(e*e,3)},deceleration=function(e){return 1-Math.pow(1-e,2)},decelerationCubed=function(e){return 1-Math.pow(1-e,3)},sine=function(e){return Math.sin(e*Math.PI/2)},sineSquared=function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},sineCubed=function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},inverseSine=function(e){return 1-Math.sin((1-e)*Math.PI/2)},inverseSineSquared=function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),2)},inverseSineCubed=function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),3)},sineComplete=function(e){return.5-.5*Math.cos(-e*Math.PI)},weightedAverage=function(e,t,i){return(e*(i-1)+t)/i},spline=function(e,t,i,n,s){return.5*(2*i+(-t+n)*e+(2*t-5*i+4*n-s)*e*e+(-t+3*i-3*n+s)*e*e*e)},ease={linear:function(e){return e},smoothstep:function(e){return e*e*(3-2*e)},smoothstepSquared:function(e){return Math.pow(e*e*(3-2*e),2)},smoothstepCubed:function(e){return Math.pow(e*e*(3-2*e),3)},acceleration:function(e){return e*e},accelerationCubed:function(e){return Math.pow(e*e,3)},deceleration:function(e){return 1-Math.pow(1-e,2)},decelerationCubed:function(e){return 1-Math.pow(1-e,3)},sine:function(e){return Math.sin(e*Math.PI/2)},sineSquared:function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},sineCubed:function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},inverseSine:function(e){return 1-Math.sin((1-e)*Math.PI/2)},inverseSineSquared:function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),2)},inverseSineCubed:function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),3)},spline:function(e,t,i,n,s){return.5*(2*i+(-t+n)*e+(2*t-5*i+4*n-s)*e*e+(-t+3*i-3*n+s)*e*e*e)}};Game.prototype={gameLoop:function(e){requestAnimationFrame(this.gameLoop.bind(this)),this.updateGameEffects(),this.state&&!this.paused&&this.state(),render(this.canvas)},start:function(){this.assetsToLoad?(setTimeout(function(){assets.load(_this.assetsToLoad,function(){_this.state=void 0,_this.setup()})},0),this.load&&(this.state=this.load)):this.setup(),this.gameLoop()},pause:function(){this.paused=!0},resume:function(){this.paused=!1},scaleToWindow:function(e){var t,i,n,s,e=checkIfUndefined(e,"#2C3539");if(t=window.innerWidth/this.canvas.width,i=window.innerHeight/this.canvas.height,n=Math.min(t,i),n=Math.round(n),this.canvas.style.transformOrigin="0 0",this.canvas.style.transform="scale("+n+")",s=this.canvas.width>this.canvas.height?"vertically":"horizontally","horizontally"===s){var a=(window.innerHeight-this.canvas.height*t)/2;this.canvas.style.marginTop=a+"px",this.canvas.style.marginBottom=a+"px"}if("vertically"===s){var a=(window.innerWidth-this.canvas.width*i)/2;this.canvas.style.marginLeft=a+"px",this.canvas.style.marginRight=a+"px"}this.canvas.style.paddingLeft=0,this.canvas.style.paddingRight=0,this.canvas.style.display="block",document.body.style.backgroundColor=e,this.pointer.scale=n,this.scale=n},updateGameEffects:function(){if(buttons.length>0&&(this.canvas.style.cursor="auto",buttons.forEach(function(e){e.update(this.pointer,this.canvas),("over"===e.state||"down"===e.state)&&void 0!==e.parent&&(this.canvas.style.cursor="pointer")},this)),particles.length>0)for(var e=particles.length-1;e>=0;e--){var t=particles[e];t.update()}if(tweens.length>0)for(var e=tweens.length-1;e>=0;e--){var i=tweens[e];i&&i.update()}if(shakingSprites.length>0)for(var e=shakingSprites.length-1;e>=0;e--){var n=shakingSprites[e];n.updateShake&&n.updateShake()}draggableSprites.length>0&&this.pointer.updateDragAndDrop(draggableSprites)}};