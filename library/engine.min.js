function Sound(t,e){this.source=t,this.loadHandler=e,this.actx=actx,this.volumeNode=this.actx.createGain(),this.panNode=this.actx.createStereoPanner(),this.soundNode=null,this.buffer=null,this.loop=!1,this.playing=!1,this.panValue=0,this.volumeValue=1,this.startTime=0,this.startOffset=0,this.playbackRate=1,this.echo=!1,this.delayValue=.3,this.feedbackValue=.3,this.filterValue=0,this.delayNode=this.actx.createDelay(),this.feedbackNode=this.actx.createGain(),this.filterNode=this.actx.createBiquadFilter(),this.convolverNode=this.actx.createConvolver(),this.reverb=!1,this.reverbImpulse=null,this.load()}function makeSound(t,e){return new Sound(t,e)}function impulseResponse(t,e,i){var t=t||2,e=e||2,i=i||!1,n=actx.sampleRate*t;console.log(t);for(var s=actx.createBuffer(2,n,actx.sampleRate),a=s.getChannelData(0),r=s.getChannelData(1),o=0;n>o;o++){var h;h=i?n-o:o,a[o]=(2*Math.random()-1)*Math.pow(1-h/n,e),r[o]=(2*Math.random()-1)*Math.pow(1-h/n,e)}return s}function playNote(t,e,i){var e=e||1,i=i||"sine",n=actx.createOscillator(),s=actx.createGain();n.connect(s),s.connect(actx.destination),n.type=i,n.frequency.value=t,s.gain.linearRampToValueAtTime(1,actx.currentTime),s.gain.linearRampToValueAtTime(0,actx.currentTime+e),n.start(actx.currentTime)}function soundEffect(t,e,i,n,s,a,r,o,h,c,l,d,u){function f(t){var e=actx.createConvolver();e.buffer=impulseResponse(u[0],u[1],u[2]),t.connect(e),e.connect(S)}function p(t){var e=actx.createGain(),i=actx.createDelay(),n=actx.createBiquadFilter();i.delayTime.value=d[0],e.gain.value=d[1],d[2]&&(n.frequency.value=d[2]),i.connect(e),d[2]?(e.connect(n),n.connect(i)):e.connect(i),t.connect(i),i.connect(S)}function g(t){t.gain.value=0,t.gain.linearRampToValueAtTime(0,actx.currentTime+r),t.gain.linearRampToValueAtTime(s,actx.currentTime+r+e)}function v(t){t.gain.linearRampToValueAtTime(s,actx.currentTime+e+r),t.gain.linearRampToValueAtTime(0,actx.currentTime+r+e+i)}function y(t){var n=t.frequency.value;h?(t.frequency.linearRampToValueAtTime(n,actx.currentTime+r),t.frequency.linearRampToValueAtTime(n+o,actx.currentTime+r+e+i)):(t.frequency.linearRampToValueAtTime(n,actx.currentTime+r),t.frequency.linearRampToValueAtTime(n-o,actx.currentTime+r+e+i))}function m(){var t=actx.createOscillator(),n=actx.createOscillator(),a=actx.createGain(),r=actx.createGain();a.gain.value=s,r.gain.value=s,t.connect(a),a.connect(actx.destination),n.connect(r),r.connect(actx.destination),t.type="sawtooth",n.type="sawtooth",t.frequency.value=M+l,n.frequency.value=M-l,e>0&&(g(a),g(r)),i>0&&(v(a),v(r)),o>0&&(y(t),y(n)),d&&(p(a),p(r)),u&&(f(a),f(r)),x(t),x(n)}function x(t){t.start(actx.currentTime+r)}var e=e||0,i=i||1,n=n||"sine",s=s||1,a=a||0,r=r||0,o=o||0,h=h||!1,c=c||0,l=l||0,d=d||void 0,u=u||void 0,w=actx.createOscillator(),b=actx.createGain(),S=actx.createStereoPanner();w.connect(b),b.connect(S),S.connect(actx.destination),b.gain.value=s,S.pan.value=a,w.type=n;var M,T=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};M=c>0?T(t-c/2,t+c/2):t,w.frequency.value=M,e>0&&g(b),i>0&&v(b),o>0&&y(w),d&&p(b),u&&f(b),l>0&&m(),x(w)}function shootSound(){soundEffect(1046.5,0,.3,"sawtooth",.5,-.8,0,1200,!1,0,25,[.2,.2,2e3],void 0)}function explosionSound(){soundEffect(16,0,1,"sawtooth",1,0,0,0,!1,0,50,void 0,void 0)}function jumpSound(){soundEffect(523.25,.05,.2,"sine",1.5,.8,0,600,!0,100,0,void 0,void 0)}function distance(t,e){var i=e.centerX-t.centerX,n=e.centerY-t.centerY;return Math.sqrt(i*i+n*n)}function followEase(t,e,i){var n=e.centerX-t.centerX,s=e.centerY-t.centerY,a=Math.sqrt(n*n+s*s);a>=1&&(t.x+=n*i,t.y+=s*i)}function followConstant(t,e,i){var n=e.centerX-t.centerX,s=e.centerY-t.centerY,a=Math.sqrt(n*n+s*s);a>=i&&(t.x+=n/a*i,t.y+=s/a*i)}function angle(t,e){return Math.atan2(e.centerY-t.centerY,e.centerX-t.centerX)}function rotateSprite(t,e,i,n){t.x=e.centerX-t.parent.x+i*Math.cos(n)-t.halfWidth,t.y=e.centerY-t.parent.y+i*Math.sin(n)-t.halfWidth}function rotatePoint(t,e,i,n,s){var a={};return a.x=t+Math.cos(s)*i,a.y=e+Math.sin(s)*n,a}function shoot(t,e,i,n,s,a){var r=a();r.rotation=t.rotation,r.x=t.centerX-r.halfWidth+i*Math.cos(e),r.y=t.centerY-r.halfHeight+i*Math.sin(e),r.vx=Math.cos(e)*n,r.vy=Math.sin(e)*n,s.push(r)}function outsideBounds(t,e,i){var n,s=e.x,a=e.y,r=e.width,o=e.height;return t.x<s-t.width&&(n="left"),t.y<a-t.height&&(n="top"),t.x>r&&(n="right"),t.y>o&&(n="bottom"),n&&i&&i(n),n}function move(t){if(1===t.length){var e=t[0];e.x+=e.vx,e.y+=e.vy}else for(var i=0;i<t.length;i++){var e=t[i];e.x+=e.vx,e.y+=e.vy}}function makeCanvas(t,e,i,n){var t=t||256,e=e||256,i=i||"1px dashed black",n=n||"white",s=document.createElement("canvas");return s.id="canvas",s.width=t,s.height=e,s.style.border=i,s.style.backgroundColor=n,document.body.appendChild(s),s.ctx=s.getContext("2d"),s}function getCanvas(t,e,i,n){var s=document.getElementById("container");s.style.width=t+"px",s.style.height=e+"px";var a=document.getElementById("menu");a.style.width=t+"px",a.style.height=e+"px";var r=document.getElementById("game");return r.width=t,r.height=e,r.style.border=i,r.style.backgroundColor=n,r.ctx=r.getContext("2d"),r}function DisplayObject(){this.x=0,this.y=0,this.width=0,this.height=0,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.pivotX=.5,this.pivotY=.5,this.vx=0,this.vy=0,this._layer=0,this.children=[],this.parent=void 0,this.shadow=!1,this.shadowColor="black",this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowBlur=3,this.blendMode=void 0,this.pattern=!1,this.frames=[],this.loop=!0,this._currentFrame=0,this.playing=!1,this._draggable=void 0,this._circular=!1,this._interactive=!1}function remove(t){for(var e=t.length-1;e>=0;e--)t[e].parent.removeChild(t[e])}function render(t){function e(n){n.visible&&n.gx<t.width+n.width&&n.gx+n.width>=-n.width&&n.gy<t.height+n.height&&n.gy+n.height>=-n.height&&(i.save(),i.translate(n.x+n.width*n.pivotX,n.y+n.height*n.pivotY),i.rotate(n.rotation),i.globalAlpha=n.alpha*n.parent.alpha,i.scale(n.scaleX,n.scaleY),n.shadow&&(i.shadowColor=n.shadowColor,i.shadowOffsetX=n.shadowOffsetX,i.shadowOffsetY=n.shadowOffsetY,i.shadowBlur=n.shadowBlur),n.blendMode&&(i.globalCompositeOperation=n.blendMode),n.render&&n.render(i),n.children&&n.children.length>0&&(i.translate(-n.width*n.pivotX,-n.height*n.pivotY),n.children.forEach(function(t){e(t)})),i.restore())}var i=t.ctx;i.clearRect(0,0,t.width,t.height),stage.children.forEach(e)}function Group(t){DisplayObject.call(this),t.forEach(function(t){this.addChild(t)},this)}function group(t){var e=new Group(t);return stage.addChild(e),e}function Sprite(t,e,i){if(DisplayObject.call(this),this.x=e||0,this.y=i||0,t)if(t instanceof Image)this.createFromImage(t);else if(t.frame)this.createFromAtlas(t);else if(t.image&&!t.data)this.createFromTileset(t);else if(t.image&&t.data)this.createFromTilesetFrames(t);else{if(!(t instanceof Array))throw new Error("The image source "+t+" is not recognized");if(t[0]&&t[0].source)this.createFromAtlasFrames(t);else{if(!(t[0]instanceof Image))throw new Error("The image sources in "+t+" are not recognized");this.createFromImages(t)}}}function sprite(t,e,i){var n=new Sprite(t,e,i);return n.frames.length>0&&addStatePlayer(n),stage.addChild(n),n}function frame(t,e,i,n,s){var a={};return a.image=t,a.x=e,a.y=i,a.width=n,a.height=s,a}function frames(t,e,i,n){var s={};return s.image=t,s.data=e,s.width=i,s.height=n,s}function randomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function contain(t,e,i,n){var s,a=e.x,r=e.y,o=e.width,h=e.height,c=i||!1,l=n||void 0;return t.x<a&&(c&&(t.vx*=-1),t.mass&&(t.vx/=t.mass),t.x=a,s="left"),t.y<r&&(c&&(t.vy*=-1),t.mass&&(t.vy/=t.mass),t.y=r,s="top"),t.x+t.width>o&&(c&&(t.vx*=-1),t.mass&&(t.vx/=t.mass),t.x=o-t.width,s="right"),t.y+t.height>h&&(c&&(t.vy*=-1),t.mass&&(t.vy/=t.mass),t.y=h-t.height,s="bottom"),s&&l&&l(s),s}function renderWithInterpolation(t,e){function i(s){s.visible&&s.gx<t.width+s.width&&s.gx+s.width>-s.width&&s.gy<t.height+s.height&&s.gy+s.height>-s.height&&(n.save(),void 0!==s.previousX?s.renderX=(s.x-s.previousX)*e+s.previousX:s.renderX=s.x,void 0!==s.previousY?s.renderY=(s.y-s.previousY)*e+s.previousY:s.renderY=s.y,n.translate(s.renderX+s.width*s.pivotX,s.renderY+s.height*s.pivotY),n.rotate(s.rotation),n.globalAlpha=s.alpha*s.parent.alpha,n.scale(s.scaleX,s.scaleY),s.shadow&&(n.shadowColor=s.shadowColor,n.shadowOffsetX=s.shadowOffsetX,n.shadowOffsetY=s.shadowOffsetY,n.shadowBlur=s.shadowBlur),s.blendMode&&(n.globalCompositeOperation=s.blendMode),s.render&&s.render(n),s.children&&s.children.length>0&&(n.translate(-s.width*s.pivotX,-s.height*s.pivotY),s.children.forEach(i)),n.restore())}var n=t.ctx;n.clearRect(0,0,t.width,t.height),stage.children.forEach(i)}function Button(t,e,i){Sprite.call(this,t,e,i),this.x=e||0,this.y=i||0,this.interactive=!0}function button(t,e,i){var n=new Button(t,e,i);return stage.addChild(n),n}function makeInteractive(t){t.press=t.press||void 0,t.release=t.release||void 0,t.over=t.over||void 0,t.out=t.out||void 0,t.tap=t.tap||void 0,t.state="up",t.action="",t.pressed=!1,t.hoverOver=!1,t.update=function(e,i){var n=e.hitTestSprite(t);e.isUp&&(t.state="up",t instanceof Button&&t.gotoAndStop(0)),n&&(t.state="over",t.frames&&3===t.frames.length&&t instanceof Button&&t.gotoAndStop(1),e.isDown&&(t.state="down",t instanceof Button&&(3===t.frames.length?t.gotoAndStop(2):t.gotoAndStop(1)))),"down"===t.state&&(t.pressed||(t.press&&t.press(),t.pressed=!0,t.action="pressed")),"over"===t.state&&(t.pressed&&(t.release&&t.release(),t.pressed=!1,t.action="released",e.tapped&&t.tap&&t.tap()),t.hoverOver||(t.over&&t.over(),t.hoverOver=!0)),"up"===t.state&&(t.pressed&&(t.release&&t.release(),t.pressed=!1,t.action="released"),t.hoverOver&&(t.out&&t.out(),t.hoverOver=!1))}}function grid(t,e,i,n,s,a,r,o,h){var t=t||0,e=e||0,i=i||32,n=n||32,s=s||!1,a=a||0,r=r||0,o=o||void 0,h=h||void 0,c=group([]),l=function(){for(var l=t*e,d=0;l>d;d++){var u=d%t*i,f=Math.floor(d/t)*n,p=o();c.addChild(p),s?(p.x=u+i/2-p.halfWidth+a,p.y=f+n/2-p.halfHeight+r):(p.x=u+a,p.y=f+r),h&&h(p)}};return l(),c}function addStatePlayer(t){function e(e){r(),t.gotoAndStop(e)}function i(){t.playing||s([0,t.frames.length-1])}function n(){t.playing&&(r(),t.gotoAndStop(t.currentFrame))}function s(e){r(),c=e[0],l=e[1],h=l-c,0===c&&(h+=1,o+=1),1===h&&(h=2,o+=1),t.fps||(t.fps=12);var i=1e3/t.fps;t.gotoAndStop(c),t.playing||(d=setInterval(a.bind(this),i),t.playing=!0)}function a(){h>o?(t.gotoAndStop(t.currentFrame+1),o+=1):t.loop&&(t.gotoAndStop(c),o=1)}function r(){void 0!==d&&t.playing===!0&&(t.playing=!1,o=0,c=0,l=0,h=0,clearInterval(d))}var o=0,h=0,c=0,l=0,d=void 0;t.show=e,t.play=i,t.stop=n,t.playSequence=s}function filmstrip(t,e,i,n){for(var n=n||0,s=[],a=t.width/e,r=t.height/i,o=a*r,h=0;o>h;h++){var c=h%a*e,l=Math.floor(h/a)*i;n&&n>0&&(c+=n+n*h%a,l+=n+n*Math.floor(h/a)),s.push([c,l])}return frames(t,s,e,i)}function shake(t,e,i,n){function s(){o>r&&(t.x=h,t.y=c,e-=d,t.x+=u(-e,e),t.y+=u(-e,e),r+=1),r>=o&&(t.x=h,t.y=c,shakingSprites.splice(shakingSprites.indexOf(t),1))}function a(){o>r&&(t.rotation=l,e-=d,t.rotation=e*f,r+=1,f*=-1),r>=o&&(t.rotation=l,shakingSprites.splice(shakingSprites.indexOf(t),1))}var e=e||16,i=i||!1,r=1,o=n||10,h=t.x,c=t.y,l=t.rotation,d=e/o,u=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};-1===shakingSprites.indexOf(t)&&(shakingSprites.push(t),t.updateShake=function(){i?a():s()});var f=1}function Rectangle(t,e,i,n,s,a,r){DisplayObject.call(this),this.width=t||32,this.height=e||32,this.fillStyle=i||"#d3d3d3",this.strokeStyle=n||"#d3d3d3",this.lineWidth=s||0,this.x=a||0,this.y=r||0,this.mask=!1}function rectangle(t,e,i,n,s,a,r){var o=new Rectangle(t,e,i,n,s,a,r);return stage.addChild(o),o}function Circle(t,e,i,n,s,a){DisplayObject.call(this),this.circular=!0,this.diameter=t||32,this.fillStyle=e||"#d3d3d3",this.strokeStyle=i||"#d3d3d3",this.lineWidth=n||0,this.x=s||0,this.y=a||0,this.mask=!1}function circle(t,e,i,n,s,a){var r=new Circle(t,e,i,n,s,a);return stage.addChild(r),r}function Ellipse(t,e,i,n,s,a,r){DisplayObject.call(this),this.x=t||0,this.y=e||0,this.width=i,this.height=n,this.fillStyle=s||"black",this.strokeStyle=a||"#d3d3d3",this.lineWidth=r||0,this.mask=!1}function ellipse(t,e,i,n,s,a,r){var o=new Ellipse(t,e,i,n,s,a,r);return stage.addChild(o),o}function Line(t,e,i,n,s,a){DisplayObject.call(this),this.ax=i||0,this.ay=n||0,this.bx=s||32,this.by=a||32,this.strokeStyle=t||"#d3d3d3",this.lineWidth=e||0,this.lineJoin="round"}function line(t,e,i,n,s,a){var r=new Line(t,e,i,n,s,a);return stage.addChild(r),r}function Text(t,e,i,n,s){DisplayObject.call(this),this.content=t||"Hello",this.font=e||"12px sans-serif",this.fillStyle=i||"#d3d3d3",this.x=n||0,this.y=s||0,this.textBaseline="top",this.strokeText="none",g.canvas.ctx.font=this.font,g.canvas.ctx.textBaseline="top",this.width=g.canvas.ctx.measureText(this.content).width,this.height=g.canvas.ctx.measureText("M").width}function text(t,e,i,n,s){var a=new Text(t,e,i,n,s);return stage.addChild(a),a}function keyboard(t){var e={};return e.code=t,e.isDown=!1,e.isUp=!0,e.press=void 0,e.release=void 0,e.downHandler=function(t){t.keyCode===e.code&&(e.isUp&&e.press&&e.press(),e.isDown=!0,e.isUp=!1),t.preventDefault()},e.upHandler=function(t){t.keyCode===e.code&&(e.isDown&&e.release&&e.release(),e.isDown=!1,e.isUp=!0),t.preventDefault()},window.addEventListener("keydown",e.downHandler.bind(e),!1),window.addEventListener("keyup",e.upHandler.bind(e),!1),e}function makePointer(t,e){var i={element:t,scale:e||1,_x:0,_y:0,get x(){return this._x/this.scale},get y(){return this._y/this.scale},get centerX(){return this.x},get centerY(){return this.y},get position(){return{x:this.x,y:this.y}},isDown:!1,isUp:!0,tapped:!1,downTime:0,elapsedTime:0,press:void 0,release:void 0,tap:void 0,dragSprite:null,dragOffsetX:0,dragOffsetY:0,updateDragAndDrop:function(t){if(this.isDown)if(null===this.dragSprite)for(var e=draggableSprites.length-1;e>-1;e--){var t=draggableSprites[e];if(this.hitTestSprite(t)&&t.draggable){this.dragOffsetX=this.x-t.gx,this.dragOffsetY=this.y-t.gy,this.dragSprite=t;var i=t.parent.children;i.splice(i.indexOf(t),1),i.push(t),draggableSprites.splice(draggableSprites.indexOf(t),1),draggableSprites.push(t);break}}else this.dragSprite.x=this.x-this.dragOffsetX,this.dragSprite.y=this.y-this.dragOffsetY;this.isUp&&(this.dragSprite=null),draggableSprites.some(function(t){return this.hitTestSprite(t)&&t.draggable?(this.element.style.cursor="pointer",!0):(this.element.style.cursor="auto",!1)},this)},moveHandler:function(t){var e=t.target;this._x=t.pageX-e.offsetLeft,this._y=t.pageY-e.offsetTop,t.preventDefault()},touchmoveHandler:function(t){var e=t.target;this._x=t.targetTouches[0].pageX-e.offsetLeft,this._y=t.targetTouches[0].pageY-e.offsetTop,t.preventDefault()},downHandler:function(t){this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(),t.preventDefault()},touchstartHandler:function(t){var e=t.target;this._x=t.targetTouches[0].pageX-e.offsetLeft,this._y=t.targetTouches[0].pageY-e.offsetTop,this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(),t.preventDefault()},upHandler:function(t){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),t.preventDefault()},touchendHandler:function(t){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),t.preventDefault()},hitTestSprite:function(t){var e=!1;if(t.circular){var i=this.x-(t.gx+t.radius),n=this.y-(t.gy+t.radius),s=Math.sqrt(i*i+n*n);e=s<t.radius}else{var a=t.gx,r=t.gx+t.width,o=t.gy,h=t.gy+t.height;e=this.x>a&&this.x<r&&this.y>o&&this.y<h}return e}};return t.addEventListener("mousemove",i.moveHandler.bind(i),!1),t.addEventListener("mousedown",i.downHandler.bind(i),!1),window.addEventListener("mouseup",i.upHandler.bind(i),!1),t.addEventListener("touchmove",i.touchmoveHandler.bind(i),!1),t.addEventListener("touchstart",i.touchstartHandler.bind(i),!1),window.addEventListener("touchend",i.touchendHandler.bind(i),!1),t.style.touchAction="none",i}function hitTestPoint(t,e){var i,n,s,a,r,o,h,c,l;return i=e.radius?"circle":"rectangle","rectangle"===i&&(n=e.x,s=e.x+e.width,a=e.y,r=e.y+e.height,l=t.x>n&&t.x<s&&t.y>a&&t.y<r),"circle"===i&&(o=t.x-e.centerX,h=t.y-e.centerY,c=Math.sqrt(o*o+h*h),l=c<e.radius),l}function hitTestCircle(t,e,i){var n,s,a,r,o,i="undefined"!=typeof i?i:!1;return i?(n=e.gx+e.radius-(t.gx+t.radius),s=e.gy+e.radius-(t.gy+t.radius)):(n=e.centerX-t.centerX,s=e.centerY-t.centerY),a=Math.sqrt(n*n+s*s),r=t.radius+e.radius,o=r>a}function circleCollision(t,e,i,n){var s,a,r,o,h,c,l,n=n||!1,i=i||!1,d={},u=!1;if(n?(o=e.gx+e.radius-(t.gx+t.radius),h=e.gy+e.radius-(t.gy+t.radius)):(o=e.centerX-t.centerX,h=e.centerY-t.centerY),s=Math.sqrt(o*o+h*h),a=t.radius+e.radius,a>s){u=!0,r=a-s;var f=.3;r+=f,c=o/s,l=h/s,t.x-=r*c,t.y-=r*l,i&&(d.x=h,d.y=-o,bounceOffSurface(t,d))}return u}function movingCircleCollision(t,e,i){var n,s,a,r,i=i||!1,o={},h={},c={},l={},d={},u=!1;if(t.mass=t.mass||1,e.mass=e.mass||1,i?(o.vx=e.gx+e.radius-(t.gx+t.radius),o.vy=e.gy+e.radius-(t.gy+t.radius)):(o.vx=e.centerX-t.centerX,o.vy=e.centerY-t.centerY),o.magnitude=Math.sqrt(o.vx*o.vx+o.vy*o.vy),n=t.radius+e.radius,o.magnitude<n){u=!0,s=n-o.magnitude,s+=.3,o.dx=o.vx/o.magnitude,o.dy=o.vy/o.magnitude,o.vxHalf=Math.abs(o.dx*s/2),o.vyHalf=Math.abs(o.dy*s/2),a=t.x>e.x?1:-1,r=t.y>e.y?1:-1,t.x=t.x+o.vxHalf*a,t.y=t.y+o.vyHalf*r,e.x=e.x+o.vxHalf*-a,e.y=e.y+o.vyHalf*-r,o.lx=o.vy,o.ly=-o.vx;var f=t.vx*o.dx+t.vy*o.dy;h.x=f*o.dx,h.y=f*o.dy;var p=t.vx*(o.lx/o.magnitude)+t.vy*(o.ly/o.magnitude);c.x=p*(o.lx/o.magnitude),c.y=p*(o.ly/o.magnitude);var g=e.vx*o.dx+e.vy*o.dy;l.x=g*o.dx,l.y=g*o.dy;var v=e.vx*(o.lx/o.magnitude)+e.vy*(o.ly/o.magnitude);d.x=v*(o.lx/o.magnitude),d.y=v*(o.ly/o.magnitude),t.bounce={},t.bounce.x=c.x+l.x,t.bounce.y=c.y+l.y,e.bounce={},e.bounce.x=h.x+d.x,e.bounce.y=h.y+d.y,t.vx=t.bounce.x/t.mass,t.vy=t.bounce.y/t.mass,e.vx=e.bounce.x/e.mass,e.vy=e.bounce.y/e.mass}return u}function multipleCircleCollision(t,e){for(var e=e||!1,i=0;i<t.length;i++)for(var n=t[i],s=i+1;s<t.length;s++){var a=t[s];movingCircleCollision(n,a,e)}}function hitTestCirclePoint(t,e,i){var i=i||!1;return e.diameter=1,e.radius=.5,e.centerX=e.x,e.centerY=e.y,e.gx=e.x,e.gy=e.y,hitTestCircle(t,e,i)}function circlePointCollision(t,e,i,n){var n=n||!1,i=i||!1;return e.diameter=1,e.radius=.5,e.centerX=e.x,e.centerY=e.y,e.gx=e.x,e.gy=e.y,circleCollision(t,e,i,n)}function hitTestRectangle(t,e,i){var n,s,a,r,o,i=i||!1;return n=!1,i?(r=t.gx+t.halfWidth-(e.gx+e.halfWidth),o=t.gy+t.halfHeight-(e.gy+e.halfHeight)):(r=t.centerX-e.centerX,o=t.centerY-e.centerY),s=t.halfWidth+e.halfWidth,a=t.halfHeight+e.halfHeight,n=Math.abs(r)<s&&Math.abs(o)<a?!0:!1}function rectangleCollision(t,e,i,n){var s,a,r,o,h,c,l,n=n||!1,i=i||!1;return n?(c=t.gx+t.halfWidth-(e.gx+e.halfWidth),l=t.gy+t.halfHeight-(e.gy+e.halfHeight)):(c=t.centerX-e.centerX,l=t.centerY-e.centerY),a=t.halfWidth+e.halfWidth,r=t.halfHeight+e.halfHeight,Math.abs(c)<a&&Math.abs(l)<r&&(o=a-Math.abs(c),h=r-Math.abs(l),o>=h?(l>0?(s="top",t.y=t.y+h):(s="bottom",t.y=t.y-h),i&&(t.vy*=-1)):(c>0?(s="left",t.x=t.x+o):(s="right",t.x=t.x-o),i&&(t.vx*=-1))),s}function hitTestCircleRectangle(t,e,i){var n,s,a,r,o,h,i=i||!1;if(i?(a=t.gx,r=t.gy,o=e.gx,h=e.gy):(a=t.x,r=t.y,o=e.x,h=e.y),n=r<h-e.halfHeight?a<o-1-e.halfWidth?"topLeft":a>o+1+e.halfWidth?"topRight":"topMiddle":r>h+e.halfHeight?a<o-1-e.halfWidth?"bottomLeft":a>o+1+e.halfWidth?"bottomRight":"bottomMiddle":a<o-e.halfWidth?"leftMiddle":"rightMiddle","topMiddle"===n||"bottomMiddle"===n||"leftMiddle"===n||"rightMiddle"===n)s=hitTestRectangle(t,e,i);else{var c={};switch(n){case"topLeft":c.x=o,c.y=h;break;case"topRight":c.x=o+e.width,c.y=h;break;case"bottomLeft":c.x=o,c.y=h+e.height;break;case"bottomRight":c.x=o+e.width,c.y=h+e.height}s=hitTestCirclePoint(t,c,i)}return s?n:s}function circleRectangleCollision(t,e,i,n){var s,a,r,o,h,c,n=n||!1,i=i||!1;if(n?(r=t.gx,o=t.gy,h=e.gx,c=e.gy):(r=t.x,o=t.y,h=e.x,c=e.y),s=o<c-e.halfHeight?r<h-1-e.halfWidth?"topLeft":r>h+1+e.halfWidth?"topRight":"topMiddle":o>c+e.halfHeight?r<h-1-e.halfWidth?"bottomLeft":r>h+1+e.halfWidth?"bottomRight":"bottomMiddle":r<h-e.halfWidth?"leftMiddle":"rightMiddle","topMiddle"===s||"bottomMiddle"===s||"leftMiddle"===s||"rightMiddle"===s)a=rectangleCollision(t,e,i,n);else{var l={};switch(s){case"topLeft":l.x=h,l.y=c;break;case"topRight":l.x=h+e.width,l.y=c;break;case"bottomLeft":l.x=h,l.y=c+e.height;break;case"bottomRight":l.x=h+e.width,l.y=c+e.height}a=circlePointCollision(t,l,i,n)}return a?s:a}function hit(t,e,i,n,s,a){function r(t,e){var i=void 0!==t.parent,n=void 0!==e.parent;if(i&&n)return t.diameter&&e.diameter?h(t,e):t.diameter&&!e.diameter?l(t,e):c(t,e);if(n&&void 0!==t.x&&void 0!==t.y)return hitTestPoint(t,e);throw new Error("Im sorry, ${a} and ${b} cannot be use together in a collision test.")}function o(){t instanceof Array&&[t,e].reverse();for(var i=e.length-1;i>=0;i--){var n=e[i];d=r(t,n),d&&a&&a(d,n)}}function h(t,e){return i?t.vx+t.vy!==0&&e.vx+e.vy!==0?movingCircleCollision(t,e,s):circleCollision(t,e,n,s):hitTestCircle(t,e)}function c(t,e){return i?rectangleCollision(t,e,n,s):hitTestRectangle(t,e,s)}function l(t,e){return i?circleRectangleCollision(t,e,n,s):hitTestCircleRectangle(t,e,s)}var d,u=void 0!==t.parent,f=void 0!==e.parent,i=i||!1,n=n||!1,a=a||void 0;return u&&e instanceof Array||f&&t instanceof Array?o():(d=r(t,e),d&&a&&a(d)),d}function particleEffect(t,e,i,n,s,a,r,o,h,c,l,d,u,f,p,g,v,y){function m(n){var a=i();a.frames.length>0&&a.gotoAndStop(b(0,a.frames.length-1)),a.x=t-a.halfWidth,a.y=e-a.halfHeight;var r=b(h,c);a.width=r,a.height=r,a.scaleSpeed=w(u,f),a.alphaSpeed=w(p,g),a.rotationSpeed=w(v,y);var o=w(l,d);a.vx=o*Math.cos(n),a.vy=o*Math.sin(n),a.update=function(){a.vy+=s,a.x+=a.vx,a.y+=a.vy,a.scaleX-a.scaleSpeed>0&&(a.scaleX-=a.scaleSpeed),a.scaleY-a.scaleSpeed>0&&(a.scaleY-=a.scaleSpeed),a.rotation+=a.rotationSpeed,a.alpha-=a.alphaSpeed,a.alpha<=0&&(smokes.freeSmoke(a),particles.splice(particles.indexOf(a),1))},particles.push(a)}for(var x,t=t||0,e=e||0,n=n||10,i=i||function(){return circle(10,"red")},s=s||0,a=a||!0,r=r||0,o=o||6.28,h=h||4,c=c||16,l=l||.1,d=d||1,u=u||.01,f=f||.05,p=p||.02,g=g||.02,v=v||.01,y=y||.03,w=function(t,e){return t+Math.random()*(e-t)},b=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},S=[],M=(o-r)/(n-1),T=0;n>T;T++)a?(x=w(r,o),S.push(x)):(void 0===x&&(x=r),S.push(x),x+=M);S.forEach(m)}function emitter(t,e){function i(){a.playing||(e(),r=setInterval(s.bind(this),t),a.playing=!0)}function n(){a.playing&&(clearInterval(r),a.playing=!1)}function s(){e()}var a={},r=void 0;return a.playing=!1,a.play=i,a.stop=n,a}function tilingSprite(t,e,i,n,s){var a,r,n=n||0,s=s||0;i.frame?(a=i.frame.w,r=i.frame.h):(a=i.width,r=i.height),a-=1,r-=2;var o,h;o=t>=a?Math.round(t/a)+1:2,h=e>=r?Math.round(e/r)+1:2;var c=grid(o,h,a,r,!0,0,0,function(){var t=sprite(i);return t});c._tileX=0,c._tileY=0;var l=rectangle(t,e,"#d3d3d3","#d3d3d3");return l.x=n,l.y=s,l.mask=!0,l.addChild(c),Object.defineProperties(l,{tileX:{get:function(){return c._tileX},set:function(t){c.children.forEach(function(e){var i=t-c._tileX;e.x+=i,e.x>(o-1)*a&&(e.x=0-a+i),e.x<0-a-i&&(e.x=(o-1)*a)}),c._tileX=t},enumerable:!0,configurable:!0},tileY:{get:function(){return c._tileY},set:function(t){c.children.forEach(function(e){var i=t-c._tileY;e.y+=i,e.y>(h-1)*r&&(e.y=0-r+i),e.y<0-r-i&&(e.y=(h-1)*r)}),c._tileY=t},enumerable:!0,configurable:!0}}),l}function cubicBezier(t,e,i,n,s){var a=t*t,r=a*t;return e+(3*-e+t*(3*e-e*t))*t+(3*i+t*(-6*i+3*i*t))*t+(3*n-3*n*t)*a+s*r}function tweenProperty(t,e,i,n,s,a,r,o){var a=a||["smoothstep"],r=r||!1,o=o||0,h={};return"spline"===a[0]&&(h.startMagnitude=a[1],h.endMagnitude=a[2]),h.start=function(t,e){h.startValue=JSON.parse(JSON.stringify(t)),h.endValue=JSON.parse(JSON.stringify(e)),h.playing=!0,h.totalFrames=s,h.frameCounter=0,tweens.push(h)},h.start(i,n),h.update=function(){var i;if(h.playing)if(h.frameCounter<h.totalFrames){var n=h.frameCounter/h.totalFrames;i="spline"!==a[0]?ease[a](n):ease.spline(n,h.startMagnitude,0,1,h.endMagnitude),t[e]=h.endValue*i+h.startValue*(1-i),h.frameCounter+=1}else h.end()},h.end=function(){h.playing=!1,h.onComplete&&h.onComplete(),tweens.splice(tweens.indexOf(h),1),r&&setTimeout(function(){return h.start(h.endValue,h.startValue)},o)},h.play=function(){return h.playing=!0},h.pause=function(){return h.playing=!1},h}function fadeIn(t,e){var e=e||60;return tweenProperty(t,"alpha",t.alpha,1,e,["sine"])}function fadeOut(t,e){var e=e||60;return tweenProperty(t,"alpha",t.alpha,0,e,["sine"])}function pulse(t,e,i){var e=e||60,i=i||0;return tweenProperty(t,"alpha",t.alpha,i,e,["smoothstep"],!0)}function slide(t,e,i,n,s,a,r){var n=n||60,s=s||["smoothstep"],a=a||!1,r=r||0;return makeTween([[t,"x",t.x,e,n,s,a,r],[t,"y",t.y,i,n,s,a,r]])}function makeTween(t){var e={};e.tweens=[],t.forEach(function(t){var i=tweenProperty.apply(null,t);e.tweens.push(i)});var i=0;return e.completed=function(){i+=1,i===e.tweens.length&&(e.onComplete&&e.onComplete(),i=0)},e.tweens.forEach(function(t){t.onComplete=e.completed()}),e.pause=function(){e.tweens.forEach(function(t){t.playing=!1})},e.play=function(){e.tweens.forEach(function(t){t.playing=!0})},e}function removeTween(t){t.tweens?(t.pause(),t.tweens.forEach(function(t){tweens.splice(tweens.indexOf(t),1)})):(t.pause(),tweens.splice(tweens.indexOf(t),1))}function breathe(t,e,i,n,s,a){var s=s||!0,a=a||0;return makeTween([[t,"scaleX",t.scaleX,e,n,["smoothstepSquared"],s,a],[t,"scaleY",t.scaleY,i,n,["smoothstepSquared"],s,a]])}function scale(t,e,i,n){return makeTween([[t,"scaleX",t.scaleX,e,n,["smoothstep"],!1],[t,"scaleY",t.scaleY,i,n,["smoothstep"],!1]])}function strobe(t,e,i,n,s,a,r){var e=e||1.3,i=i||10,n=n||20,s=s||10,a=a||!0,r=r||0;return makeTween([[t,"scaleX",t.scaleX,e,s,["spline",i,n],a,r],[t,"scaleY",t.scaleY,e,s,["spline",i,n],a,r]])}function wobble(t,e,i,n,s,a,r,o,h,c,l){var e=e||1.2,i=i||1.2,n=n||10,s=s||10,a=a||10,r=r||-10,o=o||-10,h=h||.98,c=c||!0,l=l||0,d=makeTween([[t,"scaleX",t.scaleX,e,n,["spline",s,a],c,l],[t,"scaleY",t.scaleY,i,n,["spline",r,o],c,l]]);return d.tweens.forEach(function(t){t.onComplete=function(){t.endValue>1&&(t.endValue*=h,t.endValue<=1&&(t.endValue=1,removeTween(t)))}}),d}function walkPath(t,e,i,n,s,a,r){function o(e){var i=makeTween([[t,"x",h[e][0],h[e+1][0],c,n],[t,"y",h[e][1],h[e+1][1],c,n]]);return i.onComplete=function(){e+=1,e<h.length-1?setTimeout(function(){i=o(e)},r):s&&(a&&h.reverse(),setTimeout(function(){e=0,t.x=h[0][0],t.y=h[0][1],i=o(e)},r),e=0,t.x=h[0][0],t.y=h[0][1],i=o(e))},i}var i=i||300,n=n||["smoothstep"],s=s||!1,a=a||!1,r=r||0,h=JSON.parse(JSON.stringify(e)),c=i/h.length,l=0,d=o(l);return d}function walkCurve(t,e,i,n,s,a,r){function o(i){var c=followCurve(t,e[i],h,n);return c.onComplete=function(){i+=1,i<e.length?setTimeout(function(){c=o(i)},r):s&&(a&&(e.reverse(),e.forEach(function(t){t.reverse()})),setTimeout(function(){i=0,t.x=e[0][0],t.y=e[0][1],c=o(i)},r))},c}var i=i||300,n=n||["smoothstep"],s=s||!1,a=a||!1,r=r||0,h=i/e.length,c=0,l=o(c);return l}function followCurve(t,e,i,n,s,a){var n=n||["smoothstep"],s=s||!1,a=a||0,r={};return"spline"===n[0]&&(r.startMagnitude=n[1],r.endMagnitude=n[2]),r.start=function(t){r.playing=!0,r.totalFrames=i,r.frameCounter=0,r.pointsArray=JSON.parse(JSON.stringify(t)),tweens.push(r)},r.start(e),r.update=function(){var e,i,s=r.pointsArray;r.playing&&(r.frameCounter<r.totalFrames?(e=r.frameCounter/r.totalFrames,i="spline"!==n[0]?ease[n](e):ease.spline(e,r.startMagnitude,0,1,r.endMagnitude),t.x=cubicBezier(i,s[0][0],s[1][0],s[2][0],s[3][0]),t.y=cubicBezier(i,s[0][1],s[1][1],s[2][1],s[3][1]),r.frameCounter+=1):r.end())},r.end=function(){r.playing=!1,r.onComplete&&r.onComplete(),tweens.splice(tweens.indexOf(r),1),s&&setTimeout(function(){r.pointsArray=r.pointsArray.reverse(),r.start(r.pointsArray)},a)},r.pause=function(){r.playing=!1},r.play=function(){r.playing=!0},r}function Game(t,e,i,n,s){if(this.canvas=getCanvas(t,e,"#cccccc","#3b3224"),stage.width=this.canvas.width,stage.height=this.canvas.height,this.mobile=!1,this.pointer=makePointer(this.canvas),this.scale=1,this.state=void 0,this.load=s,this.setup=i,this.assetsToLoad=n,this.paused=!1,this.interpolation=!1,this.fps=15,this.previous=0,this.frameDuration=1e3/this.fps,this.lag=0,_this=this,!i)throw new Error("Please supply the setup function in the constructor")}function game(t,e,i,n,s){var t=t||256,e=e||256;return new Game(t,e,i,n,s)}function capturePreviousPositions(t){function e(t){t.previousX=t.x,t.previousY=t.y,t.children&&t.children.length>0&&t.children.forEach(function(t){e(t)})}t.children.forEach(function(t){e(t)})}if(Modernizr.webaudio){var actx=new AudioContext;Sound.prototype={load:function(){var t=this,e=new XMLHttpRequest;e.open("GET",this.source,!0),e.responseType="arraybuffer",e.addEventListener("load",function(){t.actx.decodeAudioData(e.response,function(e){t.buffer=e,t.hasLoaded=!0,t.loadHandler&&t.loadHandler()},function(t){throw new Error("Audio could not be decoded: "+t)})}),e.send()},play:function(){this.startTime=this.actx.currentTime,this.soundNode=this.actx.createBufferSource(),this.soundNode.buffer=this.buffer,this.soundNode.connect(this.volumeNode),this.reverb===!1?this.volumeNode.connect(this.panNode):(this.volumeNode.connect(this.convolverNode),this.convolverNode.connect(this.panNode),this.convolverNode.buffer=this.reverbImpulse),this.panNode.connect(this.actx.destination),this.echo&&(this.feedbackNode.gain.value=this.feedbackValue,this.delayNode.delayTime.value=this.delayValue,this.filterNode.frequency.value=this.filterValue,this.delayNode.connect(this.feedbackNode),this.filterValue>0?(this.feedbackNode.connect(this.filterNode),this.filterNode.connect(this.delayNode)):this.feedbackNode.connect(this.delayNode),this.volumeNode.connect(this.delayNode),this.delayNode.connect(this.panNode)),this.soundNode.loop=this.loop,this.soundNode.playbackRate.value=this.playbackRate,this.soundNode.start(this.startTime,this.startOffset%this.buffer.duration),this.playing=!0},pause:function(){this.playing&&(this.soundNode.stop(this.actx.currentTime),this.startOffset+=this.actx.currentTime-this.startTime,this.playing=!1)},restart:function(){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=0,this.play()},playFrom:function(t){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=t,this.play()},setEcho:function(t,e,i){this.delayValue=t||.3,this.feedbackValue=e||.3,this.filterValue=i||0,this.echo=!0},setReverb:function(t,e,i){var t=t||2,e=e||2,i=i||!1;this.reverbImpulse=impulseResponse(t,e,i),this.reverb=!0},get volume(){return this.volumeValue},set volume(t){this.volumeNode.gain.value=t,this.volumeValue=t},get pan(){return this.panNode.pan.value},set pan(t){this.panNode.pan.value=t}}}var assets={toLoad:0,loaded:0,imageExtensions:["png","jpg","gif"],fontExtensions:["ttf","otf","ttc","woff"],jsonExtensions:["json"],audioExtensions:["mp3","ogg","wav","webm"],load:function(t,e){var i=this,n=function(){i.loaded+=1,console.log(assets.loaded),i.toLoad===i.loaded&&(i.toLoad=0,i.loaded=0,console.log("Assets finished loading"),e&&e())};console.log("Loading assets..."),this.toLoad=t.length,t.forEach(function(t){var e=t.split(".").pop();-1!==this.fontExtensions.indexOf(e)?this.loadFont(t,n):-1!==this.imageExtensions.indexOf(e)?this.loadImage(t,n):-1!==this.jsonExtensions.indexOf(e)?this.loadJson(t,n,this):-1!==this.audioExtensions.indexOf(e)?this.loadSound(t,n):-1!==this.audioExtensions.indexOf(e)?this.loadSound(t,n):console.log("File type not recognized: "+t)},this)},loadImage:function(t,e){var i=new Image;i.addEventListener("load",e,!1),this[t]=i,i.src=t},loadFont:function(t,e){var i=t.split("/").pop().split(".")[0],n=new Font;n.onload=function(){
e()},n.onerror=function(t){console.log("FontLoadError: ",t)},n.fontFamily=i,n.src=t},loadJson:function(t,e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="text",n.onload=function(s){if(200===n.status){var a=JSON.parse(n.responseText);a.name=t,i[a.name]=a,a.frames?i.createTilesetFrames(a,t,e,i):e()}},n.send()},createTilesetFrames:function(t,e,i,n){function s(){n[r]=o,Object.keys(t.frames).forEach(function(e){n[e]=t.frames[e],n[e].source=o}),i()}var a=e.replace(/[^\/]*$/,""),r=a+t.meta.image,o=new Image;o.addEventListener("load",s,!1),o.src=r},loadSound:function(t,e){var i=makeSound(t,e);i.name=t,this[i.name]=i}},buttons=[],draggableSprites=[],particles=[],tweens=[],shakingSprites=[];DisplayObject.prototype={get gx(){return this.parent?this.x+this.parent.gx:this.x},get gy(){return this.parent?this.y+this.parent.gy:this.y},get layer(){return this._layer},set layer(t){this._layer=t,this.parent&&this.parent.children.sort(function(t,e){return t.layer-e.layer})},addChild:function(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t)},removeChild:function(t){if(t.parent!==this)throw new Error(t+"is not a child of "+this);this.children.splice(this.children.indexOf(t),1)},get halfWidth(){return this.width/2},get halfHeight(){return this.height/2},get centerX(){return this.x+this.halfWidth},get centerY(){return this.y+this.halfHeight},get position(){return{x:this.x,y:this.y}},setPosition:function(t,e){this.x=t,this.y=e},setPattern:function(t,e){this.pattern=!0,this.pattern=g.canvas.ctx.createPattern(t,e)},get localBounds(){return{x:0,y:0,width:this.width,height:this.height}},get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}},get empty(){return 0===this.children.length?!0:!1},putCenter:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x+n.halfWidth-t.halfWidth+e,t.y=n.y+n.halfHeight-t.halfHeight+i},putTop:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x+n.halfWidth-t.halfWidth+e,t.y=n.y-t.height+i},putRight:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x+n.width+e,t.y=n.y+n.halfHeight-t.halfHeight+i},putBottom:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x+n.halfWidth-t.halfWidth+e,t.y=n.y+n.height+i},putLeft:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x-t.width+e,t.y=n.y+n.halfHeight-t.halfHeight+i},swapChildren:function(t,e){var i=this.children.indexOf(t),n=this.children.indexOf(e);if(-1===i||-1===n)throw new Error("Both objects must be a child of the caller "+this);t.childIndex=n,e.childIndex=i,this.children[i]=e,this.children[n]=t},add:function(t){t.forEach(function(t){this.addChild(t)},this)},remove:function(t){for(var e=t.length-1;e>=0;e--)this.removeChild(t[e])},removeHierarchy:function(t){for(var e=t.length-1;e>=0;e--)t[e].children&&t[e].children.length>0&&t[e].remove(t[e].children),this.removeChild(t[e])},get currentFrame(){return this._currentFrame},get circular(){return this._circular},set circular(t){t===!0&&this._circular===!1&&(Object.defineProperties(this,{diameter:{get:function(){return this.width},set:function(t){this.width=t,this.height=t},enumerable:!0,configurable:!0},radius:{get:function(){return this.halfWidth},set:function(t){this.width=2*t,this.height=2*t},enumerable:!0,configurable:!0}}),this._circular=!0),t===!1&&this._circular===!0&&(delete this.diameter,delete this.radius,this._circular=!1)},get draggable(){return this._draggable},set draggable(t){t===!0&&(draggableSprites.push(this),this._draggable=!0),t===!1&&draggableSprites.splice(draggableSprites.indexOf(this),1)},get interactive(){return this._interactive},set interactive(t){t===!0&&(makeInteractive(this),buttons.push(this),this._interactive=!0),t===!1&&(buttons.splice(buttons.indexOf(this),1),this._interactive=!1)}};var stage=new DisplayObject;Group.prototype=new DisplayObject,Group.prototype.constructor=Group,Group.prototype.addChild=function(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),this.calculateSize()},Group.prototype.removeChild=function(t){if(t.parent!==this)throw new Error(t+"is not a child of "+this);this.children.splice(this.children.indexOf(t),1),this.calculateSize()},Group.prototype.calculateSize=function(){this.children.length>0&&(this._newWidth=0,this._newHeight=0,this.children.forEach(function(t){t.x+t.width>this._newWidth&&(this._newWidth=t.x+t.width),t.y+t.height>this._newHeight&&(this._newHeight=t.y+t.height)},this),this.width=this._newWidth,this.height=this._newHeight)},Sprite.prototype=new DisplayObject,Sprite.prototype.constructor=Sprite,Sprite.prototype.createFromImage=function(t){if(!(t instanceof Image))throw new Error(t+" is not an image object");this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height},Sprite.prototype.createFromAtlas=function(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h},Sprite.prototype.createFromTileset=function(t){if(!(t.image instanceof Image))throw new Error(t.image+" is not an image object");this.source=t.image,this.sourceX=t.x,this.sourceY=t.y,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height},Sprite.prototype.createFromTilesetFrames=function(t){if(!(t.image instanceof Image))throw new Error(t.image+" is not an image object");this.source=t.image,this.frames=t.data,this.sourceX=this.frames[0][0],this.sourceY=this.frames[0][1],this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height},Sprite.prototype.createFromAtlasFrames=function(t){this.frames=t,this.source=t[0].source,this.sourceX=t[0].frame.x,this.sourceY=t[0].frame.y,this.width=t[0].frame.w,this.height=t[0].frame.h,this.sourceWidth=t[0].frame.w,this.sourceHeight=t[0].frame.h},Sprite.prototype.createFromImages=function(t){this.frames=t,this.source=t[0],this.sourceX=0,this.sourceY=0,this.width=t[0].width,this.height=t[0].width,this.sourceWidth=t[0].width,this.sourceHeight=t[0].height},Sprite.prototype.gotoAndStop=function(t){if(!(this.frames.length>0&&t<this.frames.length))throw new Error("Frame number "+t+" does not exist");this.frames[0]instanceof Array?(this.sourceX=this.frames[t][0],this.sourceY=this.frames[t][1]):this.frames[t].frame?(this.sourceX=this.frames[t].frame.x,this.sourceY=this.frames[t].frame.y,this.sourceWidth=this.frames[t].frame.w,this.sourceHeight=this.frames[t].frame.h,this.width=this.frames[t].frame.w,this.height=this.frames[t].frame.h):(this.source=this.frames[t],this.sourceX=0,this.sourceY=0,this.width=this.source.width,this.height=this.source.height,this.sourceWidth=this.source.width,this.sourceHeight=this.source.height),this._currentFrame=t},Sprite.prototype.render=function(t){t.drawImage(this.source,this.sourceX,this.sourceY,this.sourceWidth,this.sourceHeight,-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height)},Button.prototype=new Sprite,Button.prototype.constructor=Button;var progressBar={maxWidth:0,height:0,backgroundColor:"gray",foregroundColor:"cyan",backBar:null,frontBar:null,percentage:null,assets:null,initialized:!1,create:function(t,e){this.initialized||(this.assets=e,this.maxWidth=t.width/2,this.backBar=rectangle(this.maxWidth,32,this.backgroundColor),this.backBar.x=t.width/2-this.maxWidth/2,this.backBar.y=t.height/2-16,this.frontBar=rectangle(this.maxWidth,32,this.foregroundColor),this.frontBar.x=t.width/2-this.maxWidth/2,this.frontBar.y=t.height/2-16,this.percentage=text("0%","28px sans-serif","black"),this.percentage.x=t.width/2-this.maxWidth/2+12,this.percentage.y=t.height/2-16,this.initialized=!0)},update:function(){var t=(this.assets.loaded+1)/this.assets.toLoad;this.frontBar.width=this.maxWidth*t,this.percentage.content=Math.floor(100*t)+"%"},remove:function(){remove([this.frontBar,this.backBar,this.percentage])}};Rectangle.prototype=new DisplayObject,Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.render=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,this.pattern?t.fillStyle=this.pattern:t.fillStyle=this.fillStyle,t.beginPath(),t.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&this.mask===!0&&t.clip()},Circle.prototype=new DisplayObject,Circle.prototype.constructor=Circle,Circle.prototype.render=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.arc(this.radius+-this.diameter*this.pivotX,this.radius+-this.diameter*this.pivotY,this.radius,0,2*Math.PI,!1),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&this.mask===!0&&t.clip()},Ellipse.prototype=new DisplayObject,Ellipse.prototype.constructor=Ellipse,Ellipse.prototype.render=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.moveTo(this.x,this.y-this.height/2),t.bezierCurveTo(this.x+this.width/2,this.y-this.height/2,this.x+this.width/2,this.y+this.height/2,this.x,this.y+this.height/2),t.bezierCurveTo(this.x-this.width/2,this.y+this.height/2,this.x-this.width/2,this.y-this.height/2,this.x,this.y-this.height/2),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&this.mask===!0&&t.clip()},Line.prototype=new DisplayObject,Line.prototype.constructor=Line,Line.prototype.render=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineJoin=this.lineJoin,t.beginPath(),t.moveTo(this.ax,this.ay),t.lineTo(this.bx,this.by),"none"!==this.strokeStyle&&t.stroke()},Text.prototype=new DisplayObject,Text.prototype.constructor=Text,Text.prototype.render=function(t){t.font=this.font,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.translate(-this.width*this.pivotX,-this.height*this.pivotY),t.textBaseline=this.textBaseline,t.fillText(this.content,0,0),"none"!==this.strokeText&&t.strokeText()};var linear=function(t){return t},smoothstep=function(t){return t*t*(3-2*t)},smoothstepSquared=function(t){return Math.pow(t*t*(3-2*t),2)},smoothstepCubed=function(t){return Math.pow(t*t*(3-2*t),3)},acceleration=function(t){return t*t},accelerationCubed=function(t){return Math.pow(t*t,3)},deceleration=function(t){return 1-Math.pow(1-t,2)},decelerationCubed=function(t){return 1-Math.pow(1-t,3)},sine=function(t){return Math.sin(t*Math.PI/2)},sineSquared=function(t){return Math.pow(Math.sin(t*Math.PI/2),2)},sineCubed=function(t){return Math.pow(Math.sin(t*Math.PI/2),2)},inverseSine=function(t){return 1-Math.sin((1-t)*Math.PI/2)},inverseSineSquared=function(t){return 1-Math.pow(Math.sin((1-t)*Math.PI/2),2)},inverseSineCubed=function(t){return 1-Math.pow(Math.sin((1-t)*Math.PI/2),3)},sineComplete=function(t){return.5-.5*Math.cos(-t*Math.PI)},weightedAverage=function(t,e,i){return(t*(i-1)+e)/i},spline=function(t,e,i,n,s){return.5*(2*i+(-e+n)*t+(2*e-5*i+4*n-s)*t*t+(-e+3*i-3*n+s)*t*t*t)},ease={linear:function(t){return t},smoothstep:function(t){return t*t*(3-2*t)},smoothstepSquared:function(t){return Math.pow(t*t*(3-2*t),2)},smoothstepCubed:function(t){return Math.pow(t*t*(3-2*t),3)},acceleration:function(t){return t*t},accelerationCubed:function(t){return Math.pow(t*t,3)},deceleration:function(t){return 1-Math.pow(1-t,2)},decelerationCubed:function(t){return 1-Math.pow(1-t,3)},sine:function(t){return Math.sin(t*Math.PI/2)},sineSquared:function(t){return Math.pow(Math.sin(t*Math.PI/2),2)},sineCubed:function(t){return Math.pow(Math.sin(t*Math.PI/2),2)},inverseSine:function(t){return 1-Math.sin((1-t)*Math.PI/2)},inverseSineSquared:function(t){return 1-Math.pow(Math.sin((1-t)*Math.PI/2),2)},inverseSineCubed:function(t){return 1-Math.pow(Math.sin((1-t)*Math.PI/2),3)},spline:function(t,e,i,n,s){return.5*(2*i+(-e+n)*t+(2*e-5*i+4*n-s)*t*t+(-e+3*i-3*n+s)*t*t*t)}};Game.prototype={gameLoop:function(t){requestAnimationFrame(this.gameLoop.bind(this)),this.updateGameEffects(),this.state&&!this.paused&&this.state(),render(this.canvas)},start:function(){this.assetsToLoad?(setTimeout(function(){assets.load(_this.assetsToLoad,function(){_this.state=void 0,_this.setup()})},0),this.load&&(this.state=this.load)):this.setup(),this.gameLoop()},pause:function(){this.paused=!0},resume:function(){this.paused=!1},scaleToWindow:function(t){var e,i,n,s,t=t||"#2C3539";if(e=window.innerWidth/this.canvas.width,i=window.innerHeight/this.canvas.height,n=Math.min(e,i),n=Math.round(n),this.canvas.style.transformOrigin="0 0",this.canvas.style.transform="scale("+n+")",console.log(n),s=this.canvas.width>this.canvas.height?"vertically":"horizontally","horizontally"===s){var a=(window.innerHeight-this.canvas.height*e)/2;this.canvas.style.marginTop=a+"px",this.canvas.style.marginBottom=a+"px"}if("vertically"===s){var a=(window.innerWidth-this.canvas.width*i)/2;this.canvas.style.marginLeft=a+"px",this.canvas.style.marginRight=a+"px"}this.canvas.style.paddingLeft=0,this.canvas.style.paddingRight=0,this.canvas.style.display="block",document.body.style.backgroundColor=t,this.pointer.scale=n,this.scale=n},setupMobile:function(){var t=document.getElementById("container"),e=!!("ontouchstart"in window),i=window.innerWidth,n=window.innerHeight;return e&&(this.mobile=!0),this.canvas.width>=1280||!e?!1:(n>i&&(alert("Please rotate the device and then click OK"),i=window.innerWidth,n=window.innerHeight),t.style.height=2*n+"px",window.scrollTo(0,1),n=window.innerHeight+2,t.style.height=n+"px",t.style.width=i+"px",t.style.padding=0,n>=1.75*this.canvas.height||i>=1.75*this.canvas.height?(this.canvas.width=i/2,this.canvas.height=n/2,this.canvas.style.width=i+"px",this.canvas.style.height=n+"px"):(this.canvas.width=i,this.canvas.height=n),this.canvas.style.position="absolute",this.canvas.style.left="0px",void(this.canvas.style.top="0px"))},updateGameEffects:function(){if(buttons.length>0&&(this.canvas.style.cursor="auto",buttons.forEach(function(t){t.update(this.pointer,this.canvas),("over"===t.state||"down"===t.state)&&void 0!==t.parent&&(this.canvas.style.cursor="pointer")},this)),particles.length>0)for(var t=particles.length-1;t>=0;t--){var e=particles[t];e.update()}if(tweens.length>0)for(var t=tweens.length-1;t>=0;t--){var i=tweens[t];i&&i.update()}if(shakingSprites.length>0)for(var t=shakingSprites.length-1;t>=0;t--){var n=shakingSprites[t];n.updateShake&&n.updateShake()}draggableSprites.length>0&&this.pointer.updateDragAndDrop(draggableSprites)}};