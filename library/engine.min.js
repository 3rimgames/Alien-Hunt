function Sound(t,e){this.source=t,this.loadHandler=e,this.actx=actx,this.volumeNode=this.actx.createGain(),this.panNode=this.actx.createStereoPanner(),this.soundNode=null,this.buffer=null,this.loop=!1,this.playing=!1,this.panValue=0,this.volumeValue=1,this.startTime=0,this.startOffset=0,this.playbackRate=1,this.echo=!1,this.delayValue=.3,this.feedbackValue=.3,this.filterValue=0,this.delayNode=this.actx.createDelay(),this.feedbackNode=this.actx.createGain(),this.filterNode=this.actx.createBiquadFilter(),this.convolverNode=this.actx.createConvolver(),this.reverb=!1,this.reverbImpulse=null,this.load()}function makeSound(t,e){return new Sound(t,e)}function impulseResponse(t,e,i){var t="undefined"!=typeof t?t:2,e="undefined"!=typeof e?e:2,i="undefined"!=typeof i?i:!1,n=actx.sampleRate*t;console.log(t);for(var s=actx.createBuffer(2,n,actx.sampleRate),r=s.getChannelData(0),o=s.getChannelData(1),a=0;n>a;a++){var h;h=i?n-a:a,r[a]=(2*Math.random()-1)*Math.pow(1-h/n,e),o[a]=(2*Math.random()-1)*Math.pow(1-h/n,e)}return s}function playNote(t,e,i){var e="undefined"!=typeof e?e:1,i="undefined"!=typeof i?i:"sine",n=actx.createOscillator(),s=actx.createGain();n.connect(s),s.connect(actx.destination),n.type=i,n.frequency.value=t,s.gain.linearRampToValueAtTime(1,actx.currentTime),s.gain.linearRampToValueAtTime(0,actx.currentTime+e),n.start(actx.currentTime)}function soundEffect(t,e,i,n,s,r,o,a,h,d,c,l,f){function u(t){var e=actx.createConvolver();e.buffer=impulseResponse(f[0],f[1],f[2]),t.connect(e),e.connect(S)}function p(t){var e=actx.createGain(),i=actx.createDelay(),n=actx.createBiquadFilter();i.delayTime.value=l[0],e.gain.value=l[1],l[2]&&(n.frequency.value=l[2]),i.connect(e),l[2]?(e.connect(n),n.connect(i)):e.connect(i),t.connect(i),i.connect(S)}function g(t){t.gain.value=0,t.gain.linearRampToValueAtTime(0,actx.currentTime+o),t.gain.linearRampToValueAtTime(s,actx.currentTime+o+e)}function y(t){t.gain.linearRampToValueAtTime(s,actx.currentTime+e+o),t.gain.linearRampToValueAtTime(0,actx.currentTime+o+e+i)}function v(t){var n=t.frequency.value;h?(t.frequency.linearRampToValueAtTime(n,actx.currentTime+o),t.frequency.linearRampToValueAtTime(n+a,actx.currentTime+o+e+i)):(t.frequency.linearRampToValueAtTime(n,actx.currentTime+o),t.frequency.linearRampToValueAtTime(n-a,actx.currentTime+o+e+i))}function m(){var t=actx.createOscillator(),n=actx.createOscillator(),r=actx.createGain(),o=actx.createGain();r.gain.value=s,o.gain.value=s,t.connect(r),r.connect(actx.destination),n.connect(o),o.connect(actx.destination),t.type="sawtooth",n.type="sawtooth",t.frequency.value=T+c,n.frequency.value=T-c,e>0&&(g(r),g(o)),i>0&&(y(r),y(o)),a>0&&(v(t),v(n)),l&&(p(r),p(o)),f&&(u(r),u(o)),x(t),x(n)}function x(t){t.start(actx.currentTime+o)}var e=checkIfUndefined(e,0),i=checkIfUndefined(i,1),n=checkIfUndefined(n,"sine"),s=checkIfUndefined(s,1),r=checkIfUndefined(r,0),o=checkIfUndefined(o,0),a=checkIfUndefined(a,0),h=checkIfUndefined(h,!1),d=checkIfUndefined(d,0),c=checkIfUndefined(c,0),l=checkIfUndefined(l,void 0),f=checkIfUndefined(f,void 0),b=actx.createOscillator(),w=actx.createGain(),S=actx.createStereoPanner();b.connect(w),w.connect(S),S.connect(actx.destination),w.gain.value=s,S.pan.value=r,b.type=n;var T,k=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};T=d>0?k(t-d/2,t+d/2):t,b.frequency.value=T,e>0&&g(w),i>0&&y(w),a>0&&v(b),l&&p(w),f&&u(w),c>0&&m(),x(b)}function shootSound(){soundEffect(1046.5,0,.3,"sawtooth",.5,-.8,0,1200,!1,0,25,[.2,.2,2e3],void 0)}function explosionSound(){soundEffect(16,0,1,"sawtooth",1,0,0,0,!1,0,50,void 0,void 0)}function jumpSound(){soundEffect(523.25,.05,.2,"sine",1.5,.8,0,600,!0,100,0,void 0,void 0)}function distance(t,e){var i=e.centerX-t.centerX,n=e.centerY-t.centerY;return Math.sqrt(i*i+n*n)}function followEase(t,e,i){var n=e.centerX-t.centerX,s=e.centerY-t.centerY,r=Math.sqrt(n*n+s*s);r>=1&&(t.x+=n*i,t.y+=s*i)}function followConstant(t,e,i){var n=e.centerX-t.centerX,s=e.centerY-t.centerY,r=Math.sqrt(n*n+s*s);r>=i&&(t.x+=n/r*i,t.y+=s/r*i)}function angle(t,e){return Math.atan2(e.centerY-t.centerY,e.centerX-t.centerX)}function rotateSprite(t,e,i,n){t.x=e.centerX-t.parent.x+i*Math.cos(n)-t.halfWidth,t.y=e.centerY-t.parent.y+i*Math.sin(n)-t.halfWidth}function rotatePoint(t,e,i,n,s){var r={};return r.x=t+Math.cos(s)*i,r.y=e+Math.sin(s)*n,r}function shoot(t,e,i,n,s,r){var o=r();o.rotation=t.rotation,o.x=t.centerX-o.halfWidth+i*Math.cos(e),o.y=t.centerY-o.halfHeight+i*Math.sin(e),o.vx=Math.cos(e)*n,o.vy=Math.sin(e)*n,s.push(o)}function outsideBounds(t,e,i){var n,s=e.x,r=e.y,o=e.width,a=e.height;return t.x<s-t.width&&(n="left"),t.y<r-t.height&&(n="top"),t.x>o&&(n="right"),t.y>a&&(n="bottom"),n&&i&&i(n),n}function checkIfUndefined(t,e){return"undefined"!=typeof t?t:e}function move(t){if(1===t.length){var e=t[0];e.x+=e.vx,e.y+=e.vy}else for(var i=0;i<t.length;i++){var e=t[i];e.x+=e.vx,e.y+=e.vy}}function makeCanvas(t,e,i,n){var t=t||256,e=e||256,i=i||"1px dashed black",n=n||"white",s=document.createElement("canvas");return s.id="canvas",s.width=t,s.height=e,s.style.border=i,s.style.backgroundColor=n,document.body.appendChild(s),s.ctx=s.getContext("2d"),s}function DisplayObject(){this.x=0,this.y=0,this.width=0,this.height=0,this.rotation=0,this.alpha=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.pivotX=.5,this.pivotY=.5,this.vx=0,this.vy=0,this._layer=0,this.children=[],this.parent=void 0,this.shadow=!1,this.shadowColor="black",this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowBlur=3,this.blendMode=void 0,this.gradient=!1,this.pattern=!1,this.frames=[],this.loop=!0,this._currentFrame=0,this.playing=!1,this._draggable=void 0,this._circular=!1,this._interactive=!1,this.animate={}}function remove(t){for(var e=t.length-1;e>=0;e--)t[e].parent.removeChild(t[e])}function render(t){function e(n){n.visible&&n.gx<t.width+n.width&&n.gx+n.width>=-n.width&&n.gy<t.height+n.height&&n.gy+n.height>=-n.height&&(i.save(),i.translate(n.x+n.width*n.pivotX,n.y+n.height*n.pivotY),i.rotate(n.rotation),i.globalAlpha=n.alpha*n.parent.alpha,i.scale(n.scaleX,n.scaleY),n.shadow&&(i.shadowColor=n.shadowColor,i.shadowOffsetX=n.shadowOffsetX,i.shadowOffsetY=n.shadowOffsetY,i.shadowBlur=n.shadowBlur),n.blendMode&&(i.globalCompositeOperation=n.blendMode),n.render&&n.render(i),n.children&&n.children.length>0&&(i.translate(-n.width*n.pivotX,-n.height*n.pivotY),n.children.forEach(function(t){e(t)})),i.restore())}var i=t.ctx;i.clearRect(0,0,t.width,t.height),stage.children.forEach(e)}function Group(t){DisplayObject.call(this),t.forEach(function(t){this.addChild(t)},this)}function group(t){var e=new Group(t);return stage.addChild(e),e}function Sprite(t,e,i){if(DisplayObject.call(this),this.x=e||0,this.y=i||0,t)if(t instanceof Image)this.createFromImage(t);else if(t.frame)this.createFromAtlas(t);else if(t.image&&!t.data)this.createFromTileset(t);else if(t.image&&t.data)this.createFromTilesetFrames(t);else{if(!(t instanceof Array))throw new Error("The image source "+t+" is not recognized");if(t[0]&&t[0].source)this.createFromAtlasFrames(t);else{if(!(t[0]instanceof Image))throw new Error("The image sources in "+t+" are not recognized");this.createFromImages(t)}}}function sprite(t,e,i){var n=new Sprite(t,e,i);return n.frames.length>0&&addStatePlayer(n),stage.addChild(n),n}function frame(t,e,i,n,s){var r={};return r.image=t,r.x=e,r.y=i,r.width=n,r.height=s,r}function frames(t,e,i,n){var s={};return s.image=t,s.data=e,s.width=i,s.height=n,s}function randomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function contain(t,e,i,n){var s,r=e.x,o=e.y,a=e.width,h=e.height,d=i||!1,c=n||void 0;return t.x<r&&(d&&(t.vx*=-1),t.mass&&(t.vx/=t.mass),t.x=r,s="left"),t.y<o&&(d&&(t.vy*=-1),t.mass&&(t.vy/=t.mass),t.y=o,s="top"),t.x+t.width>a&&(d&&(t.vx*=-1),t.mass&&(t.vx/=t.mass),t.x=a-t.width,s="right"),t.y+t.height>h&&(d&&(t.vy*=-1),t.mass&&(t.vy/=t.mass),t.y=h-t.height,s="bottom"),s&&c&&c(s),s}function renderWithInterpolation(t,e){function i(s){s.visible&&s.gx<t.width+s.width&&s.gx+s.width>-s.width&&s.gy<t.height+s.height&&s.gy+s.height>-s.height&&(n.save(),void 0!==s.previousX?s.renderX=(s.x-s.previousX)*e+s.previousX:s.renderX=s.x,void 0!==s.previousY?s.renderY=(s.y-s.previousY)*e+s.previousY:s.renderY=s.y,n.translate(s.renderX+s.width*s.pivotX,s.renderY+s.height*s.pivotY),n.rotate(s.rotation),n.globalAlpha=s.alpha*s.parent.alpha,n.scale(s.scaleX,s.scaleY),s.shadow&&(n.shadowColor=s.shadowColor,n.shadowOffsetX=s.shadowOffsetX,n.shadowOffsetY=s.shadowOffsetY,n.shadowBlur=s.shadowBlur),s.blendMode&&(n.globalCompositeOperation=s.blendMode),s.render&&s.render(n),s.children&&s.children.length>0&&(n.translate(-s.width*s.pivotX,-s.height*s.pivotY),s.children.forEach(i)),n.restore())}var n=t.ctx;n.clearRect(0,0,t.width,t.height),stage.children.forEach(i)}function Button(t,e,i){Sprite.call(this,t,e,i),this.x="undefined"!=typeof e?e:0,this.y="undefined"!=typeof i?i:0,this.interactive=!0}function button(t,e,i){var n=new Button(t,e,i);return stage.addChild(n),n}function makeInteractive(t){t.press=t.press||void 0,t.release=t.release||void 0,t.over=t.over||void 0,t.out=t.out||void 0,t.tap=t.tap||void 0,t.state="up",t.action="",t.pressed=!1,t.hoverOver=!1,t.update=function(e,i){var n=e.hitTestSprite(t);e.isUp&&(t.state="up",t instanceof Button&&t.gotoAndStop(0)),n&&(t.state="over",t.frames&&3===t.frames.length&&t instanceof Button&&t.gotoAndStop(1),e.isDown&&(t.state="down",t instanceof Button&&(3===t.frames.length?t.gotoAndStop(2):t.gotoAndStop(1)))),"down"===t.state&&(t.pressed||(t.press&&t.press(),t.pressed=!0,t.action="pressed")),"over"===t.state&&(t.pressed&&(t.release&&t.release(),t.pressed=!1,t.action="released",e.tapped&&t.tap&&t.tap()),t.hoverOver||(t.over&&t.over(),t.hoverOver=!0)),"up"===t.state&&(t.pressed&&(t.release&&t.release(),t.pressed=!1,t.action="released"),t.hoverOver&&(t.out&&t.out(),t.hoverOver=!1))}}function grid(t,e,i,n,s,r,o,a,h){var t="undefined"!=typeof t?t:0,e="undefined"!=typeof e?e:0,i="undefined"!=typeof i?i:32,n="undefined"!=typeof n?n:32,s="undefined"!=typeof s?s:!1,r="undefined"!=typeof r?r:0,o="undefined"!=typeof o?o:0,a="undefined"!=typeof a?a:void 0,h="undefined"!=typeof h?h:void 0,d=group([]),c=function(){for(var c=t*e,l=0;c>l;l++){var f=l%t*i,u=Math.floor(l/t)*n,p=a();d.addChild(p),s?(p.x=f+i/2-p.halfWidth+r,p.y=u+n/2-p.halfHeight+o):(p.x=f+r,p.y=u+o),h&&h(p)}};return c(),d}function addStatePlayer(t){function e(e){o(),t.gotoAndStop(e)}function i(){t.playing||s([0,t.frames.length-1])}function n(){t.playing&&(o(),t.gotoAndStop(t.currentFrame))}function s(e){o(),d=e[0],c=e[1],h=c-d,0===d&&(h+=1,a+=1),1===h&&(h=2,a+=1),t.fps||(t.fps=12);var i=1e3/t.fps;t.gotoAndStop(d),t.playing||(l=setInterval(r.bind(this),i),t.playing=!0)}function r(){h>a?(t.gotoAndStop(t.currentFrame+1),a+=1):t.loop&&(t.gotoAndStop(d),a=1)}function o(){void 0!==l&&t.playing===!0&&(t.playing=!1,a=0,d=0,c=0,h=0,clearInterval(l))}var a=0,h=0,d=0,c=0,l=void 0;t.show=e,t.play=i,t.stop=n,t.playSequence=s}function filmstrip(t,e,i,n){for(var n="undefined"!=typeof n?n:0,s=[],r=t.width/e,o=t.height/i,a=r*o,h=0;a>h;h++){var d=h%r*e,c=Math.floor(h/r)*i;n&&n>0&&(d+=n+n*h%r,c+=n+n*Math.floor(h/r)),s.push([d,c])}return frames(t,s,e,i)}function shake(t,e,i){function n(){o>r&&(t.x=a,t.y=h,e-=c,t.x+=l(-e,e),t.y+=l(-e,e),r+=1),r>=o&&(t.x=a,t.y=h,shakingSprites.splice(shakingSprites.indexOf(t),1))}function s(){o>r&&(t.rotation=d,e-=c,t.rotation=e*f,r+=1,f*=-1),r>=o&&(t.rotation=d,shakingSprites.splice(shakingSprites.indexOf(t),1))}var e=checkIfUndefined(e,16),i=checkIfUndefined(i,!1),r=1,o=10,a=t.x,h=t.y,d=t.rotation,c=e/o,l=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};-1===shakingSprites.indexOf(t)&&(shakingSprites.push(t),t.updateShake=function(){i?s():n()});var f=1}function Rectangle(t,e,i,n,s,r,o){DisplayObject.call(this),this.width=t||32,this.height=e||32,this.fillStyle=i||"#d3d3d3",this.strokeStyle=n||"#d3d3d3",this.lineWidth=s||0,this.x=r||0,this.y=o||0,this.mask=!1}function rectangle(t,e,i,n,s,r,o){var a=new Rectangle(t,e,i,n,s,r,o);return stage.addChild(a),a}function Circle(t,e,i,n,s,r){DisplayObject.call(this),this.circular=!0,this.diameter="undefined"!=typeof t?t:32,this.fillStyle="undefined"!=typeof e?e:"#d3d3d3",this.strokeStyle="undefined"!=typeof i?i:"#d3d3d3",this.lineWidth="undefined"!=typeof n?n:0,this.x="undefined"!=typeof s?s:0,this.y="undefined"!=typeof r?r:0,this.mask=!1}function circle(t,e,i,n,s,r){var o=new Circle(t,e,i,n,s,r);return stage.addChild(o),o}function Ellipse(t,e,i,n,s,r,o){DisplayObject.call(this),this.x=t||0,this.y=e||0,this.width=i,this.height=n,this.fillStyle="undefined"!=typeof s?s:"black",this.strokeStyle="undefined"!=typeof r?r:"#d3d3d3",this.lineWidth="undefined"!=typeof o?o:0,this.mask=!1}function ellipse(t,e,i,n,s,r,o){var a=new Ellipse(t,e,i,n,s,r,o);return stage.addChild(a),a}function Line(t,e,i,n,s,r){DisplayObject.call(this),this.ax="undefined"!=typeof i?i:0,this.ay="undefined"!=typeof n?n:0,this.bx="undefined"!=typeof s?s:32,this.by="undefined"!=typeof r?r:32,this.strokeStyle=t||"#d3d3d3",this.lineWidth=e||0,this.lineJoin="round"}function line(t,e,i,n,s,r){var o=new Line(t,e,i,n,s,r);return stage.addChild(o),o}function Text(t,e,i,n,s){DisplayObject.call(this),this.content=t||"Hello",this.font=e||"12px sans-serif",this.fillStyle=i||"#d3d3d3",this.x=n||0,this.y=s||0,this.textBaseline="top",this.strokeText="none",canvas.ctx.font=this.font,canvas.ctx.textBaseline="top",this.width=canvas.ctx.measureText(this.content).width,this.height=canvas.ctx.measureText("M").width}function text(t,e,i,n,s){var r=new Text(t,e,i,n,s);return stage.addChild(r),r}function keyboard(t){var e={};return e.code=t,e.isDown=!1,e.isUp=!0,e.press=void 0,e.release=void 0,e.downHandler=function(t){t.keyCode===e.code&&(e.isUp&&e.press&&e.press(),e.isDown=!0,e.isUp=!1),t.preventDefault()},e.upHandler=function(t){t.keyCode===e.code&&(e.isDown&&e.release&&e.release(),e.isDown=!1,e.isUp=!0),t.preventDefault()},window.addEventListener("keydown",e.downHandler.bind(e),!1),window.addEventListener("keyup",e.upHandler.bind(e),!1),e}function makePointer(t,e){var i={element:t,scale:e||1,_x:0,_y:0,get x(){return this._x/this.scale},get y(){return this._y/this.scale},get centerX(){return this.x},get centerY(){return this.y},get position(){return{x:this.x,y:this.y}},isDown:!1,isUp:!0,tapped:!1,downTime:0,elapsedTime:0,press:void 0,release:void 0,tap:void 0,dragSprite:null,dragOffsetX:0,dragOffsetY:0,updateDragAndDrop:function(t){if(this.isDown)if(null===this.dragSprite)for(var e=draggableSprites.length-1;e>-1;e--){var t=draggableSprites[e];if(this.hitTestSprite(t)&&t.draggable){this.dragOffsetX=this.x-t.gx,this.dragOffsetY=this.y-t.gy,this.dragSprite=t;var i=t.parent.children;i.splice(i.indexOf(t),1),i.push(t),draggableSprites.splice(draggableSprites.indexOf(t),1),draggableSprites.push(t);break}}else this.dragSprite.x=this.x-this.dragOffsetX,this.dragSprite.y=this.y-this.dragOffsetY;this.isUp&&(this.dragSprite=null),draggableSprites.some(function(t){return this.hitTestSprite(t)&&t.draggable?(this.element.style.cursor="pointer",!0):(this.element.style.cursor="auto",!1)},this)},moveHandler:function(t){var e=t.target;this._x=t.pageX-e.offsetLeft,this._y=t.pageY-e.offsetTop,t.preventDefault()},touchmoveHandler:function(t){var e=t.target;this._x=t.targetTouches[0].pageX-e.offsetLeft,this._y=t.targetTouches[0].pageY-e.offsetTop,t.preventDefault()},downHandler:function(t){this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(),t.preventDefault()},touchstartHandler:function(t){var e=t.target;this._x=t.targetTouches[0].pageX-e.offsetLeft,this._y=t.targetTouches[0].pageY-e.offsetTop,this.isDown=!0,this.isUp=!1,this.tapped=!1,this.downTime=Date.now(),this.press&&this.press(),t.preventDefault()},upHandler:function(t){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),t.preventDefault()},touchendHandler:function(t){this.elapsedTime=Math.abs(this.downTime-Date.now()),this.elapsedTime<=200&&this.tapped===!1&&(this.tapped=!0,this.tap&&this.tap()),this.isUp=!0,this.isDown=!1,this.release&&this.release(),t.preventDefault()},hitTestSprite:function(t){var e=!1;if(t.circular){var i=this.x-(t.gx+t.radius),n=this.y-(t.gy+t.radius),s=Math.sqrt(i*i+n*n);e=s<t.radius}else{var r=t.gx,o=t.gx+t.width,a=t.gy,h=t.gy+t.height;e=this.x>r&&this.x<o&&this.y>a&&this.y<h}return e}};return t.addEventListener("mousemove",i.moveHandler.bind(i),!1),t.addEventListener("mousedown",i.downHandler.bind(i),!1),window.addEventListener("mouseup",i.upHandler.bind(i),!1),t.addEventListener("touchmove",i.touchmoveHandler.bind(i),!1),t.addEventListener("touchstart",i.touchstartHandler.bind(i),!1),window.addEventListener("touchend",i.touchendHandler.bind(i),!1),t.style.touchAction="none",i}function hitTestPoint(t,e){var i,n,s,r,o,a,h,d,c;return i=e.radius?"circle":"rectangle","rectangle"===i&&(n=e.x,s=e.x+e.width,r=e.y,o=e.y+e.height,c=t.x>n&&t.x<s&&t.y>r&&t.y<o),"circle"===i&&(a=t.x-e.centerX,h=t.y-e.centerY,d=Math.sqrt(a*a+h*h),c=d<e.radius),c}function hitTestCircle(t,e,i){var n,s,r,o,a,i="undefined"!=typeof i?i:!1;return i?(n=e.gx+e.radius-(t.gx+t.radius),s=e.gy+e.radius-(t.gy+t.radius)):(n=e.centerX-t.centerX,s=e.centerY-t.centerY),r=Math.sqrt(n*n+s*s),o=t.radius+e.radius,a=o>r}function circleCollision(t,e,i,n){var s,r,o,a,h,d,c,n="undefined"!=typeof n?n:!1,i="undefined"!=typeof i?i:!1,l={},f=!1;if(n?(a=e.gx+e.radius-(t.gx+t.radius),h=e.gy+e.radius-(t.gy+t.radius)):(a=e.centerX-t.centerX,h=e.centerY-t.centerY),s=Math.sqrt(a*a+h*h),r=t.radius+e.radius,r>s){f=!0,o=r-s;var u=.3;o+=u,d=a/s,c=h/s,t.x-=o*d,t.y-=o*c,i&&(l.x=h,l.y=-a,bounceOffSurface(t,l))}return f}function movingCircleCollision(t,e,i){var n,s,r,o,i="undefined"!=typeof i?i:!1,a={},h={},d={},c={},l={},f=!1;if(t.mass=t.mass||1,e.mass=e.mass||1,i?(a.vx=e.gx+e.radius-(t.gx+t.radius),a.vy=e.gy+e.radius-(t.gy+t.radius)):(a.vx=e.centerX-t.centerX,a.vy=e.centerY-t.centerY),a.magnitude=Math.sqrt(a.vx*a.vx+a.vy*a.vy),n=t.radius+e.radius,a.magnitude<n){f=!0,s=n-a.magnitude,s+=.3,a.dx=a.vx/a.magnitude,a.dy=a.vy/a.magnitude,a.vxHalf=Math.abs(a.dx*s/2),a.vyHalf=Math.abs(a.dy*s/2),r=t.x>e.x?1:-1,o=t.y>e.y?1:-1,t.x=t.x+a.vxHalf*r,t.y=t.y+a.vyHalf*o,e.x=e.x+a.vxHalf*-r,e.y=e.y+a.vyHalf*-o,a.lx=a.vy,a.ly=-a.vx;var u=t.vx*a.dx+t.vy*a.dy;h.x=u*a.dx,h.y=u*a.dy;var p=t.vx*(a.lx/a.magnitude)+t.vy*(a.ly/a.magnitude);d.x=p*(a.lx/a.magnitude),d.y=p*(a.ly/a.magnitude);var g=e.vx*a.dx+e.vy*a.dy;c.x=g*a.dx,c.y=g*a.dy;var y=e.vx*(a.lx/a.magnitude)+e.vy*(a.ly/a.magnitude);l.x=y*(a.lx/a.magnitude),l.y=y*(a.ly/a.magnitude),t.bounce={},t.bounce.x=d.x+c.x,t.bounce.y=d.y+c.y,e.bounce={},e.bounce.x=h.x+l.x,e.bounce.y=h.y+l.y,t.vx=t.bounce.x/t.mass,t.vy=t.bounce.y/t.mass,e.vx=e.bounce.x/e.mass,e.vy=e.bounce.y/e.mass}return f}function multipleCircleCollision(t,e){for(var e="undefined"!=typeof e?e:!1,i=0;i<t.length;i++)for(var n=t[i],s=i+1;s<t.length;s++){var r=t[s];movingCircleCollision(n,r,e)}}function hitTestCirclePoint(t,e,i){var i="undefined"!=typeof i?i:!1;return e.diameter=1,e.radius=.5,e.centerX=e.x,e.centerY=e.y,e.gx=e.x,e.gy=e.y,hitTestCircle(t,e,i)}function circlePointCollision(t,e,i,n){var n="undefined"!=typeof n?n:!1,i="undefined"!=typeof i?i:!1;return e.diameter=1,e.radius=.5,e.centerX=e.x,e.centerY=e.y,e.gx=e.x,e.gy=e.y,circleCollision(t,e,i,n)}function hitTestRectangle(t,e,i){var n,s,r,o,a,i=i||!1;return n=!1,i?(o=t.gx+t.halfWidth-(e.gx+e.halfWidth),a=t.gy+t.halfHeight-(e.gy+e.halfHeight)):(o=t.centerX-e.centerX,a=t.centerY-e.centerY),s=t.halfWidth+e.halfWidth,r=t.halfHeight+e.halfHeight,n=Math.abs(o)<s&&Math.abs(a)<r?!0:!1}function rectangleCollision(t,e,i,n){var s,r,o,a,h,d,c,n=n||!1,i=i||!1;return n?(d=t.gx+t.halfWidth-(e.gx+e.halfWidth),c=t.gy+t.halfHeight-(e.gy+e.halfHeight)):(d=t.centerX-e.centerX,c=t.centerY-e.centerY),r=t.halfWidth+e.halfWidth,o=t.halfHeight+e.halfHeight,Math.abs(d)<r&&Math.abs(c)<o&&(a=r-Math.abs(d),h=o-Math.abs(c),a>=h?(c>0?(s="top",t.y=t.y+h):(s="bottom",t.y=t.y-h),i&&(t.vy*=-1)):(d>0?(s="left",t.x=t.x+a):(s="right",t.x=t.x-a),i&&(t.vx*=-1))),s}function hitTestCircleRectangle(t,e,i){var n,s,r,o,a,h,i="undefined"!=typeof i?i:!1;if(i?(r=t.gx,o=t.gy,a=e.gx,h=e.gy):(r=t.x,o=t.y,a=e.x,h=e.y),n=o<h-e.halfHeight?r<a-1-e.halfWidth?"topLeft":r>a+1+e.halfWidth?"topRight":"topMiddle":o>h+e.halfHeight?r<a-1-e.halfWidth?"bottomLeft":r>a+1+e.halfWidth?"bottomRight":"bottomMiddle":r<a-e.halfWidth?"leftMiddle":"rightMiddle","topMiddle"===n||"bottomMiddle"===n||"leftMiddle"===n||"rightMiddle"===n)s=hitTestRectangle(t,e,i);else{var d={};switch(n){case"topLeft":d.x=a,d.y=h;break;case"topRight":d.x=a+e.width,d.y=h;break;case"bottomLeft":d.x=a,d.y=h+e.height;break;case"bottomRight":d.x=a+e.width,d.y=h+e.height}s=hitTestCirclePoint(t,d,i)}return s?n:s}function circleRectangleCollision(t,e,i,n){var s,r,o,a,h,d,n="undefined"!=typeof n?n:!1,i="undefined"!=typeof i?i:!1;if(n?(o=t.gx,a=t.gy,h=e.gx,d=e.gy):(o=t.x,a=t.y,h=e.x,d=e.y),s=a<d-e.halfHeight?o<h-1-e.halfWidth?"topLeft":o>h+1+e.halfWidth?"topRight":"topMiddle":a>d+e.halfHeight?o<h-1-e.halfWidth?"bottomLeft":o>h+1+e.halfWidth?"bottomRight":"bottomMiddle":o<h-e.halfWidth?"leftMiddle":"rightMiddle","topMiddle"===s||"bottomMiddle"===s||"leftMiddle"===s||"rightMiddle"===s)r=rectangleCollision(t,e,i,n);else{var c={};switch(s){case"topLeft":c.x=h,c.y=d;break;case"topRight":c.x=h+e.width,c.y=d;break;case"bottomLeft":c.x=h,c.y=d+e.height;break;case"bottomRight":c.x=h+e.width,c.y=d+e.height}r=circlePointCollision(t,c,i,n)}return r?s:r}function hit(t,e,i,n,s,r){function o(t,e){var i=void 0!==t.parent,n=void 0!==e.parent;if(i&&n)return t.diameter&&e.diameter?h(t,e):t.diameter&&!e.diameter?c(t,e):d(t,e);if(n&&void 0!==t.x&&void 0!==t.y)return hitTestPoint(t,e);throw new Error("Im sorry, ${a} and ${b} cannot be use together in a collision test.")}function a(){t instanceof Array&&[t,e].reverse();for(var i=e.length-1;i>=0;i--){var n=e[i];l=o(t,n),l&&r&&r(l,n)}}function h(t,e){return i?t.vx+t.vy!==0&&e.vx+e.vy!==0?movingCircleCollision(t,e,s):circleCollision(t,e,n,s):hitTestCircle(t,e)}function d(t,e){return i?rectangleCollision(t,e,n,s):hitTestRectangle(t,e,s)}function c(t,e){return i?circleRectangleCollision(t,e,n,s):hitTestCircleRectangle(t,e,s)}var l,f=void 0!==t.parent,u=void 0!==e.parent,i="undefined"!=typeof i?i:!1,n="undefined"!=typeof n?n:!1,r="undefined"!=typeof r?r:void 0;return f&&e instanceof Array||u&&t instanceof Array?a():(l=o(t,e),l&&r&&r(l)),l}function particleEffect(t,e,i,n,s,r,o,a,h,d,c,l,f,u,p,g,y,v){function m(n){var r=i();r.frames.length>0&&r.gotoAndStop(w(0,r.frames.length-1)),r.x=t-r.halfWidth,r.y=e-r.halfHeight;var o=w(h,d);r.width=o,r.height=o,r.scaleSpeed=b(f,u),r.alphaSpeed=b(p,g),r.rotationSpeed=b(y,v);var a=b(c,l);r.vx=a*Math.cos(n),r.vy=a*Math.sin(n),r.update=function(){r.vy+=s,r.x+=r.vx,r.y+=r.vy,r.scaleX-r.scaleSpeed>0&&(r.scaleX-=r.scaleSpeed),r.scaleY-r.scaleSpeed>0&&(r.scaleY-=r.scaleSpeed),r.rotation+=r.rotationSpeed,r.alpha-=r.alphaSpeed,r.alpha<=0&&(remove([r]),particles.splice(particles.indexOf(r),1))},particles.push(r)}for(var x,t="undefined"!=typeof t?t:0,e="undefined"!=typeof e?e:0,n="undefined"!=typeof n?n:10,i="undefined"!=typeof i?i:function(){return circle(10,"red")},s="undefined"!=typeof s?s:0,r="undefined"!=typeof r?r:!0,o="undefined"!=typeof o?o:0,a="undefined"!=typeof a?a:6.28,h="undefined"!=typeof h?h:4,d="undefined"!=typeof d?d:16,c="undefined"!=typeof c?c:.1,l="undefined"!=typeof l?l:1,f="undefined"!=typeof f?f:.01,u="undefined"!=typeof u?u:.05,p="undefined"!=typeof p?p:.02,g="undefined"!=typeof g?g:.02,y="undefined"!=typeof y?y:.01,v="undefined"!=typeof v?v:.03,b=function(t,e){return t+Math.random()*(e-t)},w=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},S=[],T=(a-o)/(n-1),k=0;n>k;k++)r?(x=b(o,a),S.push(x)):(void 0===x&&(x=o),S.push(x),x+=T);S.forEach(m)}function emitter(t,e){function i(){r.playing||(e(),o=setInterval(s.bind(this),t),r.playing=!0)}function n(){r.playing&&(clearInterval(o),r.playing=!1)}function s(){e()}var r={},o=void 0;return r.playing=!1,r.play=i,r.stop=n,r}var actx=new AudioContext;Sound.prototype={load:function(){var t=this,e=new XMLHttpRequest;e.open("GET",this.source,!0),e.responseType="arraybuffer",e.addEventListener("load",function(){t.actx.decodeAudioData(e.response,function(e){t.buffer=e,t.hasLoaded=!0,t.loadHandler&&t.loadHandler()},function(t){throw new Error("Audio could not be decoded: "+t)})}),e.send()},play:function(){this.startTime=this.actx.currentTime,this.soundNode=this.actx.createBufferSource(),this.soundNode.buffer=this.buffer,this.soundNode.connect(this.volumeNode),this.reverb===!1?this.volumeNode.connect(this.panNode):(this.volumeNode.connect(this.convolverNode),this.convolverNode.connect(this.panNode),this.convolverNode.buffer=this.reverbImpulse),this.panNode.connect(this.actx.destination),this.echo&&(this.feedbackNode.gain.value=this.feedbackValue,this.delayNode.delayTime.value=this.delayValue,this.filterNode.frequency.value=this.filterValue,this.delayNode.connect(this.feedbackNode),this.filterValue>0?(this.feedbackNode.connect(this.filterNode),this.filterNode.connect(this.delayNode)):this.feedbackNode.connect(this.delayNode),this.volumeNode.connect(this.delayNode),this.delayNode.connect(this.panNode)),this.soundNode.loop=this.loop,this.soundNode.playbackRate.value=this.playbackRate,this.soundNode.start(this.startTime,this.startOffset%this.buffer.duration),this.playing=!0},pause:function(){this.playing&&(this.soundNode.stop(this.actx.currentTime),this.startOffset+=this.actx.currentTime-this.startTime,this.playing=!1)},restart:function(){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=0,this.play()},playFrom:function(t){this.playing&&this.soundNode.stop(this.actx.currentTime),this.startOffset=t,this.play()},setEcho:function(t,e,i){this.delayValue=t||.3,this.feedbackValue=e||.3,this.filterValue=i||0,this.echo=!0},setReverb:function(t,e,i){var t=t||2,e=e||2,i=i||!1;this.reverbImpulse=impulseResponse(t,e,i),this.reverb=!0},get volume(){return this.volumeValue},set volume(t){this.volumeNode.gain.value=t,this.volumeValue=t},get pan(){return this.panNode.pan.value},set pan(t){this.panNode.pan.value=t}};var assets={toLoad:0,loaded:0,imageExtensions:["png","jpg","gif"],fontExtensions:["ttf","otf","ttc","woff"],jsonExtensions:["json"],audioExtensions:["mp3","ogg","wav","webm"],load:function(t,e){var i=this,n=function(){i.loaded+=1,console.log(assets.loaded),i.toLoad===i.loaded&&(i.toLoad=0,i.loaded=0,console.log("Assets finished loading"),e&&e())};console.log("Loading assets..."),this.toLoad=t.length,t.forEach(function(t){var e=t.split(".").pop();-1!==this.fontExtensions.indexOf(e)?this.loadFont(t,n):-1!==this.imageExtensions.indexOf(e)?this.loadImage(t,n):-1!==this.jsonExtensions.indexOf(e)?this.loadJson(t,n,this):-1!==this.audioExtensions.indexOf(e)?this.loadSound(t,n):-1!==this.audioExtensions.indexOf(e)?this.loadSound(t,n):console.log("File type not recognized: "+t)},this)},loadImage:function(t,e){var i=new Image;i.addEventListener("load",e,!1),this[t]=i,i.src=t},loadFont:function(t,e){var i=t.split("/").pop().split(".")[0],n=new Font;n.onload=function(){e()},n.onerror=function(t){console.log("FontLoadError: ",t)},n.fontFamily=i,n.src=t},loadJson:function(t,e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="text",n.onload=function(s){if(200===n.status){var r=JSON.parse(n.responseText);r.name=t,i[r.name]=r,r.frames?i.createTilesetFrames(r,t,e,i):e()}},n.send()},createTilesetFrames:function(t,e,i,n){function s(){n[o]=a,Object.keys(t.frames).forEach(function(e){n[e]=t.frames[e],n[e].source=a}),i()}var r=e.replace(/[^\/]*$/,""),o=r+t.meta.image,a=new Image;a.addEventListener("load",s,!1),a.src=o},loadSound:function(t,e){var i=makeSound(t,e);i.name=t,this[i.name]=i}},buttons=[],draggableSprites=[],particles=[],tweens=[],shakingSprites=[];DisplayObject.prototype={get gx(){return this.parent?this.x+this.parent.gx:this.x},get gy(){return this.parent?this.y+this.parent.gy:this.y},get layer(){return this._layer},set layer(t){this._layer=t,this.parent&&this.parent.children.sort(function(t,e){return t.layer-e.layer})},addChild:function(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t)},removeChild:function(t){if(t.parent!==this)throw new Error(t+"is not a child of "+this);this.children.splice(this.children.indexOf(t),1)},get halfWidth(){return this.width/2},get halfHeight(){return this.height/2},get centerX(){return this.x+this.halfWidth},get centerY(){return this.y+this.halfHeight},get position(){return{x:this.x,y:this.y}},setPosition:function(t,e){this.x=t,this.y=e},setRadialGradient:function(t,e,i,n,s,r,o,a){this.gradient=!0,this.gradient=canvas.ctx.createRadialGradient(i,n,s,r,o,a),this.gradient.addColorStop(0,t),this.gradient.addColorStop(1,e)},setPattern:function(t,e){this.pattern=!0,this.pattern=canvas.ctx.createPattern(t,e)},get localBounds(){return{x:0,y:0,width:this.width,height:this.height}},get globalBounds(){return{x:this.gx,y:this.gy,width:this.gx+this.width,height:this.gy+this.height}},get empty(){return 0===this.children.length?!0:!1},putCenter:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x+n.halfWidth-t.halfWidth+e,t.y=n.y+n.halfHeight-t.halfHeight+i},putTop:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x+n.halfWidth-t.halfWidth+e,t.y=n.y-t.height+i},putRight:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x+n.width+e,t.y=n.y+n.halfHeight-t.halfHeight+i},putBottom:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x+n.halfWidth-t.halfWidth+e,t.y=n.y+n.height+i},putLeft:function(t,e,i){var n=this,e=e||0,i=i||0;t.x=n.x-t.width+e,t.y=n.y+n.halfHeight-t.halfHeight+i},swapChildren:function(t,e){var i=this.children.indexOf(t),n=this.children.indexOf(e);if(-1===i||-1===n)throw new Error("Both objects must be a child of the caller "+this);t.childIndex=n,e.childIndex=i,this.children[i]=e,this.children[n]=t},add:function(t){t.forEach(function(t){this.addChild(t)},this)},remove:function(t){for(var e=t.length-1;e>=0;e--)this.removeChild(t[e])},removeHierarchy:function(t){for(var e=t.length-1;e>=0;e--)t[e].children&&t[e].children.length>0&&t[e].remove(t[e].children),this.removeChild(t[e])},get currentFrame(){return this._currentFrame},get circular(){return this._circular},set circular(t){t===!0&&this._circular===!1&&(Object.defineProperties(this,{diameter:{get:function(){return this.width},set:function(t){this.width=t,this.height=t},enumerable:!0,configurable:!0},radius:{get:function(){return this.halfWidth},set:function(t){this.width=2*t,this.height=2*t},enumerable:!0,configurable:!0}}),this._circular=!0),t===!1&&this._circular===!0&&(delete this.diameter,delete this.radius,this._circular=!1)},get draggable(){return this._draggable},set draggable(t){t===!0&&(draggableSprites.push(this),this._draggable=!0),t===!1&&draggableSprites.splice(draggableSprites.indexOf(this),1)},get interactive(){return this._interactive},set interactive(t){t===!0&&(makeInteractive(this),buttons.push(this),this._interactive=!0),t===!1&&(buttons.splice(buttons.indexOf(this),1),this._interactive=!1)}};var stage=new DisplayObject;Group.prototype=new DisplayObject,Group.prototype.constructor=Group,Group.prototype.addChild=function(t){t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),this.calculateSize()},Group.prototype.removeChild=function(t){if(t.parent!==this)throw new Error(t+"is not a child of "+this);this.children.splice(this.children.indexOf(t),1),this.calculateSize()},Group.prototype.calculateSize=function(){this.children.length>0&&(this._newWidth=0,this._newHeight=0,this.children.forEach(function(t){t.x+t.width>this._newWidth&&(this._newWidth=t.x+t.width),t.y+t.height>this._newHeight&&(this._newHeight=t.y+t.height)},this),this.width=this._newWidth,this.height=this._newHeight)},Sprite.prototype=new DisplayObject,Sprite.prototype.constructor=Sprite,Sprite.prototype.createFromImage=function(t){if(!(t instanceof Image))throw new Error(t+" is not an image object");
this.source=t,this.sourceX=0,this.sourceY=0,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height},Sprite.prototype.createFromAtlas=function(t){this.tilesetFrame=t,this.source=this.tilesetFrame.source,this.sourceX=this.tilesetFrame.frame.x,this.sourceY=this.tilesetFrame.frame.y,this.width=this.tilesetFrame.frame.w,this.height=this.tilesetFrame.frame.h,this.sourceWidth=this.tilesetFrame.frame.w,this.sourceHeight=this.tilesetFrame.frame.h},Sprite.prototype.createFromTileset=function(t){if(!(t.image instanceof Image))throw new Error(t.image+" is not an image object");this.source=t.image,this.sourceX=t.x,this.sourceY=t.y,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height},Sprite.prototype.createFromTilesetFrames=function(t){if(!(t.image instanceof Image))throw new Error(t.image+" is not an image object");this.source=t.image,this.frames=t.data,this.sourceX=this.frames[0][0],this.sourceY=this.frames[0][1],this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height},Sprite.prototype.createFromAtlasFrames=function(t){this.frames=t,this.source=t[0].source,this.sourceX=t[0].frame.x,this.sourceY=t[0].frame.y,this.width=t[0].frame.w,this.height=t[0].frame.h,this.sourceWidth=t[0].frame.w,this.sourceHeight=t[0].frame.h},Sprite.prototype.createFromImages=function(t){this.frames=t,this.source=t[0],this.sourceX=0,this.sourceY=0,this.width=t[0].width,this.height=t[0].width,this.sourceWidth=t[0].width,this.sourceHeight=t[0].height},Sprite.prototype.gotoAndStop=function(t){if(!(this.frames.length>0&&t<this.frames.length))throw new Error("Frame number "+t+" does not exist");this.frames[0]instanceof Array?(this.sourceX=this.frames[t][0],this.sourceY=this.frames[t][1]):this.frames[t].frame?(this.sourceX=this.frames[t].frame.x,this.sourceY=this.frames[t].frame.y,this.sourceWidth=this.frames[t].frame.w,this.sourceHeight=this.frames[t].frame.h,this.width=this.frames[t].frame.w,this.height=this.frames[t].frame.h):(this.source=this.frames[t],this.sourceX=0,this.sourceY=0,this.width=this.source.width,this.height=this.source.height,this.sourceWidth=this.source.width,this.sourceHeight=this.source.height),this._currentFrame=t},Sprite.prototype.render=function(t){t.drawImage(this.source,Math.round(this.sourceX),Math.round(this.sourceY),Math.round(this.sourceWidth),Math.round(this.sourceHeight),Math.round(-this.width*this.pivotX),Math.round(-this.height*this.pivotY),Math.round(this.width),Math.round(this.height))},Button.prototype=new Sprite,Button.prototype.constructor=Button;var progressBar={maxWidth:0,height:0,backgroundColor:"gray",foregroundColor:"cyan",backBar:null,frontBar:null,percentage:null,assets:null,initialized:!1,create:function(t,e){this.initialized||(this.assets=e,this.maxWidth=t.width/2,this.backBar=rectangle(this.maxWidth,32,this.backgroundColor),this.backBar.x=t.width/2-this.maxWidth/2,this.backBar.y=t.height/2-16,this.frontBar=rectangle(this.maxWidth,32,this.foregroundColor),this.frontBar.x=t.width/2-this.maxWidth/2,this.frontBar.y=t.height/2-16,this.percentage=text("0%","28px sans-serif","black"),this.percentage.x=t.width/2-this.maxWidth/2+12,this.percentage.y=t.height/2-16,this.initialized=!0)},update:function(){var t=(this.assets.loaded+1)/this.assets.toLoad;this.frontBar.width=this.maxWidth*t,this.percentage.content=Math.floor(100*t)+"%"},remove:function(){remove([this.frontBar,this.backBar,this.percentage])}};Rectangle.prototype=new DisplayObject,Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.render=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,this.gradient?t.fillStyle=this.gradient:this.pattern?t.fillStyle=this.pattern:t.fillStyle=this.fillStyle,t.beginPath(),t.rect(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&this.mask===!0&&t.clip()},Circle.prototype=new DisplayObject,Circle.prototype.constructor=Circle,Circle.prototype.render=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,this.gradient?t.fillStyle=this.gradient:t.fillStyle=this.fillStyle,t.beginPath(),t.arc(this.radius+-this.diameter*this.pivotX,this.radius+-this.diameter*this.pivotY,this.radius,0,2*Math.PI,!1),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&this.mask===!0&&t.clip()},Ellipse.prototype=new DisplayObject,Ellipse.prototype.constructor=Ellipse,Ellipse.prototype.render=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.beginPath(),t.moveTo(this.x,this.y-this.height/2),t.bezierCurveTo(this.x+this.width/2,this.y-this.height/2,this.x+this.width/2,this.y+this.height/2,this.x,this.y+this.height/2),t.bezierCurveTo(this.x-this.width/2,this.y+this.height/2,this.x-this.width/2,this.y-this.height/2,this.x,this.y-this.height/2),"none"!==this.strokeStyle&&t.stroke(),"none"!==this.fillStyle&&t.fill(),this.mask&&this.mask===!0&&t.clip()},Line.prototype=new DisplayObject,Line.prototype.constructor=Line,Line.prototype.render=function(t){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.lineJoin=this.lineJoin,t.beginPath(),t.moveTo(this.ax,this.ay),t.lineTo(this.bx,this.by),"none"!==this.strokeStyle&&t.stroke()},Text.prototype=new DisplayObject,Text.prototype.constructor=Text,Text.prototype.render=function(t){t.font=this.font,t.lineWidth=this.lineWidth,t.fillStyle=this.fillStyle,t.translate(-this.width*this.pivotX,-this.height*this.pivotY),t.textBaseline=this.textBaseline,t.fillText(this.content,0,0),"none"!==this.strokeText&&t.strokeText()};

/*
tilingSprite
------------
*/
//function tilingSprite(spriteFunction, tileHeight, tileWidth, totalWidth, totalHeight) {
function tilingSprite(width, height, source, x, y) {

  var x= checkIfUndefined(x,0), y= checkIfUndefined(y,0);
  //Figure out the tile's width and height
  var tileWidth, tileHeight;

  //If the source is a texture atlas frame, use its
  //frame.w and frame.h properties
  if(source.frame) {
    tileWidth = source.frame.w;
    tileHeight = source.frame.h;
  }

  //If it's an image, use the image's
  //width and height properties
  else {
    tileWidth = source.width;
    tileHeight = source.height;
  }

	//done to hide the blank line appearing b/w the tiling sprites issue resolved
	tileWidth = tileWidth-1;
	tileHeight = tileHeight-2;

  //Figure out the rows and columns.
  //The number of rows and columns should always be
  //one greater than the total number of tiles
  //that can fit in the rectangle. This give us one
  //additional row and column that we can reposition
  //to create the infinite scroll effect

  var columns, rows;

  //1. Columns
  //If the width of the rectangle is greater than the width of the tile,
  //calculate the number of tile columns
  if (width >= tileWidth) {
    columns = Math.round(width / tileWidth) + 1;
  }

  //If the rectangle's width is less than the width of the
  //tile, set the columns to 2, which is the minimum
  else {
    columns = 2;
  }

  //2. Rows
  //Calculate the tile rows in the same way
  if (height >= tileHeight) {
    rows = Math.round(height / tileHeight) + 1;
  } else {
    rows = 2;
  }

  //Create a grid of sprites that's just one sprite larger
  //than the totalWidth and totalHeight
  var tileGrid = grid(
   columns, rows, tileWidth, tileHeight, true, 0, 0,
   function(){
     //Make a sprite from the supplied source
     var tile = sprite(source);
     return tile;
   }
  );

  //Declare the grid's private properties that we'll use to
  //help scroll the tiling background
  tileGrid._tileX = 0;
  tileGrid._tileY = 0;

  //Create an empty rectangle sprite without a fill or stoke color.
  //Set it to the supplied width and height
  var container = rectangle(width, height, "#d3d3d3", "#d3d3d3");
  container.x = x;
  container.y = y;

  //Set the rectangle's mask property to true. This switches on ctx.clip()
  //In the rectangle sprite's render method.
  container.mask = true;

  //Add the tile grid to the rectangle container
  container.addChild(tileGrid);

  //Define the tileX and tileY properties on the parent container
  //so that you can scroll the tiling background
  Object.defineProperties(container, {
    tileX: {
      get () {
        return tileGrid._tileX;
      },

      set (value) {

        //Loop through all of the grid's child sprites
        tileGrid.children.forEach(function(child){

          //Figure out the difference between the new position
          //and the previous position
          var difference = value - tileGrid._tileX;

          //Offset the child sprite by the difference
          child.x += difference;

          //If the x position of the sprite exceeds the total width
          //of the visible columns, reposition it to just in front of the
          //left edge of the container. This creates the wrapping
          //effect
          if (child.x > (columns - 1) * tileWidth) {
            child.x = 0 - tileWidth + difference;
          }

          //Use the same procedure to wrap sprites that
          //exceed the left boundary
          if (child.x < 0 - tileWidth - difference) {
            child.x = (columns - 1) * tileWidth;
          }
        });

        //Set the private _tileX property to the new value
        tileGrid._tileX = value;
      },
      enumerable: true, configurable: true
    },
    tileY: {
      get() {
        return tileGrid._tileY;
      },

      //Follow the same format to wrap sprites on the y axis
      set(value){
        tileGrid.children.forEach(function(child){
          var difference = value - tileGrid._tileY;
          child.y += difference;
          if (child.y > (rows - 1) * tileHeight){
            child.y = 0 - tileHeight + difference;
          }
          if (child.y < 0 - tileHeight - difference){
            child.y = (rows - 1) * tileHeight;
          }
        });
        tileGrid._tileY = value;
      },
      enumerable: true, configurable: true
    }
  });

  //Return the rectangle container
  return container;
}
function cubicBezier(e,n,t,i,a){var s=e*e,r=s*e;return n+(3*-n+e*(3*n-n*e))*e+(3*t+e*(-6*t+3*t*e))*e+(3*i-3*i*e)*s+a*r}function tweenProperty(e,n,t,i,a,s,r,o){var s=checkIfUndefined(s,["smoothstep"]),r=checkIfUndefined(r,!1),o=checkIfUndefined(o,0),c={};return"spline"===s[0]&&(c.startMagnitude=s[1],c.endMagnitude=s[2]),c.start=function(e,n){c.startValue=JSON.parse(JSON.stringify(e)),c.endValue=JSON.parse(JSON.stringify(n)),c.playing=!0,c.totalFrames=a,c.frameCounter=0,tweens.push(c)},c.start(t,i),c.update=function(){var t;if(c.playing)if(c.frameCounter<c.totalFrames){var i=c.frameCounter/c.totalFrames;t="spline"!==s[0]?ease[s](i):ease.spline(i,c.startMagnitude,0,1,c.endMagnitude),e[n]=c.endValue*t+c.startValue*(1-t),c.frameCounter+=1}else c.end()},c.end=function(){c.playing=!1,c.onComplete&&c.onComplete(),tweens.splice(tweens.indexOf(c),1),r&&setTimeout(function(){return c.start(c.endValue,c.startValue)},o)},c.play=function(){return c.playing=!0},c.pause=function(){return c.playing=!1},c}function fadeIn(e,n){var n=checkIfUndefined(n,60);return tweenProperty(e,"alpha",e.alpha,1,n,["sine"])}function fadeOut(e,n){var n=checkIfUndefined(n,60);return tweenProperty(e,"alpha",e.alpha,0,n,["sine"])}function pulse(e,n,t){var n=checkIfUndefined(n,60),t=checkIfUndefined(t,0);return tweenProperty(e,"alpha",e.alpha,t,n,["smoothstep"],!0)}function slide(e,n,t,i,a,s,r){var i=checkIfUndefined(i,60),a=checkIfUndefined(a,["smoothstep"]),s=checkIfUndefined(s,!1),r=checkIfUndefined(r,0);return makeTween([[e,"x",e.x,n,i,a,s,r],[e,"y",e.y,t,i,a,s,r]])}function makeTween(e){var n={};n.tweens=[],e.forEach(function(e){var t=tweenProperty.apply(null,e);n.tweens.push(t)});var t=0;return n.completed=function(){t+=1,t===n.tweens.length&&(n.onComplete&&n.onComplete(),t=0)},n.tweens.forEach(function(e){e.onComplete=n.completed()}),n.pause=function(){n.tweens.forEach(function(e){e.playing=!1})},n.play=function(){n.tweens.forEach(function(e){e.playing=!0})},n}function removeTween(e){e.tweens?(e.pause(),e.tweens.forEach(function(e){tweens.splice(tweens.indexOf(e),1)})):(e.pause(),tweens.splice(tweens.indexOf(e),1))}function breathe(e,n,t,i,a,s){var a=checkIfUndefined(a,!0),s=checkIfUndefined(s,0);return makeTween([[e,"scaleX",e.scaleX,n,i,["smoothstepSquared"],a,s],[e,"scaleY",e.scaleY,t,i,["smoothstepSquared"],a,s]])}function scale(e,n,t,i){checkIfUndefined(i,60);return makeTween([[e,"scaleX",e.scaleX,n,i,["smoothstep"],!1],[e,"scaleY",e.scaleY,t,i,["smoothstep"],!1]])}function strobe(e,n,t,i,a,s,r){var n=checkIfUndefined(n,1.3),t=checkIfUndefined(t,10),i=checkIfUndefined(i,20),a=checkIfUndefined(a,10),s=checkIfUndefined(s,!0),r=checkIfUndefined(r,0);return makeTween([[e,"scaleX",e.scaleX,n,a,["spline",t,i],s,r],[e,"scaleY",e.scaleY,n,a,["spline",t,i],s,r]])}function wobble(e,n,t,i,a,s,r,o,c,u,f){var n=checkIfUndefined(n,1.2),t=checkIfUndefined(t,1.2),i=checkIfUndefined(i,10),a=checkIfUndefined(a,10),s=checkIfUndefined(s,10),r=checkIfUndefined(r,-10),o=checkIfUndefined(o,-10),c=checkIfUndefined(c,.98),u=checkIfUndefined(u,!0),f=checkIfUndefined(f,0),h=makeTween([[e,"scaleX",e.scaleX,n,i,["spline",a,s],u,f],[e,"scaleY",e.scaleY,t,i,["spline",r,o],u,f]]);return h.tweens.forEach(function(e){e.onComplete=function(){e.endValue>1&&(e.endValue*=c,e.endValue<=1&&(e.endValue=1,removeTween(e)))}}),h}function walkPath(e,n,t,i,a,s,r){function o(n){var t=makeTween([[e,"x",c[n][0],c[n+1][0],u,i],[e,"y",c[n][1],c[n+1][1],u,i]]);return t.onComplete=function(){n+=1,n<c.length-1?setTimeout(function(){t=o(n)},r):a&&(s&&c.reverse(),setTimeout(function(){n=0,e.x=c[0][0],e.y=c[0][1],t=o(n)},r),n=0,e.x=c[0][0],e.y=c[0][1],t=o(n))},t}var t=checkIfUndefined(t,300),i=checkIfUndefined(i,["smoothstep"]),a=checkIfUndefined(a,!1),s=checkIfUndefined(s,!1),r=checkIfUndefined(r,0),c=JSON.parse(JSON.stringify(n)),u=t/c.length,f=0,h=o(f);return h}function walkCurve(e,n,t,i,a,s,r){function o(t){var u=followCurve(e,n[t],c,i);return u.onComplete=function(){t+=1,t<n.length?setTimeout(function(){u=o(t)},r):a&&(s&&(n.reverse(),n.forEach(function(e){e.reverse()})),setTimeout(function(){t=0,e.x=n[0][0],e.y=n[0][1],u=o(t)},r))},u}var t=checkIfUndefined(t,300),i=checkIfUndefined(i,["smoothstep"]),a=checkIfUndefined(a,!1),s=checkIfUndefined(s,!1),r=checkIfUndefined(r,0),c=t/n.length,u=0,f=o(u);return f}function followCurve(e,n,t,i,a,s){var i=checkIfUndefined(i,["smoothstep"]),a=checkIfUndefined(a,!1),s=checkIfUndefined(s,0),r={};return"spline"===i[0]&&(r.startMagnitude=i[1],r.endMagnitude=i[2]),r.start=function(e){r.playing=!0,r.totalFrames=t,r.frameCounter=0,r.pointsArray=JSON.parse(JSON.stringify(e)),tweens.push(r)},r.start(n),r.update=function(){var n,t,a=r.pointsArray;r.playing&&(r.frameCounter<r.totalFrames?(n=r.frameCounter/r.totalFrames,t="spline"!==i[0]?ease[i](n):ease.spline(n,r.startMagnitude,0,1,r.endMagnitude),e.x=cubicBezier(t,a[0][0],a[1][0],a[2][0],a[3][0]),e.y=cubicBezier(t,a[0][1],a[1][1],a[2][1],a[3][1]),r.frameCounter+=1):r.end())},r.end=function(){r.playing=!1,r.onComplete&&r.onComplete(),tweens.splice(tweens.indexOf(r),1),a&&setTimeout(function(){r.pointsArray=r.pointsArray.reverse(),r.start(r.pointsArray)},s)},r.pause=function(){r.playing=!1},r.play=function(){r.playing=!0},r}function Game(e,n,t,i,a){if(this.canvas=makeCanvas(e,n,"#cccccc","#ff9999"),stage.width=this.canvas.width,stage.height=this.canvas.height,this.pointer=makePointer(this.canvas),this.scale=1,this.state=void 0,this.load=a,this.setup=t,this.assetsToLoad=i,this.paused=!1,this.interpolation=!1,this.fps=15,this.previous=0,this.frameDuration=1e3/this.fps,this.lag=0,_this=this,!t)throw new Error("Please supply the setup function in the constructor")}function game(e,n,t,i,a){var e=checkIfUndefined(e,256),n=checkIfUndefined(n,256);return new Game(e,n,t,i,a)}function capturePreviousPositions(e){function n(e){e.previousX=e.x,e.previousY=e.y,e.children&&e.children.length>0&&e.children.forEach(function(e){n(e)})}e.children.forEach(function(e){n(e)})}var linear=function(e){return e},smoothstep=function(e){return e*e*(3-2*e)},smoothstepSquared=function(e){return Math.pow(e*e*(3-2*e),2)},smoothstepCubed=function(e){return Math.pow(e*e*(3-2*e),3)},acceleration=function(e){return e*e},accelerationCubed=function(e){return Math.pow(e*e,3)},deceleration=function(e){return 1-Math.pow(1-e,2)},decelerationCubed=function(e){return 1-Math.pow(1-e,3)},sine=function(e){return Math.sin(e*Math.PI/2)},sineSquared=function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},sineCubed=function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},inverseSine=function(e){return 1-Math.sin((1-e)*Math.PI/2)},inverseSineSquared=function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),2)},inverseSineCubed=function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),3)},sineComplete=function(e){return.5-.5*Math.cos(-e*Math.PI)},weightedAverage=function(e,n,t){return(e*(t-1)+n)/t},spline=function(e,n,t,i,a){return.5*(2*t+(-n+i)*e+(2*n-5*t+4*i-a)*e*e+(-n+3*t-3*i+a)*e*e*e)},ease={linear:function(e){return e},smoothstep:function(e){return e*e*(3-2*e)},smoothstepSquared:function(e){return Math.pow(e*e*(3-2*e),2)},smoothstepCubed:function(e){return Math.pow(e*e*(3-2*e),3)},acceleration:function(e){return e*e},accelerationCubed:function(e){return Math.pow(e*e,3)},deceleration:function(e){return 1-Math.pow(1-e,2)},decelerationCubed:function(e){return 1-Math.pow(1-e,3)},sine:function(e){return Math.sin(e*Math.PI/2)},sineSquared:function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},sineCubed:function(e){return Math.pow(Math.sin(e*Math.PI/2),2)},inverseSine:function(e){return 1-Math.sin((1-e)*Math.PI/2)},inverseSineSquared:function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),2)},inverseSineCubed:function(e){return 1-Math.pow(Math.sin((1-e)*Math.PI/2),3)},spline:function(e,n,t,i,a){return.5*(2*t+(-n+i)*e+(2*n-5*t+4*i-a)*e*e+(-n+3*t-3*i+a)*e*e*e)}};Game.prototype={gameLoop:function(e){requestAnimationFrame(this.gameLoop.bind(this)),this.updateGameEffects(),this.state&&!this.paused&&this.state(),render(this.canvas)},start:function(){this.assetsToLoad?(setTimeout(function(){assets.load(_this.assetsToLoad,function(){_this.state=void 0,_this.setup()})},0),this.load&&(this.state=this.load)):this.setup(),this.gameLoop()},pause:function(){this.paused=!0},resume:function(){this.paused=!1},scaleToWindow:function(e){var n,t,i,a,e=checkIfUndefined(e,"#2C3539");if(n=window.innerWidth/this.canvas.width,t=window.innerHeight/this.canvas.height,i=Math.min(n,t),i=Math.round(i),this.canvas.style.transformOrigin="0 0",this.canvas.style.transform="scale("+i+")",a=this.canvas.width>this.canvas.height?"vertically":"horizontally","horizontally"===a){var s=(window.innerHeight-this.canvas.height*n)/2;this.canvas.style.marginTop=s+"px",this.canvas.style.marginBottom=s+"px"}if("vertically"===a){var s=(window.innerWidth-this.canvas.width*t)/2;this.canvas.style.marginLeft=s+"px",this.canvas.style.marginRight=s+"px"}this.canvas.style.paddingLeft=0,this.canvas.style.paddingRight=0,this.canvas.style.display="block",document.body.style.backgroundColor=e,this.pointer.scale=i,this.scale=i},updateGameEffects:function(){if(buttons.length>0&&(this.canvas.style.cursor="auto",buttons.forEach(function(e){e.update(this.pointer,this.canvas),("over"===e.state||"down"===e.state)&&void 0!==e.parent&&(this.canvas.style.cursor="pointer")},this)),particles.length>0)for(var e=particles.length-1;e>=0;e--){var n=particles[e];n.update()}if(tweens.length>0)for(var e=tweens.length-1;e>=0;e--){var t=tweens[e];t&&t.update()}if(shakingSprites.length>0)for(var e=shakingSprites.length-1;e>=0;e--){var i=shakingSprites[e];i.updateShake&&i.updateShake()}draggableSprites.length>0&&this.pointer.updateDragAndDrop(draggableSprites)}};
